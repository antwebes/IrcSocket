<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="COMM">/**
<span class='line'>  2</span>  * @fileOverview
<span class='line'>  3</span>  * @name LCCS_JS_Bridge.js
<span class='line'>  4</span>  * @author http://forums.adobe.com/community/livecycle/lccs
<span class='line'>  5</span>  */</span><span class="WHIT">
<span class='line'>  6</span> 
<span class='line'>  7</span> </span><span class="COMM">/*************************************************************************
<span class='line'>  8</span>  *
<span class='line'>  9</span>  * ADOBE CONFIDENTIAL
<span class='line'> 10</span>  * ___________________
<span class='line'> 11</span>  *
<span class='line'> 12</span>  * Copyright 2007-2010 Adobe Systems Incorporated
<span class='line'> 13</span>  * All Rights Reserved.
<span class='line'> 14</span>  *
<span class='line'> 15</span>  * NOTICE:  All information contained herein is, and remains
<span class='line'> 16</span>  * the property of Adobe Systems Incorporated and its suppliers,
<span class='line'> 17</span>  * if any.  The intellectual and technical concepts contained
<span class='line'> 18</span>  * herein are proprietary to Adobe Systems Incorporated and its
<span class='line'> 19</span>  * suppliers and are protected by trade secret or copyright law.
<span class='line'> 20</span>  * Dissemination of this information or reproduction of this material
<span class='line'> 21</span>  * is strictly forbidden unless prior written permission is obtained
<span class='line'> 22</span>  * from Adobe Systems Incorporated.
<span class='line'> 23</span>  **************************************************************************/</span><span class="WHIT">
<span class='line'> 24</span> 
<span class='line'> 25</span> </span><span class="COMM">/**
<span class='line'> 26</span>  *@private
<span class='line'> 27</span>  */</span><span class="WHIT">
<span class='line'> 28</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">myTrace</span><span class="PUNC">(</span><span class="NAME">msg</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 29</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 30</span> </span><span class="WHIT">	</span><span class="NAME">alert</span><span class="PUNC">(</span><span class="NAME">msg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 31</span> </span><span class="WHIT">	</span><span class="COMM">//window.dump(msg);</span><span class="WHIT">
<span class='line'> 32</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 33</span> 
<span class='line'> 34</span> </span><span class="COMM">/**
<span class='line'> 35</span>  *@private
<span class='line'> 36</span>  */</span><span class="WHIT">
<span class='line'> 37</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">sendToJavaScript</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 38</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 39</span> </span><span class="WHIT">	</span><span class="COMM">//myTrace("arguments length" + arguments.length + arguments[0]);</span><span class="WHIT">
<span class='line'> 40</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 41</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">args.targetType</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="STRN">"CollectionNode"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 42</span> </span><span class="WHIT">		</span><span class="COMM">//	myTrace("Recieved something from AS side");</span><span class="WHIT">
<span class='line'> 43</span> </span><span class="WHIT">		</span><span class="NAME">ConnectSession.primarySession.collections</span><span class="PUNC">[</span><span class="NAME">args.targetSharedId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">receiveEvent</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 44</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">args.targetType</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="STRN">"UserManager"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 45</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">usrMgr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ConnectSession.primarySession.userManager</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 46</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">args.type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"getUserMgr"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 47</span> </span><span class="WHIT">			</span><span class="COMM">//myTrace("Initializing User Manager");</span><span class="WHIT">
<span class='line'> 48</span> </span><span class="WHIT">			</span><span class="NAME">usrMgr.initialize</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 49</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 50</span> </span><span class="WHIT">			</span><span class="NAME">evt.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">evt.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ConnectSession.primarySession</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 51</span> </span><span class="WHIT">			</span><span class="NAME">evt.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"synchronizationChange"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 52</span> </span><span class="WHIT">			</span><span class="NAME">evt.value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 53</span> </span><span class="WHIT">			</span><span class="NAME">this.LCCSReady</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 54</span> </span><span class="WHIT">			</span><span class="NAME">ConnectSession.primarySession.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 55</span> </span><span class="WHIT">			</span><span class="COMM">//myTrace(usrMgr.myUserID);</span><span class="WHIT">
<span class='line'> 56</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 57</span> </span><span class="WHIT">			</span><span class="NAME">usrMgr.receiveEvent</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 58</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 59</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">args.targetType</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="STRN">"ConnectSession"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 60</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">args.type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"swfReady"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 61</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 62</span> </span><span class="WHIT">				</span><span class="NAME">evt.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">evt.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ConnectSession.primarySession</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 63</span> </span><span class="WHIT">				</span><span class="NAME">evt.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"swfReady"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 64</span> </span><span class="WHIT">				</span><span class="NAME">ConnectSession.primarySession.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 65</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 66</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 67</span> </span><span class="WHIT">				</span><span class="NAME">evt.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">evt.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ConnectSession.primarySession</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 68</span> </span><span class="WHIT">				</span><span class="NAME">evt.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"synchronizationChange"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 69</span> </span><span class="WHIT">				</span><span class="NAME">this.LCCSReady</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 70</span> </span><span class="WHIT">				</span><span class="NAME">evt.value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 71</span> </span><span class="WHIT">				</span><span class="NAME">ConnectSession.primarySession.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 72</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 73</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 74</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 75</span> 
<span class='line'> 76</span> </span><span class="COMM">/**
<span class='line'> 77</span>  *@private
<span class='line'> 78</span>  */</span><span class="WHIT">
<span class='line'> 79</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">swfTrace</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 80</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 81</span> </span><span class="WHIT">	</span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">"SWF TRACE Commn from the swf:"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 82</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 83</span> 
<span class='line'> 84</span> 
<span class='line'> 85</span> </span><span class="COMM">//TODO: Come on - Prolly its a good idea to dispatch a event :)</span><span class="WHIT">
<span class='line'> 86</span> </span><span class="COMM">/**
<span class='line'> 87</span>  *@private
<span class='line'> 88</span>  */</span><span class="WHIT">
<span class='line'> 89</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">swfLoaded</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 90</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 91</span> </span><span class="WHIT">	</span><span class="COMM">//This function should be called only by the swf to notify that ConnectSession.PrimarySession is synchronized</span><span class="WHIT">
<span class='line'> 92</span> </span><span class="WHIT">	</span><span class="COMM">//alert("LCCS is Ready");</span><span class="WHIT">
<span class='line'> 93</span> </span><span class="WHIT">	</span><span class="NAME">this.LCCSReady</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 94</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 95</span> 
<span class='line'> 96</span> </span><span class="COMM">/**
<span class='line'> 97</span>  *@private
<span class='line'> 98</span>  * Its a standard solution that is cited on many websites to address scope issues
<span class='line'> 99</span>  */</span><span class="WHIT">
<span class='line'>100</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">bindUsingClosure</span><span class="PUNC">(</span><span class="NAME">func</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>101</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>102</span> </span><span class="WHIT">        	</span><span class="NAME">func.apply</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>103</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>104</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>105</span> 
<span class='line'>106</span> </span><span class="COMM">/**
<span class='line'>107</span>  * @class The EventDispatcher class is the helper class for all classes that dispatch events.
<span class='line'>108</span>  * &lt;p>The event model is similar to,but not the same as ActionScript's event model.
<span class='line'>109</span>  * Components generate and dispatch events and consume (listen to) other events. An object that requires information
<span class='line'>110</span>  * about another object's events registers a listener with that object. When an event occurs, the object dispatches
<span class='line'>111</span>  * the event to all registered listeners by calling a function that was requested during registration. To receive multiple
<span class='line'>112</span>  * events from the same object, you must register your listener for each event.&lt;/p>
<span class='line'>113</span>  *
<span class='line'>114</span>  * &lt;p>Components have built-in events that you can handle in your JavaScript applications. You can also take advantage of the
<span class='line'>115</span>  * model to define your own event listeners outside of your applications, and define which methods of your custom listeners
<span class='line'>116</span>  * will listen to certain events. You can register listeners with the target object so that when the target object dispatches
<span class='line'>117</span>  * an event, the listeners get called.&lt;/p>
<span class='line'>118</span>  *
<span class='line'>119</span>  * @example
<span class='line'>120</span>  *      // Simple EventListener snippet that you would use for components that
<span class='line'>121</span>  *      //would dispatch events
<span class='line'>122</span>  *
<span class='line'>123</span>  *      //In the example below SimpleChatModel class would dispatch "historyChange"
<span class='line'>124</span>  *      //event whenever the chat history changes
<span class='line'>125</span>  *      //1) Add an event Listener
<span class='line'>126</span>  *      chatModel.addEventListener("historyChange", this);
<span class='line'>127</span>  *      ....
<span class='line'>128</span>  *      //2)Define your listener. Its function name should match the event type
<span class='line'>129</span>  *      //that it is listening to. So the reaction or actions to the event
<span class='line'>130</span>  *      // "historyChange" would be defined inside the function
<span class='line'>131</span>  *      function historyChange(evt) {
<span class='line'>132</span>  *      	document.form1.histArea.value = evt.target.history; 
<span class='line'>133</span>  *      }
<span class='line'>134</span>  *
<span class='line'>135</span>  * @example
<span class='line'>136</span>  *      //Defining your own CustomEvents.
<span class='line'>137</span>  *      //1) Register your class with the event listener.
<span class='line'>138</span>  *      EventDispatcher.initialize(YourClass);
<span class='line'>139</span>  *
<span class='line'>140</span>  *      //2) Create your custom event with all the necessay information that you
<span class='line'>141</span>  *      //would dispatch and that others would expect.
<span class='line'>142</span>  *      var evt = new Object();
<span class='line'>143</span>  *      evt.type = "EventType";
<span class='line'>144</span>  *      evt.target=evt.currentTarget = this;
<span class='line'>145</span>  *
<span class='line'>146</span>  *      //3) Dispatch Events as you need them using the dispatchEvent method.
<span class='line'>147</span>  *      //The scope of the dispatchEvent method is local.So you would have
<span class='line'>148</span>  *      //to add the "this."
<span class='line'>149</span>  *	this.dispatchEvent(evt);
<span class='line'>150</span>  * @constructor
<span class='line'>151</span>  */</span><span class="WHIT">
<span class='line'>152</span> </span><span class="NAME">EventDispatcher</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>153</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>154</span> 
<span class='line'>155</span> 
<span class='line'>156</span> </span><span class="NAME">EventDispatcher._removeEventListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">queue</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">event</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>157</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>158</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">queue</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>159</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>160</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">queue.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>161</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>162</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>163</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>164</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">queue</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>165</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>166</span> </span><span class="WHIT">				</span><span class="NAME">queue.splice</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>167</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>168</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>169</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>170</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>171</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>172</span> 
<span class='line'>173</span> 
<span class='line'>174</span> </span><span class="COMM">/**
<span class='line'>175</span>  * Register your class that would need to dispatch events to notify other components
<span class='line'>176</span>  * @static
<span class='line'>177</span>  * @function
<span class='line'>178</span>  * @param object the object to receive the methods
<span class='line'>179</span>  * @example EventDispatcher.initialize(YourClass);
<span class='line'>180</span>  */</span><span class="WHIT">
<span class='line'>181</span> </span><span class="NAME">EventDispatcher.initialize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">object</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>182</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>183</span> </span><span class="WHIT">	</span><span class="NAME">object.addEventListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_fEventDispatcher.addEventListener</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>184</span> </span><span class="WHIT">	</span><span class="NAME">object.removeEventListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_fEventDispatcher.removeEventListener</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>185</span> </span><span class="WHIT">	</span><span class="NAME">object.dispatchEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_fEventDispatcher.dispatchEvent</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>186</span> </span><span class="WHIT">	</span><span class="NAME">object.dispatchQueue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_fEventDispatcher.dispatchQueue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>187</span> </span><span class="WHIT">	</span><span class="COMM">//myTrace("Dispatcher initialized " + object + " "+ object.dispatchEvent);</span><span class="WHIT">
<span class='line'>188</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>189</span> 
<span class='line'>190</span> </span><span class="COMM">// internal function for dispatching events</span><span class="WHIT">
<span class='line'>191</span> </span><span class="NAME">EventDispatcher.prototype.dispatchQueue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">queueObj</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">eventObj</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>192</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>193</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">queueName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"__q_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">eventObj.type</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>194</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">queue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">queueObj</span><span class="PUNC">[</span><span class="NAME">queueName</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>195</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">queue</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>196</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>197</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>198</span> </span><span class="WHIT">		</span><span class="COMM">// loop it as an object so it resists people removing listeners during dispatching</span><span class="WHIT">
<span class='line'>199</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">queue</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>200</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>201</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">queue</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>202</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>203</span> </span><span class="WHIT">			
<span class='line'>204</span> 			</span><span class="COMM">// a handler can be a function, object, or movieclip</span><span class="WHIT">
<span class='line'>205</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">oType</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"object"</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">oType</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"movieclip"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>206</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>207</span> </span><span class="WHIT">				</span><span class="COMM">// this is a backdoor implementation that</span><span class="WHIT">
<span class='line'>208</span> </span><span class="WHIT">				</span><span class="COMM">// is not compliant with the standard</span><span class="WHIT">
<span class='line'>209</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o.handleEvent</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>210</span> </span><span class="WHIT">				</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>211</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">[</span><span class="NAME">eventObj.type</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>212</span> </span><span class="WHIT">						</span><span class="NAME">o</span><span class="PUNC">[</span><span class="NAME">eventObj.type</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">eventObj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>213</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>214</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="COMM">// this is the DOM3 way</span><span class="WHIT">
<span class='line'>215</span> </span><span class="WHIT">				</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>216</span> </span><span class="WHIT">					</span><span class="NAME">o.handleEvent</span><span class="PUNC">(</span><span class="NAME">eventObj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>217</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>218</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>219</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="COMM">// it is a function</span><span class="WHIT">
<span class='line'>220</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>221</span> </span><span class="WHIT">				</span><span class="NAME">o.apply</span><span class="PUNC">(</span><span class="NAME">queueObj</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">eventObj</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>222</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>223</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>224</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>225</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>226</span> 
<span class='line'>227</span> </span><span class="COMM">/**
<span class='line'>228</span>  * Dispatches an event into the event flow.
<span class='line'>229</span>  * @function
<span class='line'>230</span>  * @param eventObj an Event or one of its subclasses describing the event
<span class='line'>231</span>  * @example
<span class='line'>232</span>  *      var evt = new Object();
<span class='line'>233</span>  *      evt.type = "EventType";
<span class='line'>234</span>  *      evt.target=evt.currentTarget = this;
<span class='line'>235</span>  *      this.dispatchEvent(evt);
<span class='line'>236</span>  */</span><span class="WHIT">
<span class='line'>237</span> </span><span class="NAME">EventDispatcher.prototype.dispatchEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">eventObj</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>238</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>239</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">eventObj.target</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>240</span> </span><span class="WHIT">		</span><span class="NAME">eventObj.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>241</span> </span><span class="WHIT">	
<span class='line'>242</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">eventObj.type</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"Handler"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>243</span> </span><span class="WHIT">		</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">eventObj.type</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"Handler"</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">eventObj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>244</span> </span><span class="WHIT">	
<span class='line'>245</span> 	</span><span class="COMM">// Dispatch to objects that are registered as listeners for</span><span class="WHIT">
<span class='line'>246</span> </span><span class="WHIT">	</span><span class="COMM">// this object.</span><span class="WHIT">
<span class='line'>247</span> </span><span class="WHIT">	</span><span class="NAME">this.dispatchQueue</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">eventObj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>248</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>249</span> 
<span class='line'>250</span> </span><span class="COMM">/**
<span class='line'>251</span>  * Registers an event listener object with an EventDispatcher model so that the listener receives notification of an event.
<span class='line'>252</span>  * @function
<span class='line'>253</span>  * @param event the name of the event ("click", "change", etc)
<span class='line'>254</span>  * @param the function or object that should be called
<span class='line'>255</span>  * @example chatModel.addEventListener("historyChange", this);
<span class='line'>256</span>  */</span><span class="WHIT">
<span class='line'>257</span> </span><span class="NAME">EventDispatcher.prototype.addEventListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>258</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>259</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">queueName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"__q_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">event</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>260</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">queueName</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>261</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>262</span> </span><span class="WHIT">		</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">queueName</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>263</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>264</span> </span><span class="WHIT">	</span><span class="COMM">//Not supported in asc, it shouldn't matter. _global.ASSetPropFlags(this, queueName,1);</span><span class="WHIT">
<span class='line'>265</span> </span><span class="WHIT">	
<span class='line'>266</span> 	</span><span class="NAME">EventDispatcher._removeEventListener</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">queueName</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">event</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>267</span> </span><span class="WHIT">	</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">queueName</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">handler</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>268</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>269</span> 
<span class='line'>270</span> </span><span class="COMM">/**
<span class='line'>271</span>  * Remove a listener for a particular event
<span class='line'>272</span>  * @function
<span class='line'>273</span>  * @param event the name of the event ("click", "change", etc)
<span class='line'>274</span>  * @param the function or object that should be called
<span class='line'>275</span>  * @example chatModel.removeEventListener("historyChange", this);
<span class='line'>276</span>  */</span><span class="WHIT">
<span class='line'>277</span> </span><span class="NAME">EventDispatcher.prototype.removeEventListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>278</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>279</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">queueName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"__q_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">event</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>280</span> </span><span class="WHIT">	</span><span class="NAME">EventDispatcher._removeEventListener</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">queueName</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">event</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>281</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>282</span> 
<span class='line'>283</span> </span><span class="NAME">_fEventDispatcher</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">EventDispatcher</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>284</span> 
<span class='line'>285</span> 
<span class='line'>286</span> 
<span class='line'>287</span> 
<span class='line'>288</span> 
<span class='line'>289</span> </span><span class="COMM">/**
<span class='line'>290</span>  * @class ConnectSession is responsible to establish a session with LCCS.
<span class='line'>291</span>  * Its the Room's primary session that is passed from the invisible swf. It is responsible for the operation
<span class='line'>292</span>  * of the UserManager class and maintains the UserManager property to access them.
<span class='line'>293</span>  * &lt;table>&lt;tr>&lt;th>&lt;b>Event&lt;/b>&lt;/th>&lt;th>&lt;b>Summary&lt;/b>&lt;/th>&lt;/tr>
<span class='line'>294</span>  * &lt;tr>&lt;td valign="top">&lt;code>SynchronizationChange&lt;/code>&lt;/td> &lt;td>This event is dispatched when the &lt;code>ConnectSession&lt;/code> establishes or loses its connection to the service&lt;/td>&lt;/tr>&lt;/table>
<span class='line'>295</span>  * @param p_bridgeSWF {string} The invisble swf's name that is responsible for the communication with the LCCS
<span class='line'>296</span>  *
<span class='line'>297</span>  * @example
<span class='line'>298</span>  * var cs = new ConnectSession("JSBridge"); //For WebKit based browsers
<span class='line'>299</span>  * @constructor
<span class='line'>300</span>  */</span><span class="WHIT">
<span class='line'>301</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">ConnectSession</span><span class="PUNC">(</span><span class="NAME">p_bridgeSWF</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>302</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>303</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">p_bridgeSWF</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"string"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>304</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">navigator.appName.indexOf</span><span class="PUNC">(</span><span class="STRN">"Microsoft"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>305</span> </span><span class="WHIT">		    </span><span class="NAME">p_bridgeSWF</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">window</span><span class="PUNC">[</span><span class="NAME">p_bridgeSWF</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>306</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>307</span> </span><span class="WHIT">		    </span><span class="NAME">p_bridgeSWF</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document</span><span class="PUNC">[</span><span class="NAME">p_bridgeSWF</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>308</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>309</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>310</span> </span><span class="WHIT">	</span><span class="NAME">this.bridgeSWF</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_bridgeSWF</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>311</span> </span><span class="WHIT">	</span><span class="NAME">ConnectSession.primarySession</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>312</span> </span><span class="WHIT">	</span><span class="NAME">this.userManager</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">UserManager</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>313</span> </span><span class="WHIT">	</span><span class="NAME">this.addEventListener</span><span class="PUNC">(</span><span class="STRN">"swfReady"</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>314</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>315</span> </span><span class="NAME">EventDispatcher.initialize</span><span class="PUNC">(</span><span class="NAME">ConnectSession.prototype</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>316</span> </span><span class="COMM">/**
<span class='line'>317</span>  *The userManager of the room's Primary Connect Session
<span class='line'>318</span>  *@field userManager
<span class='line'>319</span>  */</span><span class="WHIT">
<span class='line'>320</span> </span><span class="NAME">ConnectSession.prototype.userManager</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>321</span> </span><span class="COMM">/**
<span class='line'>322</span>  * (Required) The authenticator through which login information is passed.
<span class='line'>323</span>  * The authenticator object could have any of the following values.
<span class='line'>324</span>  * &lt;ul>
<span class='line'>325</span>  * &lt;li>userName - When &lt;code>authenticationKey&lt;/code> is not used, &lt;code>
<span class='line'>326</span>  * userName&lt;/code> is required upon room entry; when a someone enters as a guest, the name 
<span class='line'>327</span>  * becomes the user's display name.
<span class='line'>328</span>  * &lt;p>
<span class='line'>329</span>  * Two cases are supported: 
<span class='line'>330</span>  * &lt;ul>
<span class='line'>331</span>  * &lt;li>&lt;strong>userName is supplied with no password&lt;/strong>: The user is logged in as 
<span class='line'>332</span>  * viewer and &lt;code>UserDescriptor.displayName&lt;/code> is set to the value in 
<span class='line'>333</span>  * &lt;code>userName&lt;/code>.
<span class='line'>334</span>  * 
<span class='line'>335</span>  * &lt;li>&lt;strong>A username and password are supplied&lt;/strong>: &lt;code>password&lt;/code>
<span class='line'>336</span>  * is only provided when members login with Adobe IDs which is an uncommon case. See below.
<span class='line'>337</span>  * &lt;/ul>&lt;/li>
<span class='line'>338</span>  * &lt;li>password - &lt;code>password&lt;/code> is only required when Adobe IDs
<span class='line'>339</span>  * are used; therefore, it is likely that only developers would need this parameter except
<span class='line'>340</span>  * during development. If used, it is supplied in addition to 
<span class='line'>341</span>  * &lt;code>userName&lt;/code> and permits admitting users as other than a guest. 
<span class='line'>342</span>  * Note that while it is possible for registered Adobe service users to use their Adobe ID, 
<span class='line'>343</span>  * applications will likely leverage LCCS's external authentication capabilities so that 
<span class='line'>344</span>  * &lt;code>authenticationKey&lt;/code> would be used in lieu of a username and
<span class='line'>345</span>  * password.  &lt;/li>
<span class='line'>346</span>  * &lt;li>authenticationURL - Allows a developer to specify the URL of a LCCS-compatible authentication service; 
<span class='line'>347</span>  * it is &lt;strong>not needed&lt;/strong> for many applications.&lt;/li>
<span class='line'>348</span>  * &lt;/ul>
<span class='line'>349</span>  * Code example
<span class='line'>350</span>  * &lt;code>
<span class='line'>351</span>  * 	connectSession.roomURL = "http://connectnow.acrobat.com/accountName/roomName";
<span class='line'>352</span>  * 	var auth = new Object();
<span class='line'>353</span>  * 	auth.userName = "username@xyz.com";
<span class='line'>354</span>  * 	auth.password = "password";
<span class='line'>355</span>  * 	connectSession.authenticator = auth;
<span class='line'>356</span>  * &lt;/code>
<span class='line'>357</span>  *@field userManager
<span class='line'>358</span>  */</span><span class="WHIT">
<span class='line'>359</span> </span><span class="NAME">ConnectSession.prototype.authenticator</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>360</span> </span><span class="COMM">/**
<span class='line'>361</span>  * (Required) The URL of the room to which to connect.
<span class='line'>362</span>  *@field roomURL
<span class='line'>363</span>  */</span><span class="WHIT">
<span class='line'>364</span> </span><span class="NAME">ConnectSession.prototype.roomURL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>365</span> </span><span class="COMM">/**
<span class='line'>366</span>  *@private
<span class='line'>367</span>  */</span><span class="WHIT">
<span class='line'>368</span> </span><span class="NAME">ConnectSession.prototype.swfLoaded</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>369</span> 
<span class='line'>370</span> </span><span class="COMM">/**
<span class='line'>371</span>  *@private
<span class='line'>372</span>  */</span><span class="WHIT">
<span class='line'>373</span> </span><span class="NAME">ConnectSession.prototype.loginFlag</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>374</span> 
<span class='line'>375</span> </span><span class="COMM">/**
<span class='line'>376</span>  *@private
<span class='line'>377</span>  */</span><span class="WHIT">
<span class='line'>378</span> </span><span class="NAME">ConnectSession.prototype.subscribeCollection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_collection</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>379</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>380</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.collections</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>381</span> </span><span class="WHIT">		</span><span class="NAME">this.collections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>382</span> </span><span class="WHIT">		</span><span class="NAME">this.collections</span><span class="PUNC">[</span><span class="NAME">p_collection.sharedID</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_collection</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>383</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>384</span> </span><span class="WHIT">		</span><span class="NAME">this.collections</span><span class="PUNC">[</span><span class="NAME">p_collection.sharedID</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_collection</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>385</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>386</span> </span><span class="WHIT">	</span><span class="COMM">//this.bridgeSWF.RTCIncoming("CollectionNode", "subscribeCollection", p_collection.sharedID)</span><span class="WHIT">
<span class='line'>387</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>388</span> </span><span class="WHIT">	</span><span class="NAME">args.sharedID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_collection.sharedID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>389</span> </span><span class="WHIT">	</span><span class="NAME">this.callLCCSMethod</span><span class="PUNC">(</span><span class="STRN">"CollectionNode"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"subscribeCollection"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>390</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>391</span> 
<span class='line'>392</span> </span><span class="COMM">/**
<span class='line'>393</span>  *@private
<span class='line'>394</span>  */</span><span class="WHIT">
<span class='line'>395</span> </span><span class="NAME">ConnectSession.prototype.publishItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_collection</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_messageItem</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>396</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>397</span> </span><span class="WHIT">	</span><span class="COMM">//this.bridgeSWF.RTCIncoming("CollectionNode", "publishItem", p_collection.sharedID, p_messageItem)</span><span class="WHIT">
<span class='line'>398</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>399</span> </span><span class="WHIT">	</span><span class="NAME">args.sharedID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_collection.sharedID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>400</span> </span><span class="WHIT">	</span><span class="NAME">args.messageItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_messageItem</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>401</span> </span><span class="WHIT">	</span><span class="NAME">this.callLCCSMethod</span><span class="PUNC">(</span><span class="STRN">"CollectionNode"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"publishItem"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>402</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>403</span> 
<span class='line'>404</span> </span><span class="COMM">/**
<span class='line'>405</span>  *@private
<span class='line'>406</span>  */</span><span class="WHIT">
<span class='line'>407</span> </span><span class="NAME">ConnectSession.prototype.swfReady</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>408</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>409</span> </span><span class="WHIT">	</span><span class="NAME">this.swfLoaded</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>410</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.loginFlag</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>411</span> </span><span class="WHIT">		</span><span class="NAME">this.loginFlag</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>412</span> </span><span class="WHIT">		</span><span class="NAME">this.login</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>413</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>414</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>415</span> 
<span class='line'>416</span> </span><span class="COMM">/**
<span class='line'>417</span> * Logs into the RTC service. Calling login is required for using ConnectSession, as compared with ConnectSessionContainer,
<span class='line'>418</span> * Which does so automatically.
<span class='line'>419</span> * @function
<span class='line'>420</span> */</span><span class="WHIT">
<span class='line'>421</span> </span><span class="NAME">ConnectSession.prototype.login</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>422</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.authenticator</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.roomURL</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>423</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.swfLoaded</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>424</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">roomURL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>425</span> </span><span class="WHIT">			</span><span class="NAME">roomURL.roomURL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.roomURL</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>426</span> </span><span class="WHIT">			</span><span class="NAME">this.callLCCSMethod</span><span class="PUNC">(</span><span class="STRN">"ConnectSession"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setRoomURL"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">roomURL</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>427</span> </span><span class="WHIT">			</span><span class="NAME">this.callLCCSMethod</span><span class="PUNC">(</span><span class="STRN">"ConnectSession"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setAuthenticator"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.authenticator</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>428</span> </span><span class="WHIT">			</span><span class="NAME">this.callLCCSMethod</span><span class="PUNC">(</span><span class="STRN">"ConnectSession"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"login"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>429</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>430</span> </span><span class="WHIT">			</span><span class="NAME">this.loginFlag</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>431</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>432</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>433</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>434</span> 
<span class='line'>435</span> </span><span class="COMM">/**
<span class='line'>436</span>  * Logs out and disconnects from the session.
<span class='line'>437</span>  * @function
<span class='line'>438</span>  */</span><span class="WHIT">
<span class='line'>439</span> </span><span class="NAME">ConnectSession.prototype.logout</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>440</span> </span><span class="WHIT">	</span><span class="NAME">this.callLCCSMethod</span><span class="PUNC">(</span><span class="STRN">"ConnectSession"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"logout"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>441</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>442</span> 
<span class='line'>443</span> </span><span class="COMM">/**
<span class='line'>444</span>  * Disposes all listeners to the network and framework classes.
<span class='line'>445</span>  * @function
<span class='line'>446</span>  */</span><span class="WHIT">
<span class='line'>447</span> </span><span class="NAME">ConnectSession.prototype.close</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>448</span> </span><span class="WHIT">	</span><span class="NAME">this.callLCCSMethod</span><span class="PUNC">(</span><span class="STRN">"ConnectSession"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"close"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>449</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>450</span> 
<span class='line'>451</span> </span><span class="COMM">/**
<span class='line'>452</span>  * A function that indicates whether or not the ConnectSession is fully synchronized with the service.
<span class='line'>453</span>  * @function
<span class='line'>454</span>  */</span><span class="WHIT">
<span class='line'>455</span> </span><span class="NAME">ConnectSession.prototype.isSynchronized</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>456</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.LCCSReady</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>457</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>458</span> 
<span class='line'>459</span> </span><span class="COMM">/**
<span class='line'>460</span>  *@private
<span class='line'>461</span>  */</span><span class="WHIT">
<span class='line'>462</span> </span><span class="NAME">ConnectSession.prototype.callLCCSMethod</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_className</span><span class="PUNC">,</span><span class="NAME">p_methodName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_methodArgs</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>463</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>464</span> </span><span class="WHIT">	</span><span class="NAME">this.bridgeSWF.RTCIncoming</span><span class="PUNC">(</span><span class="NAME">p_className</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_methodName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_methodArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>465</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>466</span> 
<span class='line'>467</span> </span><span class="COMM">/**
<span class='line'>468</span>  *@private
<span class='line'>469</span>  */</span><span class="WHIT">
<span class='line'>470</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">UserDescriptor</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>471</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>472</span> </span><span class="WHIT">	
<span class='line'>473</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>474</span> </span><span class="COMM">/**
<span class='line'>475</span>  *@private
<span class='line'>476</span>  */</span><span class="WHIT">
<span class='line'>477</span> </span><span class="NAME">UserDescriptor.prototype.userID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>478</span> </span><span class="COMM">/**
<span class='line'>479</span>  *@private
<span class='line'>480</span>  */</span><span class="WHIT">
<span class='line'>481</span> </span><span class="NAME">UserDescriptor.prototype.displayName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>482</span> </span><span class="COMM">/**
<span class='line'>483</span>  *@private
<span class='line'>484</span>  */</span><span class="WHIT">
<span class='line'>485</span> </span><span class="NAME">UserDescriptor.prototype.role</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>486</span> </span><span class="COMM">/**
<span class='line'>487</span>  *@private
<span class='line'>488</span>  */</span><span class="WHIT">
<span class='line'>489</span> </span><span class="NAME">UserDescriptor.prototype.affiliation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>490</span> </span><span class="COMM">/**
<span class='line'>491</span>  *@private
<span class='line'>492</span>  */</span><span class="WHIT">
<span class='line'>493</span> </span><span class="NAME">UserDescriptor.prototype.connection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>494</span> </span><span class="COMM">/**
<span class='line'>495</span>  *@private
<span class='line'>496</span>  */</span><span class="WHIT">
<span class='line'>497</span> </span><span class="NAME">UserDescriptor.prototype.usericonURL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>498</span> </span><span class="COMM">/**
<span class='line'>499</span>  *@private
<span class='line'>500</span>  */</span><span class="WHIT">
<span class='line'>501</span> </span><span class="NAME">UserDescriptor.prototype.playerVersion</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>502</span> </span><span class="COMM">/**
<span class='line'>503</span>  *@private
<span class='line'>504</span>  */</span><span class="WHIT">
<span class='line'>505</span> </span><span class="NAME">UserDescriptor.prototype.isPeer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>506</span> </span><span class="COMM">/**
<span class='line'>507</span>  *@private
<span class='line'>508</span>  */</span><span class="WHIT">
<span class='line'>509</span> </span><span class="NAME">UserDescriptor.prototype.isRTMFP</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>510</span> 
<span class='line'>511</span> </span><span class="COMM">/**
<span class='line'>512</span>  *@private
<span class='line'>513</span>  */</span><span class="WHIT">
<span class='line'>514</span> </span><span class="NAME">UserDescriptor.prototype.setValues</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">usrDescObj</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>515</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>516</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">usrDescObj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>517</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">UserDescriptor.prototype.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>518</span> </span><span class="WHIT">			</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">usrDescObj</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>519</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>520</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>521</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>522</span> 
<span class='line'>523</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">MessageItem</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>524</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>525</span> </span><span class="WHIT">	
<span class='line'>526</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>527</span> </span><span class="COMM">//MessageItem.prototype.SINGLE_ITEM_ID = "item";</span><span class="WHIT">
<span class='line'>528</span> </span><span class="NAME">MessageItem.prototype.nodeName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>529</span> </span><span class="NAME">MessageItem.prototype.itemID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>530</span> </span><span class="NAME">MessageItem.prototype.body</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>531</span> </span><span class="NAME">MessageItem.prototype.publisherID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>532</span> </span><span class="NAME">MessageItem.prototype.associatedUserID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>533</span> </span><span class="NAME">MessageItem.prototype.recipientID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>534</span> </span><span class="NAME">MessageItem.prototype.recipientIDs</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>535</span> </span><span class="NAME">MessageItem.prototype.timeStamp</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>536</span> </span><span class="NAME">MessageItem.prototype.collectionName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>537</span> 
<span class='line'>538</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">NodeConfiguration</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>539</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>540</span> </span><span class="WHIT">	
<span class='line'>541</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>542</span> 
<span class='line'>543</span> </span><span class="NAME">NodeConfiguration.prototype.accessModel</span><span class="PUNC">=</span><span class="NUMB">10</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>544</span> </span><span class="NAME">NodeConfiguration.prototype.publishModel</span><span class="PUNC">=</span><span class="NUMB">50</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>545</span> </span><span class="NAME">NodeConfiguration.prototype.persistItems</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>546</span> </span><span class="NAME">NodeConfiguration.prototype.modifyAnyItem</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>547</span> </span><span class="NAME">NodeConfiguration.prototype.userDependentItems</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>548</span> </span><span class="NAME">NodeConfiguration.prototype.sessionDependentItems</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>549</span> </span><span class="NAME">NodeConfiguration.prototype.itemStorageScheme</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>550</span> </span><span class="NAME">NodeConfiguration.prototype.allowPrivateMessages</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>551</span> </span><span class="NAME">NodeConfiguration.prototype.lazySubscription</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>552</span> </span><span class="NAME">NodeConfiguration.prototype.p2pDataMessaging</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>553</span> 
<span class='line'>554</span> </span><span class="COMM">/**
<span class='line'>555</span>  * @class UserManager is one of the "four pillars" of a room and is tasked with maintaining a list of the set of users in the room, along with their descriptors.
<span class='line'>556</span>  * It is also the primary class through which one publishes changes to a user role or other user information.
<span class='line'>557</span>  * &lt;table>&lt;tr>&lt;th>&lt;b>Event&lt;/b>&lt;/th>&lt;th>&lt;b>Summary&lt;/b>&lt;/th>&lt;/tr>
<span class='line'>558</span>  * &lt;tr>&lt;td valign="top">&lt;code>anonymousPresenceChange &lt;/code>&lt;/td> &lt;td>	 Dispatched when anonymousPresence is set in the UserManager  &lt;/td>&lt;/tr>
<span class='line'>559</span>  * &lt;tr>&lt;td valign="top">&lt;code>customFieldChange&lt;/code>&lt;/td> &lt;td> Dispatched when a custom field value for a user has changed. &lt;/td>&lt;/tr>
<span class='line'>560</span>  * &lt;tr>&lt;td valign="top">&lt;code>customFieldDelete&lt;/code>&lt;/td> &lt;td> Dispatched when a custom field for a user is deleted. &lt;/td>&lt;/tr>
<span class='line'>561</span>  * &lt;tr>&lt;td valign="top">&lt;code>customFieldRegister&lt;/code>&lt;/td> &lt;td> Dispatched when a custom field for a user is registered. &lt;/td>&lt;/tr>
<span class='line'>562</span>  * &lt;tr>&lt;td valign="top">&lt;code>synchronizationChange&lt;/code>&lt;/td> &lt;td> Dispatched when the UserManager has received everything up to the current state of the room or has lost the connection. &lt;/td>&lt;/tr>
<span class='line'>563</span>  * &lt;tr>&lt;td valign="top">&lt;code>userBooted&lt;/code>&lt;/td> &lt;td> Dispatched when a user is forcibly ejected from the room.  &lt;/td>&lt;/tr>
<span class='line'>564</span>  * &lt;tr>&lt;td valign="top">&lt;code>userConnectionChange&lt;/code>&lt;/td> &lt;td> Dispatched when a user's connection speed has changed. &lt;/td>&lt;/tr>
<span class='line'>565</span>  * &lt;tr>&lt;td valign="top">&lt;code>userCreate&lt;/code>&lt;/td> &lt;td> Dispatched when a new user joins the room. &lt;/td>&lt;/tr>
<span class='line'>566</span>  * &lt;tr>&lt;td valign="top">&lt;code>userNameChange&lt;/code>&lt;/td> &lt;td> Dispatched when the user's displayName has changed. &lt;/td>&lt;/tr>
<span class='line'>567</span>  * &lt;tr>&lt;td valign="top">&lt;code>userPingDataChange&lt;/code>&lt;/td> &lt;td> Dispatched when a user's ping data has changed. &lt;/td>&lt;/tr>
<span class='line'>568</span>  * &lt;tr>&lt;td valign="top">&lt;code>userRemove&lt;/code>&lt;/td> &lt;td> Dispatched when a user leaves the room. &lt;/td>&lt;/tr>
<span class='line'>569</span>  * &lt;tr>&lt;td valign="top">&lt;code>userRoleChange&lt;/code>&lt;/td> &lt;td> Dispatched when the user's role has changed. &lt;/td>&lt;/tr>
<span class='line'>570</span>  * &lt;tr>&lt;td valign="top">&lt;code>userUsericonURLChange&lt;/code>&lt;/td> &lt;td> Dispatched when a user's icon URL has changed. &lt;/td>&lt;/tr>
<span class='line'>571</span>  * &lt;/table>
<span class='line'>572</span>  * @constructor
<span class='line'>573</span>  */</span><span class="WHIT">
<span class='line'>574</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">UserManager</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>575</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>576</span> </span><span class="WHIT">	</span><span class="COMM">//Mention the fact that UserManager is not exactly a symmetrical copy of SDK's UserManager</span><span class="WHIT">
<span class='line'>577</span> </span><span class="WHIT">	</span><span class="COMM">//While setting some properties, there is a possibility of a user not able to set some properties</span><span class="WHIT">
<span class='line'>578</span> </span><span class="WHIT">	</span><span class="COMM">//So should set properties only if you are the room Owner</span><span class="WHIT">
<span class='line'>579</span> </span><span class="WHIT">	
<span class='line'>580</span> 	</span><span class="COMM">//Flexible rights can be future upgrade. This would require some SDK changes as well</span><span class="WHIT">
<span class='line'>581</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>582</span> 
<span class='line'>583</span> </span><span class="NAME">EventDispatcher.initialize</span><span class="PUNC">(</span><span class="NAME">UserManager.prototype</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>584</span> 
<span class='line'>585</span> </span><span class="COMM">/**
<span class='line'>586</span>  *Determines whether all the others users in the room be revealed. Upon setting this property to true, users aren't revealed until explicitly called for.
<span class='line'>587</span>  *UserManager.userCollection and getUserDescriptor won't have any entry for any user (other than one's self) unless there's a specific request for that user.
<span class='line'>588</span>  *Any call to the getUserDescriptor will cause the UserManager to fetch that particular UserDescriptor and cache it, dispatching the usual userCreate event. 
<span class='line'>589</span>  *@field
<span class='line'>590</span>  */</span><span class="WHIT">
<span class='line'>591</span> </span><span class="NAME">UserManager.prototype.anonymousPresence</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>592</span> </span><span class="COMM">/**
<span class='line'>593</span>  *An array of userIDs, which represents the set of users which might be listening for the current user's updates
<span class='line'>594</span>  *Note, this isn't the set of users the current user is listening for, but rather the inverse.
<span class='line'>595</span>  *The current user would notify users in the Array about all his activities. In other words the users in the Array users are listening to the current user even if he is not listening to them. 
<span class='line'>596</span>  *@field
<span class='line'>597</span>  */</span><span class="WHIT">
<span class='line'>598</span> </span><span class="NAME">UserManager.prototype.myBuddyList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>599</span> </span><span class="COMM">/**
<span class='line'>600</span>  *The current user's userID. 
<span class='line'>601</span>  *@field
<span class='line'>602</span>  */</span><span class="WHIT">
<span class='line'>603</span> </span><span class="NAME">UserManager.prototype.myUserID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>604</span> </span><span class="COMM">/**
<span class='line'>605</span>  *THe current user's userTicket
<span class='line'>606</span>  *@private 
<span class='line'>607</span>  *@field
<span class='line'>608</span>  */</span><span class="WHIT">
<span class='line'>609</span> </span><span class="NAME">UserManager.prototype.myTicket</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>610</span> </span><span class="COMM">/**
<span class='line'>611</span>  *Specifies the current user's affiliation. 
<span class='line'>612</span>  *@field
<span class='line'>613</span>  */</span><span class="WHIT">
<span class='line'>614</span> </span><span class="NAME">UserManager.prototype.myUserAffiliation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>615</span> </span><span class="COMM">/**
<span class='line'>616</span>  *Specifies the current user's role
<span class='line'>617</span>  *@field
<span class='line'>618</span>  */</span><span class="WHIT">
<span class='line'>619</span> </span><span class="NAME">UserManager.prototype.myUserRole</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>620</span> </span><span class="COMM">/**
<span class='line'>621</span>  *This field is set if anyone has peer to peer disabled. i.e. behind firewall or something...
<span class='line'>622</span>  *@field
<span class='line'>623</span>  */</span><span class="WHIT">
<span class='line'>624</span> </span><span class="NAME">UserManager.prototype.isPeerEnable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>625</span> </span><span class="COMM">/**
<span class='line'>626</span>  *Returns a sorted collection of user descriptors with root user roles of UserRoles.VIEWER (10).
<span class='line'>627</span>  *@field
<span class='line'>628</span>  */</span><span class="WHIT">
<span class='line'>629</span> </span><span class="NAME">UserManager.prototype.audienceCollection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>630</span> </span><span class="COMM">/**
<span class='line'>631</span>  *Returns a sorted collection of user descriptors with root user roles of UserRoles.OWNER (100).
<span class='line'>632</span>  *@field
<span class='line'>633</span>  */</span><span class="WHIT">
<span class='line'>634</span> </span><span class="NAME">UserManager.prototype.hostCollection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>635</span> </span><span class="COMM">/**
<span class='line'>636</span>  *Returns a sorted collection of user descriptors with root user roles of UserRoles.PUBLISHER (50).
<span class='line'>637</span>  *@field
<span class='line'>638</span>  */</span><span class="WHIT">
<span class='line'>639</span> </span><span class="NAME">UserManager.prototype.participantCollection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>640</span> </span><span class="COMM">/**
<span class='line'>641</span>  *internal storage for the entire set of users (hashed by userID)
<span class='line'>642</span>  *@private
<span class='line'>643</span>  *@field
<span class='line'>644</span>  */</span><span class="WHIT">
<span class='line'>645</span> </span><span class="NAME">UserManager.prototype.userDescriptorTable</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>646</span> </span><span class="COMM">/**
<span class='line'>647</span>  *Specifies whether or not the UserManager has connected and has synchronized all of the user information from the service.
<span class='line'>648</span>  *The userManager of the room's Primary Connect Session
<span class='line'>649</span>  *@field
<span class='line'>650</span>  */</span><span class="WHIT">
<span class='line'>651</span> </span><span class="NAME">UserManager.prototype.isSynchronized</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>652</span> </span><span class="COMM">/**
<span class='line'>653</span>  *Returns the list of all the custom fields created.
<span class='line'>654</span>  *@field
<span class='line'>655</span>  */</span><span class="WHIT">
<span class='line'>656</span> </span><span class="NAME">UserManager.prototype.customFieldNames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>657</span> </span><span class="COMM">/**
<span class='line'>658</span>  *Used to recreate the UserManager once the ConnectSession.primarySession's userManager is synchronized
<span class='line'>659</span>  *@function
<span class='line'>660</span>  *@private
<span class='line'>661</span>  */</span><span class="WHIT">
<span class='line'>662</span> </span><span class="NAME">UserManager.prototype.initialize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">usrObj</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>663</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>664</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">usrObj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>665</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">UserManager.prototype.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>666</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"audienceCollection"</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"hostCollection"</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"participantCollection"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>667</span> </span><span class="WHIT">				</span><span class="COMM">//Might have to translate the values in the collection to UserDescriptor.</span><span class="WHIT">
<span class='line'>668</span> </span><span class="WHIT">				</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.objectValuesToUserDescriptorUtility</span><span class="PUNC">(</span><span class="NAME">usrObj</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>669</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>670</span> </span><span class="WHIT">				</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">usrObj</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>671</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>672</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>673</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>674</span> </span><span class="WHIT">	</span><span class="NAME">this.isSynchronized</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>675</span> </span><span class="WHIT">	</span><span class="COMM">//myTrace("Just stopping to examine");</span><span class="WHIT">
<span class='line'>676</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>677</span> 
<span class='line'>678</span> </span><span class="COMM">/**
<span class='line'>679</span>  *@private
<span class='line'>680</span>  */</span><span class="WHIT">
<span class='line'>681</span> </span><span class="NAME">UserManager.prototype.objectValuesToUserDescriptorUtility</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">usrCollection</span><span class="PUNC">,</span><span class="NAME">keyString</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>682</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>683</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">usrObj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>684</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">usrCollection</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>685</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">usrDesc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">UserDescriptor</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>686</span> </span><span class="WHIT">		</span><span class="NAME">usrDesc.setValues</span><span class="PUNC">(</span><span class="NAME">usrCollection</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>687</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">usrID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">usrDesc.userID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>688</span> </span><span class="WHIT">		</span><span class="COMM">//usrCollection[usrID] = usrDesc;</span><span class="WHIT">
<span class='line'>689</span> </span><span class="WHIT">		</span><span class="NAME">usrObj</span><span class="PUNC">[</span><span class="NAME">usrID</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">usrDesc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>690</span> </span><span class="WHIT">		</span><span class="NAME">this.userDescriptorTable</span><span class="PUNC">[</span><span class="NAME">usrID</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">usrDesc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>691</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>692</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">usrObj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>693</span> </span><span class="WHIT">	</span><span class="COMM">//this[keyString] = usrObj;</span><span class="WHIT">
<span class='line'>694</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>695</span> 
<span class='line'>696</span> </span><span class="COMM">/**
<span class='line'>697</span>  *Set whether other users in the room should be revealed or not.
<span class='line'>698</span>  *@param p_anonymousPresence {boolean}
<span class='line'>699</span>  *@function
<span class='line'>700</span>  */</span><span class="WHIT">
<span class='line'>701</span> </span><span class="NAME">UserManager.prototype.setAnonymousPresence</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_anonymousPresence</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>702</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>703</span> </span><span class="WHIT">	</span><span class="COMM">//Set the local value of the anonymousPresence once it is set on the server</span><span class="WHIT">
<span class='line'>704</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.anonymousPresence</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">p_anonymousPresence</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.myUserRole</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">50</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.isSynchronized</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>705</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>706</span> </span><span class="WHIT">		</span><span class="NAME">args.anonymousPresence</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_anonymousPresence</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>707</span> </span><span class="WHIT">		</span><span class="NAME">this.connectSession.callLCCSMethod</span><span class="PUNC">(</span><span class="STRN">"UserManager"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setAnonymousPresence"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>708</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>709</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>710</span> 
<span class='line'>711</span> </span><span class="COMM">/**
<span class='line'>712</span>  *An array of userIDs, which represents the set of users which might be listening for the current user's updates Note, this isn't the set of users the current user is listening for, but rather the inverse.
<span class='line'>713</span>  *@param p_buddyList {array} List of buddies with their userId's
<span class='line'>714</span>  *@function
<span class='line'>715</span>  */</span><span class="WHIT">
<span class='line'>716</span> </span><span class="NAME">UserManager.prototype.setMyBuddyList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_buddyList</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>717</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>718</span> </span><span class="WHIT">	</span><span class="COMM">//Set the local value of the anonymousPresence once it is set on the server</span><span class="WHIT">
<span class='line'>719</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.myUserRole</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">50</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.isSynchronized</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>720</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>721</span> </span><span class="WHIT">		</span><span class="NAME">args.buddyList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_buddyList</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>722</span> </span><span class="WHIT">		</span><span class="NAME">this.connectSession.callLCCSMethod</span><span class="PUNC">(</span><span class="STRN">"UserManager"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setMyBuddyList"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>723</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>724</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>725</span> 
<span class='line'>726</span> 
<span class='line'>727</span> 
<span class='line'>728</span> </span><span class="COMM">/**
<span class='line'>729</span>  * Fetches all available details about the specified user. If &lt;code>anonymousPresence&lt;/code> is set to true,
<span class='line'>730</span>  * the method migth return a null if &lt;code>UserDescriptor&lt;/code> was never fetched. In such a situation we must
<span class='line'>731</span>  * listen to &lt;code>UserEvent.USER_CREATE&lt;/code> event and update the User's  &lt;code>UserDescriptor&lt;/code> we wanted.
<span class='line'>732</span>  * 
<span class='line'>733</span>  * Note: If the &lt;code>UserManager.anonymousPresence&lt;/code> is set to true, then this method might fail if the
<span class='line'>734</span>  * user's userDescriptor has not been fetched. So it is adviced to call this method after the required userDescriptor's
<span class='line'>735</span>  * are fetched.In other words listen to &lt;code>UserEvent.USER_CREATE&lt;/code> event and call this method after the required
<span class='line'>736</span>  * userDescriptor's are fetched.
<span class='line'>737</span>  * @function
<span class='line'>738</span>  * @param p_userID The unique ID of the user being queried.
<span class='line'>739</span>  * @return The UserDescriptor of the specified user if &lt;code>anonymousPresence&lt;/code> were false.
<span class='line'>740</span>  */</span><span class="WHIT">
<span class='line'>741</span> </span><span class="NAME">UserManager.prototype.getUserDescriptor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>742</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>743</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.userDescriptorTable</span><span class="PUNC">[</span><span class="NAME">p_userID</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>744</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.userDescriptorTable</span><span class="PUNC">[</span><span class="NAME">p_userID</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>745</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>746</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.anonymousPresence</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>747</span> </span><span class="WHIT">			</span><span class="COMM">//fetchUserDescriptor(p_userID);</span><span class="WHIT">
<span class='line'>748</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>749</span> </span><span class="WHIT">			</span><span class="NAME">args.userID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_userID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>750</span> </span><span class="WHIT">			</span><span class="NAME">this.connectSession.callLCCSMethod</span><span class="PUNC">(</span><span class="STRN">"UserManager"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"getUserDescriptor"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>751</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>752</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>753</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">		
<span class='line'>754</span> 		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>755</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>756</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>757</span> 
<span class='line'>758</span> </span><span class="COMM">/**
<span class='line'>759</span>  * Promotes or demotes the specified user at the "root level". This is the primary 
<span class='line'>760</span>  * way to change a user's role (although it's also possible to change a user's role relative 
<span class='line'>761</span>  * to a specific CollectionNode within the application). Note that only users with an owner 
<span class='line'>762</span>  * role  at the root level may call this method.
<span class='line'>763</span>  * 
<span class='line'>764</span>  * @param p_userID The unique ID of the user to affect
<span class='line'>765</span>  * @param p_role The new role for the user
<span class='line'>766</span>  * @function
<span class='line'>767</span>  */</span><span class="WHIT">
<span class='line'>768</span> </span><span class="NAME">UserManager.prototype.setUserRole</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_userRole</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>769</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>770</span> </span><span class="WHIT">	</span><span class="COMM">//Set the local value of the userRole once it is set on the server</span><span class="WHIT">
<span class='line'>771</span> </span><span class="WHIT">	</span><span class="COMM">//Talk to nigel abt dual or conflicting userRoles ie a guy who can</span><span class="WHIT">
<span class='line'>772</span> </span><span class="WHIT">	</span><span class="COMM">//configure usrMgr alone but his general role is less than the owner or</span><span class="WHIT">
<span class='line'>773</span> </span><span class="WHIT">	</span><span class="COMM">//publisher</span><span class="WHIT">
<span class='line'>774</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.myUserRole</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">50</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.myUserAffiliation</span><span class="PUNC">==</span><span class="NUMB">100</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">p_userID</span><span class="PUNC">==</span><span class="NAME">this.myUserID</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>775</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>776</span> </span><span class="WHIT">		</span><span class="NAME">args.userID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_userID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>777</span> </span><span class="WHIT">		</span><span class="NAME">args.role</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_userRole</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>778</span> </span><span class="WHIT">		</span><span class="NAME">this.connectSession.callLCCSMethod</span><span class="PUNC">(</span><span class="STRN">"UserManager"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setUserRole"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>779</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>780</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>781</span> 
<span class='line'>782</span> </span><span class="COMM">/**
<span class='line'>783</span>  * Gets the role of the specified user for a particular node. 
<span class='line'>784</span>  * 
<span class='line'>785</span>  * @param p_userID The specified user's &lt;code>userID&lt;/code>.
<span class='line'>786</span>  * @return int which is the user role value
<span class='line'>787</span>  * @function
<span class='line'>788</span>  */</span><span class="WHIT">
<span class='line'>789</span> </span><span class="NAME">UserManager.prototype.getUserRole</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>790</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>791</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.userDescriptorTable</span><span class="PUNC">[</span><span class="NAME">p_userID</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">  </span><span class="NAME">this.isSynchronized</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>792</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.userDescriptorTable</span><span class="PUNC">[</span><span class="NAME">p_userID</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">role</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>793</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>794</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>795</span> 
<span class='line'>796</span> 
<span class='line'>797</span> </span><span class="COMM">/**
<span class='line'>798</span>  * Modifies the displayName of a given user. Note that only OWNERs and the user in question are able to 
<span class='line'>799</span>  * change the user's displayName.
<span class='line'>800</span>  * 
<span class='line'>801</span>  * Note: If the &lt;code>UserManager.anonymousPresence&lt;/code> is set to true, then this method might fail if the
<span class='line'>802</span>  * user's userDescriptor has not been fetched. So it is adviced to call this method after the required userDescriptor's
<span class='line'>803</span>  * are fetched.In other words listen to &lt;code>UserEvent.USER_CREATE&lt;/code> event and call this method after the required
<span class='line'>804</span>  * userDescriptor's are fetched.
<span class='line'>805</span>  * 
<span class='line'>806</span>  * @param p_userID The userID of the specified user
<span class='line'>807</span>  * @param p_name The new displayName to assign to that user
<span class='line'>808</span>  * @function
<span class='line'>809</span>  */</span><span class="WHIT">
<span class='line'>810</span> </span><span class="NAME">UserManager.prototype.setUserDisplayName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="NAME">p_name</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>811</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>812</span> </span><span class="WHIT">	</span><span class="COMM">//Ensure u have the right priviliges.</span><span class="WHIT">
<span class='line'>813</span> </span><span class="WHIT">	
<span class='line'>814</span> 	</span><span class="COMM">//Set the local value of the userRole once it is set on the server</span><span class="WHIT">
<span class='line'>815</span> </span><span class="WHIT">	</span><span class="COMM">//Talk to nigel abt dual or conflicting userRoles ie a guy who can</span><span class="WHIT">
<span class='line'>816</span> </span><span class="WHIT">	</span><span class="COMM">//configure usrMgr alone but his general role is less than the owner or</span><span class="WHIT">
<span class='line'>817</span> </span><span class="WHIT">	</span><span class="COMM">//publisher</span><span class="WHIT">
<span class='line'>818</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.myUserRole</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">50</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">  </span><span class="NAME">this.isSynchronized</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>819</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>820</span> </span><span class="WHIT">		</span><span class="NAME">args.userID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_userID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>821</span> </span><span class="WHIT">		</span><span class="NAME">args.name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>822</span> </span><span class="WHIT">		</span><span class="NAME">this.connectSession.callLCCSMethod</span><span class="PUNC">(</span><span class="STRN">"UserManager"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setUserDisplayName"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>823</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>824</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>825</span> 
<span class='line'>826</span> </span><span class="COMM">/**
<span class='line'>827</span>  * Modifies the isPeer property of a given user. Note that only OWNERs and the user in question are able to 
<span class='line'>828</span>  * change the user's displayName. This shows whether an user can do p2p streaming.
<span class='line'>829</span>  * @param p_userID The userID of the specified user
<span class='line'>830</span>  * @param p_name The new displayName to assign to that user
<span class='line'>831</span>  * @function
<span class='line'>832</span>  */</span><span class="WHIT">
<span class='line'>833</span> </span><span class="NAME">UserManager.prototype.setPeer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="NAME">p_isPeer</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>834</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>835</span> </span><span class="WHIT">	</span><span class="COMM">//Ensure u have the right priviliges.</span><span class="WHIT">
<span class='line'>836</span> </span><span class="WHIT">	
<span class='line'>837</span> 	</span><span class="COMM">//Set the local value of the userRole once it is set on the server</span><span class="WHIT">
<span class='line'>838</span> </span><span class="WHIT">	</span><span class="COMM">//Talk to nigel abt dual or conflicting userRoles ie a guy who can</span><span class="WHIT">
<span class='line'>839</span> </span><span class="WHIT">	</span><span class="COMM">//configure usrMgr alone but his general role is less than the owner or</span><span class="WHIT">
<span class='line'>840</span> </span><span class="WHIT">	</span><span class="COMM">//publisher	</span><span class="WHIT">
<span class='line'>841</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.myUserRole</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">50</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">  </span><span class="NAME">this.isSynchronized</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>842</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>843</span> </span><span class="WHIT">		</span><span class="NAME">args.userID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_userID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>844</span> </span><span class="WHIT">		</span><span class="NAME">args.isPeer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_isPeer</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>845</span> </span><span class="WHIT">		</span><span class="NAME">this.connectSession.callLCCSMethod</span><span class="PUNC">(</span><span class="STRN">"UserManager"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setPeer"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>846</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>847</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>848</span> 
<span class='line'>849</span> 
<span class='line'>850</span> </span><span class="COMM">/**
<span class='line'>851</span>  * Sets the URL for the user's avatar icon.
<span class='line'>852</span>  * 
<span class='line'>853</span>  * Note: If the &lt;code>UserManager.anonymousPresence&lt;/code> is set to true, then this method might fail if the
<span class='line'>854</span>  * user's userDescriptor has not been fetched. So it is adviced to call this method after the required userDescriptor's
<span class='line'>855</span>  * are fetched.In other words listen to &lt;code>UserEvent.USER_CREATE&lt;/code> event and call this method after the required
<span class='line'>856</span>  * userDescriptor's are fetched.
<span class='line'>857</span>  * 
<span class='line'>858</span>  * @param p_userID The userID of the user specified.
<span class='line'>859</span>  * @param p_usericonURL the URL of the icon desired.
<span class='line'>860</span>  * @function
<span class='line'>861</span>  */</span><span class="WHIT">
<span class='line'>862</span> </span><span class="NAME">UserManager.prototype.setUserUsericonURL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="NAME">p_usericonURL</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>863</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>864</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.myUserRole</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">50</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">  </span><span class="NAME">this.isSynchronized</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>865</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>866</span> </span><span class="WHIT">		</span><span class="NAME">args.userID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_userID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>867</span> </span><span class="WHIT">		</span><span class="NAME">args.usericonURL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_usericonURL</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>868</span> </span><span class="WHIT">		</span><span class="NAME">this.connectSession.callLCCSMethod</span><span class="PUNC">(</span><span class="STRN">"UserManager"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setUserUsericonURL"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>869</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>870</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>871</span> 
<span class='line'>872</span> 
<span class='line'>873</span> </span><span class="COMM">/**
<span class='line'>874</span>  * Publishes a ping data update.
<span class='line'>875</span>  * @param p_userID The userID of the user to update.
<span class='line'>876</span>  * @param p_latency The new latency statistic.
<span class='line'>877</span>  * @param p_drops The new drops statistic.
<span class='line'>878</span>  * @function
<span class='line'>879</span>  */</span><span class="WHIT">
<span class='line'>880</span> </span><span class="NAME">UserManager.prototype.setPingData</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="NAME">p_latency</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_drops</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>881</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>882</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.myUserRole</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">50</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">  </span><span class="NAME">this.isSynchronized</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>883</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>884</span> </span><span class="WHIT">		</span><span class="NAME">args.userID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_userID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>885</span> </span><span class="WHIT">		</span><span class="NAME">args.latency</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_latency</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>886</span> </span><span class="WHIT">		</span><span class="NAME">args.drops</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_drops</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>887</span> </span><span class="WHIT">		</span><span class="NAME">this.connectSession.callLCCSMethod</span><span class="PUNC">(</span><span class="STRN">"UserManager"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setPingData"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>888</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>889</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>890</span> 
<span class='line'>891</span> 
<span class='line'>892</span> </span><span class="COMM">/**
<span class='line'>893</span>  * Registers a custom field for use in the userDescriptor (will appear in the CustomField Object).
<span class='line'>894</span>  * Only hosts are allowed to create regisfields, but users can publish them once
<span class='line'>895</span>  * @param p_fieldName The name of the new custom field
<span class='line'>896</span>  * @function
<span class='line'>897</span>  */</span><span class="WHIT">
<span class='line'>898</span> </span><span class="NAME">UserManager.prototype.registerCustomUserField</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_fieldName</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>899</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>900</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.myUserRole</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">50</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">  </span><span class="NAME">this.isSynchronized</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>901</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>902</span> </span><span class="WHIT">		</span><span class="NAME">args.fieldName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_fieldName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>903</span> </span><span class="WHIT">		</span><span class="NAME">this.connectSession.callLCCSMethod</span><span class="PUNC">(</span><span class="STRN">"UserManager"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"registerCustomUserField"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>904</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>905</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>906</span> 
<span class='line'>907</span> </span><span class="COMM">/**
<span class='line'>908</span>  * Tests whether a custom field is already registered with the UserManager
<span class='line'>909</span>  * @param p_fieldName the custom field in question
<span class='line'>910</span>  * @return true if defined, false if not
<span class='line'>911</span>  * @private
<span class='line'>912</span>  */</span><span class="WHIT">
<span class='line'>913</span> </span><span class="NAME">UserManager.prototype.isCustomFieldDefined</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_fieldName</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>914</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>915</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.customFieldNames</span><span class="PUNC">[</span><span class="NAME">p_fieldName</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>916</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>917</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>918</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>919</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>920</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>921</span> 
<span class='line'>922</span> </span><span class="COMM">/**
<span class='line'>923</span>  * Custom User Fields are used to store extended info about a particular user (for example, phone status, "I have a question", etc).
<span class='line'>924</span>  * A custom field must be registered before it can be modified. Custom fields are modifiable by the given user or a host.
<span class='line'>925</span>  * @param p_userID The user to be modified
<span class='line'>926</span>  * @param p_fieldName The name of the custom field to modify
<span class='line'>927</span>  * @param p_value The new value for the custom field (null to delete)
<span class='line'>928</span>  * @function
<span class='line'>929</span>  */</span><span class="WHIT">
<span class='line'>930</span> </span><span class="NAME">UserManager.prototype.setCustomUserField</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="NAME">p_fieldName</span><span class="PUNC">,</span><span class="NAME">p_value</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>931</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>932</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.myUserRole</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">50</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">  </span><span class="NAME">this.isSynchronized</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>933</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>934</span> </span><span class="WHIT">		</span><span class="NAME">args.fieldName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_fieldName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>935</span> </span><span class="WHIT">		</span><span class="NAME">args.userID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_userID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>936</span> </span><span class="WHIT">		</span><span class="NAME">args.value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>937</span> </span><span class="WHIT">		</span><span class="NAME">this.connectSession.callLCCSMethod</span><span class="PUNC">(</span><span class="STRN">"UserManager"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setCustomUserField"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>938</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>939</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>940</span> 
<span class='line'>941</span> </span><span class="COMM">/**
<span class='line'>942</span>  * Deletes a custom field for used in the customField Object).
<span class='line'>943</span>  * Only hosts are allowed to create deleteFields.
<span class='line'>944</span>  * @param p_fieldName The name of the custom field to be deleted
<span class='line'>945</span>  * 
<span class='line'>946</span>  */</span><span class="WHIT">
<span class='line'>947</span> </span><span class="NAME">UserManager.prototype.deleteCustomUserField</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_fieldName</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>948</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>949</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.myUserRole</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">50</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">  </span><span class="NAME">this.isSynchronized</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>950</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>951</span> </span><span class="WHIT">		</span><span class="NAME">args.fieldName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_fieldName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>952</span> </span><span class="WHIT">		</span><span class="NAME">this.connectSession.callLCCSMethod</span><span class="PUNC">(</span><span class="STRN">"UserManager"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"deleteCustomUserField"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>953</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>954</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>955</span> 
<span class='line'>956</span> </span><span class="COMM">/**
<span class='line'>957</span>  * Sets the user's connection to one of the following: 
<span class='line'>958</span>  * &lt;ul>
<span class='line'>959</span>  * &lt;li>RoomSettings.MODEM&lt;/li>
<span class='line'>960</span>  * &lt;li>RoomSettings.DSL&lt;/li>
<span class='line'>961</span>  * &lt;li>RoomSettings.LAN&lt;/li>
<span class='line'>962</span>  * &lt;/ul> 
<span class='line'>963</span>  * 
<span class='line'>964</span>  * Note: If the &lt;code>UserManager.anonymousPresence&lt;/code> is set to true, then this method might fail if the
<span class='line'>965</span>  * user's userDescriptor has not been fetched. So it is adviced to call this method after the required userDescriptor's
<span class='line'>966</span>  * are fetched.In other words listen to &lt;code>UserEvent.USER_CREATE&lt;/code> event and call this method after the required
<span class='line'>967</span>  * userDescriptor's are fetched.
<span class='line'>968</span>  * 
<span class='line'>969</span>  * @param p_userID The userID of the user the change.
<span class='line'>970</span>  * @param p_conn The new connection speed value which is one of the RoomSetting constants.
<span class='line'>971</span>  * @param p_forceUpdate Whether or not the update should be forced; the default is false. 
<span class='line'>972</span>  */</span><span class="WHIT">
<span class='line'>973</span> </span><span class="NAME">UserManager.prototype.setUserConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_conn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_forceUpdate</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>974</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>975</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.myUserRole</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">50</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">  </span><span class="NAME">this.isSynchronized</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>976</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>977</span> </span><span class="WHIT">		</span><span class="NAME">args.userID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_userID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>978</span> </span><span class="WHIT">		</span><span class="NAME">args.conn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_conn</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>979</span> </span><span class="WHIT">		</span><span class="NAME">args.forceUpdate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_forceUpdate</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>980</span> </span><span class="WHIT">		</span><span class="NAME">this.connectSession.callLCCSMethod</span><span class="PUNC">(</span><span class="STRN">"UserManager"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setUserConnection"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>981</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>982</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>983</span> 
<span class='line'>984</span> </span><span class="COMM">/**
<span class='line'>985</span>  * This function checks if anyone has peer to peer disabled. i.e. behind firewall or something...
<span class='line'>986</span>  * @returns {boolean} returns if the p2p is disabled.
<span class='line'>987</span>  * @function
<span class='line'>988</span>  */</span><span class="WHIT">
<span class='line'>989</span> </span><span class="NAME">UserManager.prototype.getIsPeerEnable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>990</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>991</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.userDescriptorTable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>992</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.userDescriptorTable</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">isPeer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>993</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>994</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>995</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>996</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>997</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>998</span> 
<span class='line'>999</span> </span><span class="COMM">/*
<span class='line'>1000</span> *@private
<span class='line'>1001</span> */</span><span class="WHIT">
<span class='line'>1002</span> </span><span class="NAME">UserManager.prototype.updateUserTables</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1003</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1004</span> </span><span class="WHIT">	</span><span class="NAME">this.userDescriptorTable</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1005</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">args.value.role</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1006</span> </span><span class="WHIT">		</span><span class="NAME">this.hostCollection</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1007</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">args.value.role</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">50</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1008</span> </span><span class="WHIT">		</span><span class="NAME">this.participantCollection</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1009</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">args.value.role</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1010</span> </span><span class="WHIT">		</span><span class="NAME">this.audienceCollection</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1011</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1012</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1013</span> 
<span class='line'>1014</span> </span><span class="COMM">/*
<span class='line'>1015</span> * Internal helper method to dispatchEvents and morph arguments to objects and set the target & currentTarget
<span class='line'>1016</span> *@private
<span class='line'>1017</span> */</span><span class="WHIT">
<span class='line'>1018</span> </span><span class="NAME">UserManager.prototype.receiveEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1019</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1020</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1021</span> </span><span class="WHIT">	</span><span class="NAME">evt.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.type</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1022</span> </span><span class="WHIT">	</span><span class="NAME">evt.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">evt.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1023</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">evt.type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"anonymousPresenceChange"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1024</span> </span><span class="WHIT">		</span><span class="NAME">this.anonymousPresence</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1025</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">evt.type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"customFieldChange"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1026</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.isCustomFieldDefined</span><span class="PUNC">(</span><span class="NAME">args.customFieldName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1027</span> </span><span class="WHIT">			</span><span class="NAME">this.customFieldNames</span><span class="PUNC">[</span><span class="NAME">args.customFieldName</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1028</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1029</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">evt.type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"customFieldDelete"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1030</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.isCustomFieldDefined</span><span class="PUNC">(</span><span class="NAME">args.value</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1031</span> </span><span class="WHIT">			</span><span class="KEYW">delete</span><span class="WHIT"> 	</span><span class="NAME">this.customFieldNames</span><span class="PUNC">[</span><span class="NAME">args.value</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>1032</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1033</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">evt.type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"customFieldRegister"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1034</span> </span><span class="WHIT">		</span><span class="NAME">this.customFieldNames</span><span class="PUNC">[</span><span class="NAME">args.value</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1035</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">evt.type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"synchronizationChange"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1036</span> </span><span class="WHIT">		</span><span class="NAME">this.isSynchronized</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">evt.value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1037</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">evt.type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"userBooted"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1038</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.userDescriptorTable</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1039</span> </span><span class="WHIT">			</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.userDescriptorTable</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1040</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1041</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">args.value.role</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.hostCollection</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1042</span> </span><span class="WHIT">			</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.hostCollection</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1043</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">args.value.role</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">50</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.participantCollection</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1044</span> </span><span class="WHIT">			</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.participantCollection</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1045</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">args.value.role</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.audienceCollection</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1046</span> </span><span class="WHIT">			</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.audienceCollection</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1047</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1048</span> </span><span class="WHIT">		</span><span class="NAME">evt.userID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.value.userID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1049</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">evt.type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"userConnectionChange"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1050</span> </span><span class="WHIT">		</span><span class="NAME">this.updateUserTables</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1051</span> </span><span class="WHIT">		</span><span class="NAME">evt.userID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.value.userID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1052</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">evt.type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"userCreate"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1053</span> </span><span class="WHIT">		</span><span class="NAME">this.updateUserTables</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1054</span> </span><span class="WHIT">		</span><span class="NAME">evt.userID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.value.userID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1055</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">evt.type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"userNameChange"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1056</span> </span><span class="WHIT">		</span><span class="NAME">this.updateUserTables</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1057</span> </span><span class="WHIT">		</span><span class="NAME">evt.userID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.value.userID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1058</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">evt.type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"userPingDataChange"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1059</span> </span><span class="WHIT">		</span><span class="NAME">this.updateUserTables</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1060</span> </span><span class="WHIT">		</span><span class="NAME">evt.userID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.value.userID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1061</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">evt.type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"userRemove"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1062</span> </span><span class="WHIT">		</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.userDescriptorTable</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1063</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">args.value.role</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.hostCollection</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1064</span> </span><span class="WHIT">			</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.hostCollection</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1065</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">args.value.role</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">50</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.participantCollection</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1066</span> </span><span class="WHIT">			</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.participantCollection</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1067</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">args.value.role</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.audienceCollection</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1068</span> </span><span class="WHIT">			</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.audienceCollection</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1069</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1070</span> </span><span class="WHIT">		</span><span class="NAME">evt.userID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.value.userID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1071</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">evt.type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"userRoleChange"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1072</span> </span><span class="WHIT">		</span><span class="NAME">this.userDescriptorTable</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1073</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">args.value.role</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1074</span> </span><span class="WHIT">			</span><span class="NAME">this.hostCollection</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1075</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.participantCollection</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1076</span> </span><span class="WHIT">				</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.participantCollection</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1077</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1078</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.audienceCollection</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1079</span> </span><span class="WHIT">				</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.audienceCollection</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1080</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">			
<span class='line'>1081</span> 		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">args.value.role</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">50</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1082</span> </span><span class="WHIT">			</span><span class="NAME">this.participantCollection</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1083</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.hostCollection</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1084</span> </span><span class="WHIT">				</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.hostCollection</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1085</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1086</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.audienceCollection</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1087</span> </span><span class="WHIT">				</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.audienceCollection</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1088</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1089</span> </span><span class="WHIT">			
<span class='line'>1090</span> 			
<span class='line'>1091</span> 		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">args.value.role</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1092</span> </span><span class="WHIT">			</span><span class="NAME">this.audienceCollection</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1093</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.participantCollection</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1094</span> </span><span class="WHIT">				</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.participantCollection</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1095</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1096</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.hostCollection</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1097</span> </span><span class="WHIT">				</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.hostCollection</span><span class="PUNC">[</span><span class="NAME">args.value.userID</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1098</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1099</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1100</span> </span><span class="WHIT">		</span><span class="NAME">evt.userID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.value.userID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1101</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">evt.type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"userUsericonURLChange"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1102</span> </span><span class="WHIT">		</span><span class="NAME">this.updateUserTables</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1103</span> </span><span class="WHIT">		</span><span class="NAME">evt.userID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.value.userID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1104</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1105</span> </span><span class="WHIT">	</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1106</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1107</span> 
<span class='line'>1108</span> 
<span class='line'>1109</span> 
<span class='line'>1110</span> </span><span class="COMM">/**
<span class='line'>1111</span>  * @class CollectionNode is the foundation class for building shared models requiring publish
<span class='line'>1112</span>  * and subscribe messaging. All shared classes including the sharedModel, sharedManager, 
<span class='line'>1113</span>  * and many pods use CollectionNodes in order to manage  messages, permissions, and roles.
<span class='line'>1114</span>  * &lt;p>
<span class='line'>1115</span>  * At its core, a room can be logically seen as a group of CollectionNodes. For example, 
<span class='line'>1116</span>  * one CollectionNode is used in a chat pod, one within UserManager, and so on. CollectionNodes, 
<span class='line'>1117</span>  * in turn, are made up of nodes which can be thought of as permission-managed channels 
<span class='line'>1118</span>  * through which MessageItems are sent and received. Each node has its own NodeConfiguration 
<span class='line'>1119</span>  * which determines the permissions and storage policies sent through it.
<span class='line'>1120</span>  * &lt;/p>
<span class='line'>1121</span>  * &lt;p>
<span class='line'>1122</span>  * CollectionNode is the main component class developers will create and interact with in order
<span class='line'>1123</span>  * accomplish the following: 
<span class='line'>1124</span>  * &lt;ul>
<span class='line'>1125</span>  *  &lt;li>Create message nodes.&lt;/li>
<span class='line'>1126</span>  *  &lt;li>Publish MessageItems to those nodes.&lt;/li>
<span class='line'>1127</span>  *  &lt;li>Subscribe to nodes.&lt;/li>
<span class='line'>1128</span>  *  &lt;li>Configure nodes.&lt;/li>
<span class='line'>1129</span>  *  &lt;li>Manage collection and node user roles.&lt;/li>
<span class='line'>1130</span>  * &lt;/ul>
<span class='line'>1131</span>  * Only users with a role of &lt;code>UserRoles.OWNER&lt;/code> may create and configure collectionNodes. 
<span class='line'>1132</span>  * Users of &lt;code>UserRoles.PUBLISHER&lt;/code> can typically publish MessageItems, and 
<span class='line'>1133</span>  * &lt;code>UserRoles.VIEWER&lt;/code> may subscribe and receive messages. As such, it's typically 
<span class='line'>1134</span>  * the case that an owner set up the required CollectionNodes in a room before publishers may 
<span class='line'>1135</span>  * publish or viewers may receive MessageItems.
<span class='line'>1136</span>  * &lt;p>
<span class='line'>1137</span>  * CollectionNodes do not store the items which pass through them even if they are stored on 
<span class='line'>1138</span>  * the services. Developers are advised to listen to the &lt;code>ITEM_RECEIVE&lt;/code> event and 
<span class='line'>1139</span>  * store details as needed in their own models.
<span class='line'>1140</span>  * &lt;table>&lt;tr>&lt;th>&lt;b>Event&lt;/b>&lt;/th>&lt;th>&lt;b>Summary&lt;/b>&lt;/th>&lt;/tr>
<span class='line'>1141</span>  * &lt;tr>&lt;td valign="top">&lt;code>configurationChange &lt;/code>&lt;/td> &lt;td> Dispatched when a node within the collection has a change in its configuration (typically, its access-model).&lt;/td>&lt;/tr>
<span class='line'>1142</span>  * &lt;tr>&lt;td valign="top">&lt;code>itemReceive&lt;/code>&lt;/td> &lt;td> Dispatched when a node within the collection receives an item.&lt;/td>&lt;/tr>
<span class='line'>1143</span>  * &lt;tr>&lt;td valign="top">&lt;code>itemRetract&lt;/code>&lt;/td> &lt;td> Dispatched when a node within the collection retracts an item.&lt;/td>&lt;/tr>
<span class='line'>1144</span>  * &lt;tr>&lt;td valign="top">&lt;code>myRoleChange&lt;/code>&lt;/td> &lt;td> Dispatched when the current user's role changes for the  collectionNode as a whole and not nodes within it.&lt;/td>&lt;/tr>
<span class='line'>1145</span>  * &lt;tr>&lt;td valign="top">&lt;code>nodeCreate&lt;/code>&lt;/td> &lt;td> Dispatched when a node is created within the collection.&lt;/td>&lt;/tr>
<span class='line'>1146</span>  * &lt;tr>&lt;td valign="top">&lt;code>nodeDelete&lt;/code>&lt;/td> &lt;td> Dispatched when a node is deleted within the collection.&lt;/td>&lt;/tr>
<span class='line'>1147</span>  * &lt;tr>&lt;td valign="top">&lt;code>reconnect&lt;/code>&lt;/td> &lt;td> Dispatched when the collection has been disconnected from the server and is in the process of reconnecting and re-subscribing.&lt;/td>&lt;/tr>
<span class='line'>1148</span>  * &lt;tr>&lt;td valign="top">&lt;code>synchronizationChange&lt;/code>&lt;/td> &lt;td> Dispatched when the collection has fully received all nodes and items stored up until the present time thereby becoming synchronized as well as when the collection becomes disconnected from (and thus "out of sync" with) the room's messaging bus.&lt;/td>&lt;/tr>
<span class='line'>1149</span>  * &lt;tr>&lt;td valign="top">&lt;code>userRoleChange&lt;/code>&lt;/td> &lt;td> Dispatched when the collection or a node within the collection, has a change in roles for any user.&lt;/td>&lt;/tr>
<span class='line'>1150</span>  * &lt;/table>
<span class='line'>1151</span>  *
<span class='line'>1152</span>  * @constructor
<span class='line'>1153</span>  */</span><span class="WHIT">	
<span class='line'>1154</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">CollectionNode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1155</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1156</span> </span><span class="WHIT">	</span><span class="NAME">this.connectSession</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ConnectSession.primarySession</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1157</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1158</span> </span><span class="NAME">EventDispatcher.initialize</span><span class="PUNC">(</span><span class="NAME">CollectionNode.prototype</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1159</span> 
<span class='line'>1160</span> </span><span class="COMM">/**
<span class='line'>1161</span>  * The &lt;code>sharedID&lt;/code> is the logical address of this collection 
<span class='line'>1162</span>  * within the room and must therefore be unique from all other CollectionNode names.
<span class='line'>1163</span>  * @field
<span class='line'>1164</span>  */</span><span class="WHIT">
<span class='line'>1165</span> </span><span class="NAME">CollectionNode.prototype.sharedID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1166</span> </span><span class="COMM">/**
<span class='line'>1167</span>  * The ConnectSession with which this component is associated. Note that this may only be set once before &lt;code>subscribe&lt;/code>
<span class='line'>1168</span>  * is called; re-sessioning of components is not supported.
<span class='line'>1169</span>  * @field
<span class='line'>1170</span>  */</span><span class="WHIT">
<span class='line'>1171</span> </span><span class="NAME">CollectionNode.prototype.connectSession</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1172</span> </span><span class="COMM">/**
<span class='line'>1173</span>  * Determines whether or not the collection is "up to state" with all previously 
<span class='line'>1174</span>  * stored items in its nodes. Once a CollectionNode has successfully connected 
<span class='line'>1175</span>  * to the service and retrieved all its nodes and messageItems, it is considered 
<span class='line'>1176</span>  * synchronized. If the connection is lost, it becomes unsynchronized until it 
<span class='line'>1177</span>  * fully reconnects and re-retrieves its state.
<span class='line'>1178</span>  * @field
<span class='line'>1179</span>  */</span><span class="WHIT">
<span class='line'>1180</span> </span><span class="NAME">CollectionNode.prototype.isSynchronized</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1181</span> </span><span class="COMM">/**
<span class='line'>1182</span>  *@private
<span class='line'>1183</span>  *@field
<span class='line'>1184</span>  */</span><span class="WHIT">
<span class='line'>1185</span> </span><span class="NAME">CollectionNode.prototype.messageNodes</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1186</span> </span><span class="COMM">/**
<span class='line'>1187</span>  * @private
<span class='line'>1188</span>  * @field
<span class='line'>1189</span>  */</span><span class="WHIT">
<span class='line'>1190</span> </span><span class="NAME">CollectionNode.prototype.nodeUserRoles</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1191</span> </span><span class="COMM">/**
<span class='line'>1192</span>  * The complete set of roles for this collection described as {userID:role} pairs.
<span class='line'>1193</span>  * @field
<span class='line'>1194</span>  */</span><span class="WHIT">
<span class='line'>1195</span> </span><span class="NAME">CollectionNode.prototype.userRoles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1196</span> 
<span class='line'>1197</span> </span><span class="COMM">/**
<span class='line'>1198</span>  * &lt;code>subscribe()&lt;/code> causes the CollectionNode to subscribe to the logical 
<span class='line'>1199</span>  * destination provided by &lt;code>collectionName&lt;/code>. If there is no such 
<span class='line'>1200</span>  * destination on the service and the current user has an owner role, a new 
<span class='line'>1201</span>  * CollectionNode is created and stored on the service with the given &lt;code>
<span class='line'>1202</span>  * collectionName&lt;/code>.
<span class='line'>1203</span>  * When subscription is successful or a new CollectionNode is created, the collection:
<span class='line'>1204</span>  * &lt;ul>
<span class='line'>1205</span>  * &lt;li>Discovers all the accessible nodes for this collection along with 
<span class='line'>1206</span>  * their configurations and roles.&lt;/li>
<span class='line'>1207</span>  * &lt;li>Subscribes to all nodes allowed within the collection.&lt;/li>																&lt;/li>
<span class='line'>1208</span>  * &lt;li>Retrievs all stored items for all nodes within it and broadcasts &lt;code>
<span class='line'>1209</span>  * ITEM_RECEIVE&lt;/code> events for each.&lt;/li>
<span class='line'>1210</span>  * &lt;li>Fires a &lt;code>COLLECTION_SYNCHRONIZE&lt;/code> event once the collection 
<span class='line'>1211</span>  * has retrieved the data above.&lt;/li>
<span class='line'>1212</span>  * &lt;/ul>
<span class='line'>1213</span>  * @function
<span class='line'>1214</span>  */</span><span class="WHIT">		
<span class='line'>1215</span> </span><span class="NAME">CollectionNode.prototype.subscribe</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1216</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1217</span> </span><span class="WHIT">	</span><span class="NAME">this.connectSession.subscribeCollection</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1218</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1219</span> 
<span class='line'>1220</span> </span><span class="COMM">/**
<span class='line'>1221</span>  * Determines whether or not the collection is empty, that is, having no nodes
<span class='line'>1222</span>  * @return Boolean
<span class='line'>1223</span>  * @function
<span class='line'>1224</span>  */</span><span class="WHIT">
<span class='line'>1225</span> </span><span class="NAME">CollectionNode.prototype.isEmpty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1226</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1227</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.messageNodes</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1228</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1229</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1230</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1231</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1232</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1233</span> 
<span class='line'>1234</span> </span><span class="COMM">/**
<span class='line'>1235</span>  * Disconnects this CollectionNode from the server. Typically used for garbage collection. 
<span class='line'>1236</span>  * If a node is subscribed but a network or services glitch causes it to disconnect, 
<span class='line'>1237</span>  * the CollectionNode will attempt to reconnect automatically.
<span class='line'>1238</span>  * @function
<span class='line'>1239</span>  */</span><span class="WHIT">
<span class='line'>1240</span> </span><span class="NAME">CollectionNode.prototype.unsubscribe</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1241</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1242</span> </span><span class="WHIT">	</span><span class="NAME">args.sharedID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.sharedID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1243</span> </span><span class="WHIT">	</span><span class="NAME">this.connectSession.callLCCSMethod</span><span class="PUNC">(</span><span class="STRN">"CollectionNode"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"unsubscribe"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1244</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1245</span> 
<span class='line'>1246</span> </span><span class="COMM">/**
<span class='line'>1247</span>  * Creates a new node in this collection; they are either optionally configured when 
<span class='line'>1248</span>  * created or accept the default configuration. Note that only users with and owner role 
<span class='line'>1249</span>  * may create or configure nodes on a CollectionNode.
<span class='line'>1250</span>  * 
<span class='line'>1251</span>  * @param p_nodeName The name for the new node which must be unique within the CollectionNode.
<span class='line'>1252</span>  * @param p_nodeConfiguration Optionally, the configuration for this node. If none is supplied, 
<span class='line'>1253</span>  * &lt;code>NodeConfiguration.defaultConfiguration&lt;/code> is used.
<span class='line'>1254</span>  * @function
<span class='line'>1255</span>  */</span><span class="WHIT">
<span class='line'>1256</span> </span><span class="NAME">CollectionNode.prototype.createNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_nodeName</span><span class="PUNC">,</span><span class="NAME">p_nodeConfiguration</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1257</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1258</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1259</span> </span><span class="WHIT">	</span><span class="NAME">args.nodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_nodeName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1260</span> </span><span class="WHIT">	</span><span class="NAME">args.sharedID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.sharedID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1261</span> </span><span class="WHIT">	</span><span class="NAME">args.nodeConfiguration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_nodeConfiguration</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1262</span> </span><span class="WHIT">	</span><span class="NAME">this.connectSession.callLCCSMethod</span><span class="PUNC">(</span><span class="STRN">"CollectionNode"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"createNode"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1263</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1264</span> 
<span class='line'>1265</span> </span><span class="COMM">/**
<span class='line'>1266</span>  * Configures a node in this collection and replaces the existing NodeConfiguration. 
<span class='line'>1267</span>  * Only users with an owner role may change a node's configuration.
<span class='line'>1268</span>  * 
<span class='line'>1269</span>  * @param p_nodeName The name of the node to configure.
<span class='line'>1270</span>  * @param p_nodeConfiguration The new NodeConfiguration for the node.
<span class='line'>1271</span>  * @function
<span class='line'>1272</span>  */</span><span class="WHIT">
<span class='line'>1273</span> 
<span class='line'>1274</span> </span><span class="NAME">CollectionNode.prototype.setNodeConfiguration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_nodeName</span><span class="PUNC">,</span><span class="NAME">p_nodeConfiguration</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1275</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1276</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1277</span> </span><span class="WHIT">	</span><span class="NAME">args.nodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_nodeName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1278</span> </span><span class="WHIT">	</span><span class="NAME">args.sharedID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.sharedID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1279</span> </span><span class="WHIT">	</span><span class="NAME">args.nodeConfiguration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_nodeConfiguration</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1280</span> </span><span class="WHIT">	</span><span class="NAME">this.connectSession.callLCCSMethod</span><span class="PUNC">(</span><span class="STRN">"CollectionNode"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setNodeConfiguration"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1281</span> </span><span class="WHIT">	
<span class='line'>1282</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1283</span> 
<span class='line'>1284</span> </span><span class="COMM">/**
<span class='line'>1285</span>  * Returns the NodeConfiguration options for a given node in this CollectionNode.
<span class='line'>1286</span>  * 
<span class='line'>1287</span>  * @param p_nodeName The name of the desired node.
<span class='line'>1288</span>  * @function
<span class='line'>1289</span>  */</span><span class="WHIT">
<span class='line'>1290</span> 
<span class='line'>1291</span> </span><span class="NAME">CollectionNode.prototype.getNodeConfiguration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_nodeName</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1292</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1293</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.messageNodes</span><span class="PUNC">[</span><span class="NAME">p_nodeName</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1294</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1295</span> 
<span class='line'>1296</span> </span><span class="COMM">/**
<span class='line'>1297</span>  * Removes the given node from this collection. Only users with an owner role may
<span class='line'>1298</span>  * change a node's configuration.
<span class='line'>1299</span>  * 
<span class='line'>1300</span>  * @param p_nodeName
<span class='line'>1301</span>  * @function
<span class='line'>1302</span>  */</span><span class="WHIT">		
<span class='line'>1303</span> </span><span class="NAME">CollectionNode.prototype.removeNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_nodeName</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1304</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1305</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1306</span> </span><span class="WHIT">	</span><span class="NAME">args.nodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_nodeName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1307</span> </span><span class="WHIT">	</span><span class="NAME">args.sharedID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.sharedID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1308</span> </span><span class="WHIT">	</span><span class="NAME">this.connectSession.callLCCSMethod</span><span class="PUNC">(</span><span class="STRN">"CollectionNode"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"removeNode"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1309</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1310</span> 
<span class='line'>1311</span> </span><span class="COMM">/**
<span class='line'>1312</span>  * Gives a specific user a specific role level for this entire collection or optionally 
<span class='line'>1313</span>  * a specified node within it. Roles cascade down from the root level of the room to 
<span class='line'>1314</span>  * the CollectionNode level and then to the node level. The following override rules apply: 
<span class='line'>1315</span>  * &lt;ul>
<span class='line'>1316</span>  * &lt;li>Setting a role on a collection node overrides the role at the root for that collection node.
<span class='line'>1317</span>  * &lt;li>Setting a role on a node overrides both the role at the root and the collection node for that node.
<span class='line'>1318</span>  * &lt;/ul>
<span class='line'>1319</span>  * 
<span class='line'>1320</span>  * @param p_userID The desired user's &lt;code>userID&lt;/code>.
<span class='line'>1321</span>  * @param p_role The users new role.
<span class='line'>1322</span>  * @param p_nodeName [Optional, defaults to null] The UserRole for the entire CollectionNode
<span class='line'>1323</span>  * @function
<span class='line'>1324</span>  */</span><span class="WHIT">
<span class='line'>1325</span> </span><span class="NAME">CollectionNode.prototype.setUserRole</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_role</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_nodeName</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1326</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1327</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1328</span> </span><span class="WHIT">	</span><span class="NAME">args.userID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_userID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1329</span> </span><span class="WHIT">	</span><span class="NAME">args.role</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_role</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1330</span> </span><span class="WHIT">	</span><span class="NAME">args.nodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_nodeName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1331</span> </span><span class="WHIT">	</span><span class="NAME">args.sharedID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.sharedID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1332</span> </span><span class="WHIT">	</span><span class="NAME">this.connectSession.callLCCSMethod</span><span class="PUNC">(</span><span class="STRN">"CollectionNode"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setUserRole"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1333</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1334</span> 
<span class='line'>1335</span> </span><span class="COMM">/**
<span class='line'>1336</span>  * Gets the role of a given user for this collection or a node within it. Note that this 
<span class='line'>1337</span>  * function discovers the implicit or cascading role of the user at this location; that is, 
<span class='line'>1338</span>  * if no explicit role is specified for a node, the user's role on the parent collection's 
<span class='line'>1339</span>  * is queried. If the user's role isn't explicitly defined on the collection, the root role 
<span class='line'>1340</span>  * is queried.
<span class='line'>1341</span>  * 
<span class='line'>1342</span>  * @param p_userID The user whose role is being queried.
<span class='line'>1343</span>  * @param p_nodeName [Optional, defaults to null]. The name of the node to check for roles. 
<span class='line'>1344</span>  * If null, check the entire CollectionNode.
<span class='line'>1345</span>  * 
<span class='line'>1346</span>  * @return the level of role of the specified user
<span class='line'>1347</span>  *
<span class='line'>1348</span>  * @function
<span class='line'>1349</span>  * 
<span class='line'>1350</span>  */</span><span class="WHIT">
<span class='line'>1351</span> </span><span class="NAME">CollectionNode.prototype.getUserRole</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="NAME">p_nodeName</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1352</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1353</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.isNodeDefined</span><span class="PUNC">(</span><span class="NAME">p_nodeName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1354</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.getExplicitUserRole</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_nodeName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">999</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1355</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getExplicitUserRole</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_nodeName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1356</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1357</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getRootUserRole</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1358</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1359</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1360</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getRootUserRole</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1361</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1362</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1363</span> 
<span class='line'>1364</span> </span><span class="COMM">/**
<span class='line'>1365</span>  * Finds the room-level userRole for a user
<span class='line'>1366</span>  * @private
<span class='line'>1367</span>  */</span><span class="WHIT">
<span class='line'>1368</span> </span><span class="NAME">CollectionNode.prototype.getRootUserRole</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1369</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1370</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.userRoles</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.userRoles</span><span class="PUNC">[</span><span class="NAME">p_userID</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1371</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.userRoles</span><span class="PUNC">[</span><span class="NAME">p_userID</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1372</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1373</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">usrRole</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.connectSession.userManager.getUserRole</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1374</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">usrRole</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1375</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">usrRole</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1376</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1377</span> </span><span class="WHIT">			</span><span class="COMM">//something wrong</span><span class="WHIT">
<span class='line'>1378</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1379</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1380</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1381</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1382</span> 
<span class='line'>1383</span> </span><span class="COMM">/**
<span class='line'>1384</span>  * Gets the roles explicitly set for a node within this collection. This only returns the 
<span class='line'>1385</span>  * explicit roles set on the particular node and doesn't look up the cascading roles from
<span class='line'>1386</span>  * the root as &lt;code>getUserRole()&lt;/code> does.
<span class='line'>1387</span>  * 
<span class='line'>1388</span>  * @param p_userID The user whose role is being queried.
<span class='line'>1389</span>  * @param p_nodeName The name of the node to whose roles are desired. If null, returns the 
<span class='line'>1390</span>  * set of user roles at the collection node level.
<span class='line'>1391</span>  * 
<span class='line'>1392</span>  * @return An object table of &lt;code>{userID:role}&lt;/code> tuples.
<span class='line'>1393</span>  * @function
<span class='line'>1394</span>  */</span><span class="WHIT">
<span class='line'>1395</span> </span><span class="NAME">CollectionNode.prototype.getExplicitUserRoles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_nodeName</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1396</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1397</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.isNodeDefined</span><span class="PUNC">(</span><span class="NAME">p_nodeName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1398</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.nodeUserRoles</span><span class="PUNC">[</span><span class="NAME">p_nodeName</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1399</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1400</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.userRoles</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1401</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1402</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1403</span> 
<span class='line'>1404</span> </span><span class="COMM">/**
<span class='line'>1405</span>  * Gets the role of a given user for a node within this collection or the 
<span class='line'>1406</span>  * collection itself. This only returns the explicit roles set on the 
<span class='line'>1407</span>  * particular node and doesn't look up the cascading roles from the root 
<span class='line'>1408</span>  * as &lt;code>getUserRole()&lt;/code> does.
<span class='line'>1409</span>  * 
<span class='line'>1410</span>  * @param p_userID The user whose role is being queried.
<span class='line'>1411</span>  * @param p_nodeName The name of the node to whose roles are desired. 
<span class='line'>1412</span>  * Null for the collection itself.
<span class='line'>1413</span>  * 
<span class='line'>1414</span>  * @return The requested role. If the role for the user isn't explicitly 
<span class='line'>1415</span>  * set, it returns &lt;code>NO_EXPLICIT_ROLE&lt;/code>.
<span class='line'>1416</span>  * @function
<span class='line'>1417</span>  */</span><span class="WHIT">
<span class='line'>1418</span> 
<span class='line'>1419</span> </span><span class="NAME">CollectionNode.prototype.getExplicitUserRole</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="NAME">p_nodeName</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1420</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1421</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.isNodeDefined</span><span class="PUNC">(</span><span class="NAME">p_nodeName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1422</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tmpObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.nodeUserRoles</span><span class="PUNC">[</span><span class="NAME">p_nodeName</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1423</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tmpObject</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1424</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">tmpObject</span><span class="PUNC">[</span><span class="NAME">p_userID</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1425</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1426</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1427</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.userRoles</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.userRoles</span><span class="PUNC">[</span><span class="NAME">p_userID</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1428</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.userRoles</span><span class="PUNC">[</span><span class="NAME">p_userID</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1429</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1430</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1431</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">999</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1432</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1433</span> 
<span class='line'>1434</span> </span><span class="COMM">/**
<span class='line'>1435</span>  * Determines whether a given user is allowed to subscribe to this entire collection 
<span class='line'>1436</span>  * or a node within it.
<span class='line'>1437</span>  * 
<span class='line'>1438</span>  * @param p_userID The ID of the user whose role is being queried.
<span class='line'>1439</span>  * @param p_nodeName [Optional, null if empty]. The node to check. If null, it 
<span class='line'>1440</span>  * checks the entire CollectionNode.
<span class='line'>1441</span>  * @function
<span class='line'>1442</span>  */</span><span class="WHIT">
<span class='line'>1443</span> </span><span class="NAME">CollectionNode.prototype.canUserSubscribe</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="NAME">p_nodeName</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1444</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1445</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_nodeName</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1446</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.getUserRole</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">)</span><span class="PUNC">>=</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1447</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1448</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">roleNeededToSubscribe</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">p_nodeName</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">accessModel</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1449</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">getUserRole</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_nodeName</span><span class="PUNC">)</span><span class="PUNC">>=</span><span class="NAME">roleNeededToSubscribe</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1450</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1451</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1452</span> 
<span class='line'>1453</span> </span><span class="COMM">/**
<span class='line'>1454</span>  * Determines whether a given user is allowed to publish to a given node in 
<span class='line'>1455</span>  * this collection.
<span class='line'>1456</span>  * 
<span class='line'>1457</span>  * @param p_userID The ID of the user whose role (and therefore permissions) is being queried.
<span class='line'>1458</span>  * @param p_nodeName The name of the desired node. 
<span class='line'>1459</span>  * 
<span class='line'>1460</span>  * @return 
<span class='line'>1461</span>  * @function
<span class='line'>1462</span>  */</span><span class="WHIT">		
<span class='line'>1463</span> </span><span class="NAME">CollectionNode.prototype.canUserPublish</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="NAME">p_nodeName</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1464</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1465</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.isNodeDefined</span><span class="PUNC">(</span><span class="NAME">p_nodeName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1466</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.getUserRole</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_nodeName</span><span class="PUNC">)</span><span class="PUNC">>=</span><span class="NUMB">100</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1467</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1468</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">roleNeededToPublish</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">p_nodeName</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">publishModel</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1469</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">roleNeededToPublish</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1470</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.getUserRole</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_nodeName</span><span class="PUNC">)</span><span class="PUNC">>=</span><span class="NAME">roleNeededToPublish</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1471</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1472</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.getUserRole</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_nodeName</span><span class="PUNC">)</span><span class="PUNC">>=</span><span class="NUMB">100</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1473</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1474</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1475</span> 
<span class='line'>1476</span> </span><span class="COMM">/**
<span class='line'>1477</span>  * Determines whether a given user is allowed to configue this collection. 
<span class='line'>1478</span>  * 
<span class='line'>1479</span>  * @param p_userID The ID of the user whose role (and therefore permissions) is being queried.
<span class='line'>1480</span>  * @param p_nodeName Optionally, the name of the requested node. Defaults to the collection.
<span class='line'>1481</span>  *
<span class='line'>1482</span>  * @return 
<span class='line'>1483</span>  * @function
<span class='line'>1484</span>  */</span><span class="WHIT">		
<span class='line'>1485</span> </span><span class="NAME">CollectionNode.prototype.canUserConfigure</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="NAME">p_nodeName</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1486</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1487</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_nodeName</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1488</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.getUserRole</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">)</span><span class="PUNC">>=</span><span class="NUMB">100</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1489</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1490</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.canUserPublish</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_nodeName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.getUserRole</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_nodeName</span><span class="PUNC">)</span><span class="PUNC">>=</span><span class="NUMB">100</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1491</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1492</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1493</span> 
<span class='line'>1494</span> </span><span class="COMM">/**
<span class='line'>1495</span>  * Retracts the indicated item. This removes the item from storage on the server and 
<span class='line'>1496</span>  * sends an &lt;code>itemRetract&lt;/code> event to all users.
<span class='line'>1497</span>  * 
<span class='line'>1498</span>  * @param p_nodeName The &lt;code>nodeName&lt;/code> of the &lt;code>messageItem&lt;/code> to retract.
<span class='line'>1499</span>  * @param p_itemID The &lt;code>itemID&lt;/code> of the &lt;code>messageItem&lt;/code> (stored on the server) 
<span class='line'>1500</span>  * to retract.
<span class='line'>1501</span>  * @function
<span class='line'>1502</span>  */</span><span class="WHIT">
<span class='line'>1503</span> </span><span class="NAME">CollectionNode.prototype.retractItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_nodeName</span><span class="PUNC">,</span><span class="NAME">p_itemID</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1504</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1505</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1506</span> </span><span class="WHIT">	</span><span class="NAME">args.itemID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_itemID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1507</span> </span><span class="WHIT">	</span><span class="NAME">args.nodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_nodeName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1508</span> </span><span class="WHIT">	</span><span class="NAME">args.sharedID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.sharedID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1509</span> </span><span class="WHIT">	</span><span class="NAME">this.connectSession.callLCCSMethod</span><span class="PUNC">(</span><span class="STRN">"CollectionNode"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"retractItem"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1510</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1511</span> 
<span class='line'>1512</span> </span><span class="COMM">/**
<span class='line'>1513</span>  * Fetches the set of items specified by itemIDs from a given node. This will result in one &lt;code>ITEM_RECEIVE&lt;/code> event
<span class='line'>1514</span>  * per item retrieved, for the current user. Attempts to fetch items which don't exist fails silently.
<span class='line'>1515</span>  * @param p_nodeName The name of the node from which to fetch the items.
<span class='line'>1516</span>  * @param p_itemIDs An array of &lt;code>itemID&lt;code>s (Strings) to fetch from the service.
<span class='line'>1517</span>  * @function
<span class='line'>1518</span>  */</span><span class="WHIT">
<span class='line'>1519</span> </span><span class="NAME">CollectionNode.prototype.fetchItems</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_nodeName</span><span class="PUNC">,</span><span class="NAME">p_itemIDs</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1520</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1521</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1522</span> </span><span class="WHIT">	</span><span class="NAME">args.itemIDs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_itemIDs</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1523</span> </span><span class="WHIT">	</span><span class="NAME">args.nodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_nodeName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1524</span> </span><span class="WHIT">	</span><span class="NAME">args.sharedID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.sharedID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1525</span> </span><span class="WHIT">	</span><span class="NAME">this.connectSession.callLCCSMethod</span><span class="PUNC">(</span><span class="STRN">"CollectionNode"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"fetchItems"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1526</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1527</span> 
<span class='line'>1528</span> </span><span class="COMM">/**
<span class='line'>1529</span>  * Whether the given node exists in this CollectionNode.
<span class='line'>1530</span>  * 
<span class='line'>1531</span>  * @param p_nodeName the name of desired node 
<span class='line'>1532</span>  * @return 
<span class='line'>1533</span>  * @function
<span class='line'>1534</span>  */</span><span class="WHIT">
<span class='line'>1535</span> </span><span class="NAME">CollectionNode.prototype.isNodeDefined</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_nodeName</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1536</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1537</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.messageNodes</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.messageNodes</span><span class="PUNC">[</span><span class="NAME">p_nodeName</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1538</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1539</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1540</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1541</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1542</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1543</span> 
<span class='line'>1544</span> 
<span class='line'>1545</span> 
<span class='line'>1546</span> 
<span class='line'>1547</span> 
<span class='line'>1548</span> 
<span class='line'>1549</span> 
<span class='line'>1550</span> </span><span class="COMM">/**
<span class='line'>1551</span>  * Publishes a MessageItem. The MessageItem itself will have a &lt;code>nodeName&lt;/code> declared.
<span class='line'>1552</span>  * &lt;p>
<span class='line'>1553</span>  * &lt;code>p_overWrite&lt;/code> provides users with control over whether edits take 
<span class='line'>1554</span>  * precedence over delete actions. It is essentially a lock that assures an item can
<span class='line'>1555</span>  * only be published if it exists. The general rule of thumb is that if you 
<span class='line'>1556</span>  * want to add a new item, use the &lt;code>p_overWrite&lt;/code> default flag of false. 
<span class='line'>1557</span>  * If you're editing an item that may be retracted, then set the flag according to 
<span class='line'>1558</span>  * your preference. 
<span class='line'>1559</span>  * &lt;p>
<span class='line'>1560</span>  * 
<span class='line'>1561</span>  * @param p_messageItem The MessageItem to publish.
<span class='line'>1562</span>  * @param p_overWrite True if this call is overwriting an existing item. False (the default) 
<span class='line'>1563</span>  * if it is not.
<span class='line'>1564</span>  * @function
<span class='line'>1565</span>  */</span><span class="WHIT">
<span class='line'>1566</span> 
<span class='line'>1567</span> </span><span class="NAME">CollectionNode.prototype.publishItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_messageItem</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1568</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1569</span> </span><span class="WHIT">	</span><span class="COMM">// check, am I synchronized?</span><span class="WHIT">
<span class='line'>1570</span> </span><span class="WHIT">	</span><span class="NAME">this.connectSession.publishItem</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_messageItem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1571</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1572</span> 
<span class='line'>1573</span> </span><span class="COMM">/*
<span class='line'>1574</span> * Internal Method to dispatchEvents and morph arguments to objects and set the target & currentTarget
<span class='line'>1575</span> *@private
<span class='line'>1576</span> */</span><span class="WHIT">
<span class='line'>1577</span> </span><span class="NAME">CollectionNode.prototype.receiveEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1578</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1579</span> </span><span class="WHIT">	</span><span class="NAME">args.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1580</span> </span><span class="WHIT">	</span><span class="COMM">//myTrace("Recieved Event - " + args.type);</span><span class="WHIT">
<span class='line'>1581</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">args.type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"synchronizationChange"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">args.value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1582</span> </span><span class="WHIT">		</span><span class="NAME">this.isSynchronized</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1583</span> </span><span class="WHIT">		</span><span class="NAME">this.nodeUserRoles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.nodeRoles</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1584</span> </span><span class="WHIT">		</span><span class="NAME">this.userRoles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.userRoles</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1585</span> </span><span class="WHIT">		</span><span class="COMM">//this.messageNodes = new Object();</span><span class="WHIT">
<span class='line'>1586</span> </span><span class="WHIT">		</span><span class="COMM">//this.messageNodes = args.nodes;</span><span class="WHIT">
<span class='line'>1587</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1588</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">args.type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"itemReceive"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">this.isSynchronized</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1589</span> </span><span class="WHIT">		</span><span class="COMM">//return;</span><span class="WHIT">
<span class='line'>1590</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1591</span> </span><span class="WHIT">	
<span class='line'>1592</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">args.type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"nodeCreate"</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">args.type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"configurationChange"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1593</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.messageNodes</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1594</span> </span><span class="WHIT">			</span><span class="NAME">this.messageNodes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1595</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1596</span> </span><span class="WHIT">		</span><span class="NAME">this.messageNodes</span><span class="PUNC">[</span><span class="NAME">args.nodeName</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.nodeConfiguration</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1597</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1598</span> </span><span class="WHIT">	
<span class='line'>1599</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">args.type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"nodeDelete"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1600</span> </span><span class="WHIT">		</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.messageNodes</span><span class="PUNC">[</span><span class="NAME">args.nodeName</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1601</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1602</span> </span><span class="WHIT">	
<span class='line'>1603</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">args.type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"myRoleChange"</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">args.type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"userRoleChange"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1604</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">args.nodeName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1605</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodeObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.nodeUserRoles</span><span class="PUNC">[</span><span class="NAME">args.nodeName</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1606</span> </span><span class="WHIT">			</span><span class="NAME">nodeObject</span><span class="PUNC">[</span><span class="NAME">args.userID</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.role</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1607</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1608</span> </span><span class="WHIT">			</span><span class="NAME">this.userRoles</span><span class="PUNC">[</span><span class="NAME">args.userID</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.role</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1609</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1610</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1611</span> </span><span class="WHIT">	</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1612</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1613</span> 
<span class='line'>1614</span> 
<span class='line'>1615</span> </span><span class="COMM">/**
<span class='line'>1616</span>  * @class SharedObject is used to store data in an unordered hash (key-value) across the AFCS services; elements can only be accessed using its key.
<span class='line'>1617</span>  * A SharedObject can be used in situations where you need to access a property using its key value as opposed to
<span class='line'>1618</span>  * index. Similar to SharedCollection and SharedProperty,this component supports "piggybacking" on existing CollectionNodes,
<span class='line'>1619</span>  * through its &lt;code>collectionNode&lt;/code> property and its subscribe method. Developers can avoid CollectionNode
<span class='line'>1620</span>  * proliferation in their applications by pre-supplying a CollectionNode (to the &lt;code>collectionNode&lt;/code> property)
<span class='line'>1621</span>  * and a nodeName (in the subscribe method) for the SharedObject to use. If none is supplied, the SharedObject will create its own 
<span class='line'>1622</span>  * collectionNode (named for the uniqueID supplied in subscribe()) for sending and receiving messages.
<span class='line'>1623</span>  * &lt;table>&lt;tr>&lt;th>&lt;b>Event&lt;/b>&lt;/th>&lt;th>&lt;b>Summary&lt;/b>&lt;/th>&lt;/tr>
<span class='line'>1624</span>  * &lt;tr>&lt;td valign="top">&lt;code>propertyAdd &lt;/code>&lt;/td> &lt;td> Dispatched when an item to SharedObject is added.&lt;/td>&lt;/tr>
<span class='line'>1625</span>  * &lt;tr>&lt;td valign="top">&lt;code>propertyChange&lt;/code>&lt;/td> &lt;td> Dispatched when the SharedObject has been updated in some way.&lt;/td>&lt;/tr>
<span class='line'>1626</span>  * &lt;tr>&lt;td valign="top">&lt;code>propertyRetracted&lt;/code>&lt;/td> &lt;td> Dispatched when an item from SharedObject is removed.&lt;/td>&lt;/tr>
<span class='line'>1627</span>  * &lt;tr>&lt;td valign="top">&lt;code>reconnect&lt;/code>&lt;/td> &lt;td> The type of event emitted when the CollectionNode is about to reconnect to the server.&lt;/td>&lt;/tr>
<span class='line'>1628</span>  * &lt;tr>&lt;td valign="top">&lt;code>synchronizationChange&lt;/code>&lt;/td> &lt;td> Dispatched when the SharedObject goes in and out of sync with the service.&lt;/td>&lt;/tr>
<span class='line'>1629</span>  * &lt;/table>
<span class='line'>1630</span>  * @constructor
<span class='line'>1631</span>  */</span><span class="WHIT">
<span class='line'>1632</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">SharedObject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1633</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1634</span> </span><span class="WHIT">	</span><span class="NAME">this.connectSession</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ConnectSession.primarySession</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1635</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1636</span> </span><span class="NAME">EventDispatcher.initialize</span><span class="PUNC">(</span><span class="NAME">SharedObject.prototype</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1637</span> 
<span class='line'>1638</span> </span><span class="COMM">/**
<span class='line'>1639</span>  * Defines the logical location of the component on the service - typically this assigns the sharedID of the collectionNode
<span class='line'>1640</span>  * used by the component. sharedIDs should be unique within a room (if they're expressing 2 unique locations). Note that
<span class='line'>1641</span>  * this can only be assigned once (before &lt;code>subscribe()&lt;/code> is called). For components with an &lt;code>id&lt;/code> property, 
<span class='line'>1642</span>  * sharedID defaults to that value.
<span class='line'>1643</span>  * @field
<span class='line'>1644</span>  */</span><span class="WHIT">
<span class='line'>1645</span> </span><span class="NAME">SharedObject.prototype.sharedID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"_SharedObject"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1646</span> </span><span class="COMM">/**
<span class='line'>1647</span>  * Specifies an existing collectionNode to use in case a developer wishes to supply their own, and avoid having the 
<span class='line'>1648</span>  * sharedObject create a new one.
<span class='line'>1649</span>  * @field
<span class='line'>1650</span>  */</span><span class="WHIT">
<span class='line'>1651</span> </span><span class="NAME">SharedObject.prototype.collectionNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1652</span> </span><span class="COMM">/**
<span class='line'>1653</span>  * The ConnectSession with which this component is associated. Note that this may only be set once before &lt;code>subscribe&lt;/code>
<span class='line'>1654</span>  * is called; re-sessioning of components is not supported.
<span class='line'>1655</span>  * @field
<span class='line'>1656</span>  */</span><span class="WHIT">
<span class='line'>1657</span> </span><span class="NAME">SharedObject.prototype.connectSession</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1658</span> </span><span class="COMM">/**
<span class='line'>1659</span>  * Sets the Node Configuration on a already defined node that holds the sharedObject
<span class='line'>1660</span>  * @field
<span class='line'>1661</span>  */</span><span class="WHIT">
<span class='line'>1662</span> </span><span class="NAME">SharedObject.prototype.nodeConfiguration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1663</span> </span><span class="COMM">/**
<span class='line'>1664</span>  * Sets the Node name for the node being created
<span class='line'>1665</span>  * @field
<span class='line'>1666</span>  */</span><span class="WHIT">
<span class='line'>1667</span> </span><span class="NAME">SharedObject.prototype.nodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"sharedObjectNode"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1668</span> </span><span class="COMM">/**
<span class='line'>1669</span>  *@private
<span class='line'>1670</span>  */</span><span class="WHIT">
<span class='line'>1671</span> </span><span class="NAME">SharedObject.prototype.myUserID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1672</span> </span><span class="COMM">/**
<span class='line'>1673</span>  *@private
<span class='line'>1674</span>  */</span><span class="WHIT">
<span class='line'>1675</span> </span><span class="NAME">SharedObject.prototype.sharedObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>1676</span> 
<span class='line'>1677</span> </span><span class="COMM">/**
<span class='line'>1678</span>  * Returns whether or not the SharedObject has retrieved any information previously stored on the service, and 
<span class='line'>1679</span>  * is currently connected to the service.
<span class='line'>1680</span>  * @returns {boolean}
<span class='line'>1681</span>  * @function
<span class='line'>1682</span>  */</span><span class="WHIT">
<span class='line'>1683</span> </span><span class="NAME">SharedObject.prototype.isSynchronized</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1684</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1685</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.collectionNode</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1686</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.isSynchronized</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1687</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1688</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1689</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1690</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1691</span> 
<span class='line'>1692</span> </span><span class="COMM">/**
<span class='line'>1693</span>  * Sets the Node Configuration on a already defined node that holds the sharedObject
<span class='line'>1694</span>  * @param p_nodeConfig The Node Configuration
<span class='line'>1695</span>  * @function
<span class='line'>1696</span>  */</span><span class="WHIT">
<span class='line'>1697</span> </span><span class="NAME">SharedObject.prototype.setNodeConfiguration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_nodeConfig</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1698</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1699</span> </span><span class="WHIT">	</span><span class="NAME">this.nodeConfiguration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_nodeConfig</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1700</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.isSynchronized</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1701</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.setNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">,</span><span class="NAME">this.nodeConfiguration</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1702</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1703</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1704</span> 
<span class='line'>1705</span> 
<span class='line'>1706</span> </span><span class="COMM">/**
<span class='line'>1707</span>  *  Sets the role of a given user for the SharedObject.
<span class='line'>1708</span>  * 
<span class='line'>1709</span>  * @param p_userRole The role value to set on the specified user.
<span class='line'>1710</span>  * @param p_userID The ID of the user whose role should be set.
<span class='line'>1711</span>  * @function
<span class='line'>1712</span>  */</span><span class="WHIT">
<span class='line'>1713</span> </span><span class="NAME">SharedObject.prototype.setUserRole</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="WHIT"> </span><span class="PUNC">,</span><span class="NAME">p_userRole</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1714</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1715</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">p_userID</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1716</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1717</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1718</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.setUserRole</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="NAME">p_userRole</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1719</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1720</span> 
<span class='line'>1721</span> 
<span class='line'>1722</span> </span><span class="COMM">/**
<span class='line'>1723</span>  *  Returns the role of a given user for the SharedObject.
<span class='line'>1724</span>  * 
<span class='line'>1725</span>  * @param p_userID The user ID for the user being queried.
<span class='line'>1726</span>  * @function
<span class='line'>1727</span>  */</span><span class="WHIT">
<span class='line'>1728</span> </span><span class="NAME">SharedObject.prototype.getUserRole</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1729</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1730</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">p_userID</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1731</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1732</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1733</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getUserRole</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1734</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1735</span> 
<span class='line'>1736</span> 
<span class='line'>1737</span> 
<span class='line'>1738</span> </span><span class="COMM">/**
<span class='line'>1739</span>  * Tells the component to begin synchronizing with the service.  
<span class='line'>1740</span>  * For "headless" components such as this one, this method must be called explicitly.
<span class='line'>1741</span>  * @function
<span class='line'>1742</span>  */</span><span class="WHIT">
<span class='line'>1743</span> </span><span class="NAME">SharedObject.prototype.subscribe</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1744</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1745</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">this.nodeConfiguration</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1746</span> </span><span class="WHIT">		</span><span class="NAME">this.nodeConfiguration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">NodeConfiguration</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1747</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1748</span> </span><span class="WHIT">	
<span class='line'>1749</span> 	</span><span class="COMM">//this.nodeConfiguration.itemStorageScheme = NodeConfiguration.STORAGE_SCHEME_MANUAL;</span><span class="WHIT">
<span class='line'>1750</span> </span><span class="WHIT">	</span><span class="NAME">this.nodeConfiguration.itemStorageScheme</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1751</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.collectionNode</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1752</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">CollectionNode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1753</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.sharedID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.sharedID</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1754</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.connectSession</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.connectSession</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1755</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.addEventListener</span><span class="PUNC">(</span><span class="STRN">"synchronizationChange"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1756</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.addEventListener</span><span class="PUNC">(</span><span class="STRN">"itemReceive"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1757</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.addEventListener</span><span class="PUNC">(</span><span class="STRN">"itemRetract"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1758</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.subscribe</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1759</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1760</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1761</span> 
<span class='line'>1762</span> </span><span class="COMM">/**
<span class='line'>1763</span>  * Disposes all listeners to the network and framework classes. 
<span class='line'>1764</span>  * Recommended for proper garbage collection of the component.
<span class='line'>1765</span>  * @function
<span class='line'>1766</span>  */</span><span class="WHIT">
<span class='line'>1767</span> </span><span class="NAME">SharedObject.prototype.close</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1768</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1769</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.removeEventListener</span><span class="PUNC">(</span><span class="STRN">"synchronizationChange"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1770</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.removeEventListener</span><span class="PUNC">(</span><span class="STRN">"itemReceive"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1771</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.removeEventListener</span><span class="PUNC">(</span><span class="STRN">"itemRetract"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1772</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.removeEventListener</span><span class="PUNC">(</span><span class="STRN">"reconnect"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1773</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.unsubscribe</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1774</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1775</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1776</span> 
<span class='line'>1777</span> </span><span class="COMM">/**
<span class='line'>1778</span>  * @private
<span class='line'>1779</span>  */</span><span class="WHIT">
<span class='line'>1780</span> </span><span class="NAME">SharedObject.prototype.synchronizationChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1781</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1782</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.isSynchronized</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1783</span> </span><span class="WHIT">		</span><span class="NAME">this.myUserID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.connectSession.userManager.myUserID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1784</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.collectionNode.isNodeDefined</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.canUserConfigure</span><span class="PUNC">(</span><span class="NAME">this.myUserID</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1785</span> </span><span class="WHIT">			</span><span class="COMM">// this collectionNode has never been built, and I can add it...</span><span class="WHIT">
<span class='line'>1786</span> </span><span class="WHIT">			</span><span class="NAME">this.collectionNode.createNode</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.nodeConfig</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1787</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1788</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1789</span> </span><span class="WHIT">	</span><span class="NAME">p_evt.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1790</span> </span><span class="WHIT">	</span><span class="NAME">p_evt.value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.isSynchronized</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1791</span> </span><span class="WHIT">	</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1792</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1793</span> 
<span class='line'>1794</span> </span><span class="COMM">/**
<span class='line'>1795</span>  * @private
<span class='line'>1796</span>  */</span><span class="WHIT">
<span class='line'>1797</span> </span><span class="NAME">SharedObject.prototype.reconnect</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1798</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1799</span> </span><span class="WHIT">	</span><span class="NAME">this.sharedObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1800</span> </span><span class="WHIT">	</span><span class="NAME">p_evt.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1801</span> </span><span class="WHIT">	</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1802</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1803</span> 
<span class='line'>1804</span> </span><span class="COMM">/**
<span class='line'>1805</span>  * @private
<span class='line'>1806</span>  */</span><span class="WHIT">
<span class='line'>1807</span> </span><span class="NAME">SharedObject.prototype.itemReceive</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1808</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1809</span> </span><span class="WHIT">	</span><span class="COMM">//update the Object</span><span class="WHIT">
<span class='line'>1810</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_evt.nodeName</span><span class="PUNC">!=</span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1811</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1812</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1813</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newItemToAdd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.item</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1814</span> </span><span class="WHIT">	
<span class='line'>1815</span> 	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">eventType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.sharedObject</span><span class="PUNC">[</span><span class="NAME">newItemToAdd.itemID</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"propertyChange"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"propertyAdd"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1816</span> </span><span class="WHIT">	</span><span class="NAME">p_evt.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">eventType</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1817</span> </span><span class="WHIT">	</span><span class="NAME">p_evt.itemID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newItemToAdd.itemID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1818</span> </span><span class="WHIT">	</span><span class="NAME">p_evt.value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newItemToAdd.body</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1819</span> </span><span class="WHIT">	</span><span class="NAME">p_evt.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1820</span> </span><span class="WHIT">	</span><span class="NAME">this.sharedObject</span><span class="PUNC">[</span><span class="NAME">newItemToAdd.itemID</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newItemToAdd.body</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1821</span> </span><span class="WHIT">	</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1822</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1823</span> 
<span class='line'>1824</span> </span><span class="COMM">/**
<span class='line'>1825</span>  * @private
<span class='line'>1826</span>  */</span><span class="WHIT">
<span class='line'>1827</span> </span><span class="NAME">SharedObject.prototype.itemRetract</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1828</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1829</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_evt.nodeName</span><span class="PUNC">!=</span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1830</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1831</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1832</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">retractedItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.item</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1833</span> </span><span class="WHIT">	</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.sharedObject</span><span class="PUNC">[</span><span class="NAME">retractedItem.itemID</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1834</span> </span><span class="WHIT">	</span><span class="NAME">p_evt.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"propertyRetracted"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1835</span> </span><span class="WHIT">	</span><span class="NAME">p_evt.itemID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">retractedItem.itemID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1836</span> </span><span class="WHIT">	</span><span class="NAME">p_evt.value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">retractedItem.body</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1837</span> </span><span class="WHIT">	</span><span class="NAME">p_evt.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1838</span> </span><span class="WHIT">	</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1839</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1840</span> 
<span class='line'>1841</span> </span><span class="COMM">/**
<span class='line'>1842</span>  * Add or Update the value of a given property name in a shared object
<span class='line'>1843</span>  * @param p_propertyName The key of the Property being added
<span class='line'>1844</span>  * @param p_value The value of the property, defaults to null
<span class='line'>1845</span>  * @function
<span class='line'>1846</span>  */</span><span class="WHIT"> 
<span class='line'>1847</span> </span><span class="NAME">SharedObject.prototype.setProperty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_propertyName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_value</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1848</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1849</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">msg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">MessageItem</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1850</span> </span><span class="WHIT">	</span><span class="NAME">msg.nodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.nodeName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1851</span> </span><span class="WHIT">	</span><span class="NAME">msg.body</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1852</span> </span><span class="WHIT">	</span><span class="NAME">msg.itemID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_propertyName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1853</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.publishItem</span><span class="PUNC">(</span><span class="NAME">msg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1854</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1855</span> 
<span class='line'>1856</span> </span><span class="COMM">/**
<span class='line'>1857</span>  * Returns the value of the given property name
<span class='line'>1858</span>  * @param p_propertyName The key of the Property whose value is requested.
<span class='line'>1859</span>  * @function
<span class='line'>1860</span>  */</span><span class="WHIT"> 
<span class='line'>1861</span> </span><span class="NAME">SharedObject.prototype.getProperty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_propertyName</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1862</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1863</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.sharedObject</span><span class="PUNC">[</span><span class="NAME">p_propertyName</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1864</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1865</span> 
<span class='line'>1866</span> </span><span class="COMM">/**
<span class='line'>1867</span>  * Returns whether the given property exists or not in the shared object
<span class='line'>1868</span>  * @param p_propertyName The key of the Property whose presence is verified
<span class='line'>1869</span>  * @function
<span class='line'>1870</span>  */</span><span class="WHIT"> 
<span class='line'>1871</span> </span><span class="NAME">SharedObject.prototype.hasProperty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_propertyName</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1872</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1873</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.sharedObject</span><span class="PUNC">[</span><span class="NAME">p_propertyName</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1874</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1875</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1876</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1877</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1878</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1879</span> 
<span class='line'>1880</span> </span><span class="COMM">/**
<span class='line'>1881</span>  * Remove the property from the shared object
<span class='line'>1882</span>  * @param p_propertyName The key of the Property that needs to be retracted from the sharedObject
<span class='line'>1883</span>  * @function
<span class='line'>1884</span>  */</span><span class="WHIT"> 
<span class='line'>1885</span> </span><span class="NAME">SharedObject.prototype.removeProperty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_propertyName</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1886</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1887</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.retractItem</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_propertyName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1888</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1889</span> 
<span class='line'>1890</span> </span><span class="COMM">/**
<span class='line'>1891</span>  * Return all the items in the shared object as one big hashMap (Object)
<span class='line'>1892</span>  * @function
<span class='line'>1893</span>  */</span><span class="WHIT"> 
<span class='line'>1894</span> </span><span class="NAME">SharedObject.prototype.getValues</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1895</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1896</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.sharedObject</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1897</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1898</span> 
<span class='line'>1899</span> </span><span class="COMM">/**
<span class='line'>1900</span>  * Remove all the items in the shared object.
<span class='line'>1901</span>  * @function
<span class='line'>1902</span>  */</span><span class="WHIT"> 
<span class='line'>1903</span> </span><span class="NAME">SharedObject.prototype.removeAll</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1904</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1905</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">propertyName</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.sharedObject</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1906</span> </span><span class="WHIT">		</span><span class="NAME">this.removeProperty</span><span class="PUNC">(</span><span class="NAME">propertyName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1907</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1908</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1909</span> 
<span class='line'>1910</span> </span><span class="COMM">/**
<span class='line'>1911</span>  * Check if the shared object is empty
<span class='line'>1912</span>  * @function
<span class='line'>1913</span>  */</span><span class="WHIT"> 
<span class='line'>1914</span> </span><span class="NAME">SharedObject.prototype.isEmpty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1915</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1916</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">propertyName</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.sharedObject</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1917</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1918</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1919</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1920</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1921</span> 
<span class='line'>1922</span> </span><span class="COMM">/**
<span class='line'>1923</span>  * @class &lt;code>SharedProperty&lt;/code> is a model that manages a 
<span class='line'>1924</span>  * variable of any type and which is shared amongst all users connected to the room.
<span class='line'>1925</span>  * &lt;p>
<span class='line'>1926</span>  * Note that this component supports "piggybacking" on existing CollectionNodes 
<span class='line'>1927</span>  * through its constructor. Developers can avoid CollectionNode proliferation in 
<span class='line'>1928</span>  * their applications by pre-supplying a CollectionNode and a &lt;code>nodeName&lt;/code> 
<span class='line'>1929</span>  * for the &lt;code>SharedProperty&lt;/code> to use. If none is supplied, the SharedProperty 
<span class='line'>1930</span>  * will create its own &lt;code>collectionNode&lt;/code> for sending and receiving messages.
<span class='line'>1931</span>  * &lt;table>&lt;tr>&lt;th>&lt;b>Event&lt;/b>&lt;/th>&lt;th>&lt;b>Summary&lt;/b>&lt;/th>&lt;/tr>
<span class='line'>1932</span>  * &lt;tr>&lt;td valign="top">&lt;code>change &lt;/code>&lt;/td> &lt;td> Dispatched when the value of the property is changed: it is subject to round tripping to the service.&lt;/td>&lt;/tr>
<span class='line'>1933</span>  * &lt;tr>&lt;td valign="top">&lt;code>myRoleChange&lt;/code>&lt;/td> &lt;td> Dispatched when the user's role with respect to this SharedProperty  changes.&lt;/td>&lt;/tr>
<span class='line'>1934</span>  * &lt;tr>&lt;td valign="top">&lt;code>synchronizationChange&lt;/code>&lt;/td> &lt;td> Dispatched when the SharedProperty goes in and out of sync.&lt;/td>&lt;/tr>
<span class='line'>1935</span>  * &lt;/table>
<span class='line'>1936</span>  * @constructor
<span class='line'>1937</span>  */</span><span class="WHIT">
<span class='line'>1938</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">SharedProperty</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1939</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1940</span> </span><span class="WHIT">	</span><span class="NAME">this.connectSession</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ConnectSession.primarySession</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1941</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1942</span> </span><span class="COMM">/**
<span class='line'>1943</span>  * The Collection Node to which the shared property subscribes/publishes
<span class='line'>1944</span>  * @field
<span class='line'>1945</span>  */</span><span class="WHIT"> 
<span class='line'>1946</span> </span><span class="NAME">SharedProperty.prototype.collectionNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1947</span> </span><span class="COMM">/**
<span class='line'>1948</span>  * The ConnectSession with which this component is associated. Note that this may only be set once before &lt;code>subscribe&lt;/code>
<span class='line'>1949</span>  * is called; re-sessioning of components is not supported.
<span class='line'>1950</span>  * @field
<span class='line'>1951</span>  */</span><span class="WHIT">
<span class='line'>1952</span> </span><span class="NAME">SharedProperty.prototype.connectSession</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1953</span> </span><span class="COMM">/**
<span class='line'>1954</span>  * The value of the SharedProperty which users can only set if &lt;code>canUserEdit
<span class='line'>1955</span>  * &lt;/code> is true.
<span class='line'>1956</span>  * @field
<span class='line'>1957</span>  */</span><span class="WHIT">
<span class='line'>1958</span> </span><span class="NAME">SharedProperty.prototype.value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1959</span> </span><span class="COMM">/**
<span class='line'>1960</span>  * Defines the logical location of the component on the service - typically this assigns the sharedID of the collectionNode
<span class='line'>1961</span>  * used by the component. sharedIDs should be unique within a room (if they're expressing 2 unique locations). Note that
<span class='line'>1962</span>  * this can only be assigned once (before &lt;code>subscribe()&lt;/code> is called). For components with an &lt;code>id&lt;/code> property, 
<span class='line'>1963</span>  * sharedID defaults to that value.
<span class='line'>1964</span>  * @field
<span class='line'>1965</span>  */</span><span class="WHIT">
<span class='line'>1966</span> </span><span class="NAME">SharedProperty.prototype.sharedID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"sharedProperty"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1967</span> </span><span class="COMM">/**
<span class='line'>1968</span>  * The Node Name to which the value is published
<span class='line'>1969</span>  * @field
<span class='line'>1970</span>  */</span><span class="WHIT">
<span class='line'>1971</span> </span><span class="NAME">SharedProperty.prototype.nodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"value"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1972</span> </span><span class="COMM">/**
<span class='line'>1973</span>  * @private
<span class='line'>1974</span>  */</span><span class="WHIT">
<span class='line'>1975</span> </span><span class="NAME">SharedProperty.prototype.itemReceived</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1976</span> </span><span class="COMM">/**
<span class='line'>1977</span>  * @private
<span class='line'>1978</span>  */</span><span class="WHIT">
<span class='line'>1979</span> </span><span class="NAME">SharedProperty.prototype.isClearAfterSessionRemoved</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1980</span> </span><span class="COMM">/**
<span class='line'>1981</span>  * Role value which is required for access the property
<span class='line'>1982</span>  * @field
<span class='line'>1983</span>  */</span><span class="WHIT">
<span class='line'>1984</span> </span><span class="NAME">SharedProperty.prototype.accessModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1985</span> </span><span class="COMM">/**
<span class='line'>1986</span>  * @private
<span class='line'>1987</span>  */</span><span class="WHIT">
<span class='line'>1988</span> </span><span class="NAME">SharedProperty.prototype.tempAccessModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1989</span> </span><span class="COMM">/**
<span class='line'>1990</span>  * Role Value required to publish on the property
<span class='line'>1991</span>  * @field
<span class='line'>1992</span>  */</span><span class="WHIT">
<span class='line'>1993</span> </span><span class="NAME">SharedProperty.prototype.publishModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1994</span> </span><span class="COMM">/**
<span class='line'>1995</span>  * @private
<span class='line'>1996</span>  */</span><span class="WHIT">
<span class='line'>1997</span> </span><span class="NAME">SharedProperty.prototype.tempPublishModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1998</span> </span><span class="COMM">/**
<span class='line'>1999</span>  * @private
<span class='line'>2000</span>  */</span><span class="WHIT">
<span class='line'>2001</span> </span><span class="NAME">SharedProperty.prototype.updateInterval</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2002</span> </span><span class="COMM">/**
<span class='line'>2003</span>  * @private
<span class='line'>2004</span>  */</span><span class="WHIT">
<span class='line'>2005</span> </span><span class="NAME">SharedProperty.prototype.userManager</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2006</span> </span><span class="COMM">/**
<span class='line'>2007</span>  * @private
<span class='line'>2008</span>  */</span><span class="WHIT">
<span class='line'>2009</span> </span><span class="NAME">SharedProperty.prototype.cachedValueForSync</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2010</span> </span><span class="COMM">/**
<span class='line'>2011</span>  * @private
<span class='line'>2012</span>  */</span><span class="WHIT">
<span class='line'>2013</span> </span><span class="NAME">SharedProperty.prototype.cachedValueForSending</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2014</span> </span><span class="COMM">/**
<span class='line'>2015</span>  * @private
<span class='line'>2016</span>  */</span><span class="WHIT">
<span class='line'>2017</span> </span><span class="NAME">SharedProperty.prototype.sendDataTimer</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2018</span> 
<span class='line'>2019</span> </span><span class="NAME">EventDispatcher.initialize</span><span class="PUNC">(</span><span class="NAME">SharedProperty.prototype</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2020</span> </span><span class="COMM">/**
<span class='line'>2021</span>  * Cleans up all networking and event handling; it is recommended for garbage collection.
<span class='line'>2022</span>  * @function
<span class='line'>2023</span>  */</span><span class="WHIT">
<span class='line'>2024</span> </span><span class="NAME">SharedProperty.prototype.close</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2025</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2026</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.removeEventListener</span><span class="PUNC">(</span><span class="STRN">"synchronizationChange"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	
<span class='line'>2027</span> 	</span><span class="NAME">this.collectionNode.removeEventListener</span><span class="PUNC">(</span><span class="STRN">"itemReceive"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2028</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.removeEventListener</span><span class="PUNC">(</span><span class="STRN">"myRoleChange"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			
<span class='line'>2029</span> 	</span><span class="NAME">this.collectionNode.unsubscribe</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2030</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2031</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.sendDataTimer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2032</span> </span><span class="WHIT">		</span><span class="NAME">clearTimeout</span><span class="PUNC">(</span><span class="NAME">this.sendDataTimer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2033</span> </span><span class="WHIT">		</span><span class="NAME">this.sendDataTimer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2034</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2035</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2036</span> 
<span class='line'>2037</span> </span><span class="COMM">/**
<span class='line'>2038</span>  * Tells the component to begin synchronizing with the service.  
<span class='line'>2039</span>  * For "headless" components such as this one, this method must be called explicitly.
<span class='line'>2040</span>  * @function
<span class='line'>2041</span>  */</span><span class="WHIT">
<span class='line'>2042</span> </span><span class="NAME">SharedProperty.prototype.subscribe</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2043</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2044</span> </span><span class="WHIT">	</span><span class="NAME">this.userManager</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.connectSession.userManager</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2045</span> </span><span class="WHIT">	
<span class='line'>2046</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.collectionNode</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">			
<span class='line'>2047</span> 		</span><span class="NAME">this.collectionNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">CollectionNode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2048</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.connectSession</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.connectSession</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2049</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.sharedID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="NAME">this.sharedID</span><span class="WHIT">  </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2050</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.subscribe</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2051</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2052</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.collectionNode.isSynchronized</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2053</span> </span><span class="WHIT">			</span><span class="NAME">this.synchronizationChange</span><span class="PUNC">(</span><span class="STRN">"synchronizationChange"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2054</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2055</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2056</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.addEventListener</span><span class="PUNC">(</span><span class="STRN">"synchronizationChange"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	
<span class='line'>2057</span> 	</span><span class="NAME">this.collectionNode.addEventListener</span><span class="PUNC">(</span><span class="STRN">"itemReceive"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2058</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.addEventListener</span><span class="PUNC">(</span><span class="STRN">"myRoleChange"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2059</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2060</span> 
<span class='line'>2061</span> </span><span class="COMM">/**
<span class='line'>2062</span>  * The value of the SharedProperty which users can only set if &lt;code>canUserEdit
<span class='line'>2063</span>  * &lt;/code> is true. 
<span class='line'>2064</span>  * @param p_value
<span class='line'>2065</span>  * @function
<span class='line'>2066</span>  */</span><span class="WHIT">
<span class='line'>2067</span> </span><span class="NAME">SharedProperty.prototype.setValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_value</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2068</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2069</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_value</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">this.value</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.isSynchronized</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2070</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.updateInterval</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2071</span> </span><span class="WHIT">			</span><span class="NAME">this.cachedValueForSending</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2072</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.sendDataTimer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2073</span> </span><span class="WHIT">				</span><span class="NAME">clearTimeout</span><span class="PUNC">(</span><span class="NAME">this.sendDataTimer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2074</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2075</span> </span><span class="WHIT">			</span><span class="NAME">this.sendDataTimer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">bindUsingClosure</span><span class="PUNC">(</span><span class="NAME">this.onTimerComplete</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.updateInterval</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">300</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2076</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2077</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">msg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">MessageItem</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2078</span> </span><span class="WHIT">			</span><span class="NAME">msg.nodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.nodeName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2079</span> </span><span class="WHIT">			</span><span class="NAME">msg.body</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2080</span> </span><span class="WHIT">			</span><span class="NAME">this.collectionNode.publishItem</span><span class="PUNC">(</span><span class="NAME">msg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2081</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2082</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_value</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">this.value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2083</span> </span><span class="WHIT">		</span><span class="NAME">this.cachedValueForSync</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2084</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2085</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2086</span> 
<span class='line'>2087</span> </span><span class="COMM">/**
<span class='line'>2088</span>  * Determines whether the SharedProperty is connected and fully synchronized with the service.
<span class='line'>2089</span>  * @function
<span class='line'>2090</span>  */</span><span class="WHIT">
<span class='line'>2091</span> </span><span class="NAME">SharedProperty.prototype.isSynchronized</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2092</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2093</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.isSynchronized</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2094</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2095</span> 
<span class='line'>2096</span> </span><span class="COMM">/**
<span class='line'>2097</span>  * Determines whether the current user can edit the property.
<span class='line'>2098</span>  * @function
<span class='line'>2099</span>  */</span><span class="WHIT">
<span class='line'>2100</span> </span><span class="NAME">SharedProperty.prototype.canIEdit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2101</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2102</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.canUserEdit</span><span class="PUNC">(</span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2103</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2104</span> 
<span class='line'>2105</span> </span><span class="COMM">/**
<span class='line'>2106</span>  * Determines whether the specified user can edit the property.
<span class='line'>2107</span>  * 
<span class='line'>2108</span>  * @param p_userID The user to query regarding whether they can edit.
<span class='line'>2109</span>  * @function
<span class='line'>2110</span>  */</span><span class="WHIT">
<span class='line'>2111</span> </span><span class="NAME">SharedProperty.prototype.canUserEdit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2112</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2113</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.collectionNode.canUserPublish</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2114</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2115</span> 
<span class='line'>2116</span> </span><span class="COMM">/**
<span class='line'>2117</span>  * Allows the current user with an owner role to grant the specified user 
<span class='line'>2118</span>  * the ability to edit the property. 
<span class='line'>2119</span>  * 
<span class='line'>2120</span>  * @param p_userID The userID of the user being granted editing privileges.
<span class='line'>2121</span>  * @function
<span class='line'>2122</span>  * 
<span class='line'>2123</span>  */</span><span class="WHIT">
<span class='line'>2124</span> </span><span class="NAME">SharedProperty.prototype.allowUserToEdit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2125</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2126</span> </span><span class="WHIT">	</span><span class="COMM">// If I can't configure, cancel.</span><span class="WHIT">
<span class='line'>2127</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.collectionNode.canUserConfigure</span><span class="PUNC">(</span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">,</span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2128</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.setUserRole</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">50</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2129</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2130</span> </span><span class="WHIT">	
<span class='line'>2131</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2132</span> 
<span class='line'>2133</span> </span><span class="COMM">/**
<span class='line'>2134</span>  * Gets the NodeConfiguration of the SharedProperty Node.
<span class='line'>2135</span>  * @function
<span class='line'>2136</span>  */</span><span class="WHIT">
<span class='line'>2137</span> </span><span class="NAME">SharedProperty.prototype.getNodeConfiguration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2138</span> </span><span class="PUNC">{</span><span class="WHIT">	
<span class='line'>2139</span> 	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2140</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2141</span> 
<span class='line'>2142</span> </span><span class="COMM">/**
<span class='line'>2143</span>  * Sets the NodeConfiguration on the SharedProperty node.
<span class='line'>2144</span>  * @param p_nodeConfiguration The node Configuration of the shared property node to be set.
<span class='line'>2145</span>  * @function
<span class='line'>2146</span>  * 
<span class='line'>2147</span>  */</span><span class="WHIT">
<span class='line'>2148</span> </span><span class="NAME">SharedProperty.prototype.setNodeConfiguration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_nodeConfiguration</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2149</span> </span><span class="PUNC">{</span><span class="WHIT">	
<span class='line'>2150</span> 	</span><span class="NAME">this.collectionNode.setNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">,</span><span class="NAME">p_nodeConfiguration</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2151</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2152</span> 
<span class='line'>2153</span> </span><span class="COMM">/**
<span class='line'>2154</span>  * Set the role Value required to publish on the property
<span class='line'>2155</span>  * @function
<span class='line'>2156</span>  */</span><span class="WHIT">
<span class='line'>2157</span> </span><span class="NAME">SharedProperty.prototype.setPublishModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_publishModel</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2158</span> </span><span class="PUNC">{</span><span class="WHIT">	
<span class='line'>2159</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">p_publishModel</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">p_publishModel</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2160</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2161</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.isSynchronized</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2162</span> </span><span class="WHIT">			</span><span class="NAME">this.publishModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_publishModel</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2163</span> </span><span class="WHIT">			</span><span class="NAME">this.commitProperties</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2164</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2165</span> </span><span class="WHIT">			</span><span class="NAME">this.tempPublishModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_publishModel</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2166</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2167</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2168</span> </span><span class="WHIT">	
<span class='line'>2169</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2170</span> 
<span class='line'>2171</span> </span><span class="COMM">/**
<span class='line'>2172</span>  * Role Value required to publish on the property
<span class='line'>2173</span>  * @function
<span class='line'>2174</span>  */</span><span class="WHIT">
<span class='line'>2175</span> </span><span class="NAME">SharedProperty.prototype.getPublishModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2176</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2177</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.isNodeDefined</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2178</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">publishModel</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2179</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2180</span> </span><span class="WHIT">	
<span class='line'>2181</span> 	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2182</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2183</span> 
<span class='line'>2184</span> </span><span class="COMM">/**
<span class='line'>2185</span>  * Set the role value which is required for access the property
<span class='line'>2186</span>  * @function
<span class='line'>2187</span>  */</span><span class="WHIT">
<span class='line'>2188</span> </span><span class="NAME">SharedProperty.prototype.setAccessModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_accessModel</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2189</span> </span><span class="PUNC">{</span><span class="WHIT">	
<span class='line'>2190</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">p_accessModel</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">p_accessModel</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>2191</span> 	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2192</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.isSynchronized</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2193</span> </span><span class="WHIT">			</span><span class="NAME">this.accessModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_accessModel</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2194</span> </span><span class="WHIT">			</span><span class="NAME">this.commitProperties</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2195</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2196</span> </span><span class="WHIT">			</span><span class="NAME">this.tempAccessModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_accessModel</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2197</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2198</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2199</span> </span><span class="WHIT">	
<span class='line'>2200</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2201</span> 
<span class='line'>2202</span> </span><span class="COMM">/**
<span class='line'>2203</span>  * Role value which is required for access the property
<span class='line'>2204</span>  * @function
<span class='line'>2205</span>  */</span><span class="WHIT">
<span class='line'>2206</span> </span><span class="NAME">SharedProperty.prototype.getAccessModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2207</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2208</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.isNodeDefined</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2209</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">accessModel</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2210</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2211</span> </span><span class="WHIT">	
<span class='line'>2212</span> 	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2213</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2214</span> 
<span class='line'>2215</span> </span><span class="COMM">/**
<span class='line'>2216</span>  *  Returns the role of a given user for the property.
<span class='line'>2217</span>  * 
<span class='line'>2218</span>  * @param p_userID UserID of the user in question
<span class='line'>2219</span>  * @function
<span class='line'>2220</span>  */</span><span class="WHIT">
<span class='line'>2221</span> </span><span class="NAME">SharedProperty.prototype.getUserRole</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2222</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2223</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getUserRole</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2224</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2225</span> 
<span class='line'>2226</span> </span><span class="COMM">/**
<span class='line'>2227</span>  *  Sets the role of a given user for the property.
<span class='line'>2228</span>  * 
<span class='line'>2229</span>  * @param p_userID UserID of the user whose role we are setting
<span class='line'>2230</span>  * @param p_userRole Role value we are setting
<span class='line'>2231</span>  * @function
<span class='line'>2232</span>  */</span><span class="WHIT">
<span class='line'>2233</span> </span><span class="NAME">SharedProperty.prototype.setUserRole</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="WHIT"> </span><span class="PUNC">,</span><span class="NAME">p_userRole</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2234</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2235</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.setUserRole</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="NAME">p_userRole</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2236</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2237</span> 
<span class='line'>2238</span> </span><span class="COMM">/**
<span class='line'>2239</span>  * @private
<span class='line'>2240</span>  */</span><span class="WHIT">
<span class='line'>2241</span> </span><span class="NAME">SharedProperty.prototype.synchronizationChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2242</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2243</span> </span><span class="WHIT">	
<span class='line'>2244</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.collectionNode.isSynchronized</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2245</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.collectionNode.isNodeDefined</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">	</span><span class="COMM">//we're the first ones there</span><span class="WHIT">
<span class='line'>2246</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodeConf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">NodeConfiguration</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2247</span> </span><span class="WHIT">			</span><span class="NAME">nodeConf.accessModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2248</span> </span><span class="WHIT">			</span><span class="NAME">nodeConf.publishModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">50</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2249</span> </span><span class="WHIT">			</span><span class="NAME">nodeConf.sessionDependentItems</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.isClearAfterSessionRemoved</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2250</span> </span><span class="WHIT">			</span><span class="NAME">nodeConf.modifyAnyItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2251</span> </span><span class="WHIT">			</span><span class="NAME">this.collectionNode.createNode</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nodeConf</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2252</span> </span><span class="WHIT">			
<span class='line'>2253</span> 			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.cachedValueForSync</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2254</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.value</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">					
<span class='line'>2255</span> 					</span><span class="NAME">this.setValue</span><span class="PUNC">(</span><span class="NAME">this.cachedValueForSync</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2256</span> </span><span class="WHIT">					</span><span class="NAME">this.cachedValueForSync</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2257</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2258</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2259</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.value</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.itemReceived</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">	</span><span class="COMM">//this happens on disconnect</span><span class="WHIT">
<span class='line'>2260</span> </span><span class="WHIT">					</span><span class="COMM">//this is if you never got an item, you still want to say "I'm ready!"</span><span class="WHIT">
<span class='line'>2261</span> </span><span class="WHIT">					</span><span class="NAME">this.value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2262</span> </span><span class="WHIT">					</span><span class="NAME">dispatchEvent</span><span class="PUNC">(</span><span class="STRN">"change"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2263</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2264</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2265</span> </span><span class="WHIT">			
<span class='line'>2266</span> 		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2267</span> </span><span class="WHIT">		
<span class='line'>2268</span> 		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.tempAccessModel</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.tempPublishModel</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2269</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.tempAccessModel</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2270</span> </span><span class="WHIT">				</span><span class="NAME">this.accessModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.tempAccessModel</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2271</span> </span><span class="WHIT">				</span><span class="NAME">this.tempAccessModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2272</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2273</span> </span><span class="WHIT">			
<span class='line'>2274</span> 			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.tempPublishModel</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2275</span> </span><span class="WHIT">				</span><span class="NAME">this.publishModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.tempPublishModel</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2276</span> </span><span class="WHIT">				</span><span class="NAME">this.tempPublishModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2277</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2278</span> </span><span class="WHIT">			
<span class='line'>2279</span> 			</span><span class="NAME">this.commitProperties</span><span class="WHIT">
<span class='line'>2280</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2281</span> </span><span class="WHIT">		
<span class='line'>2282</span> 	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2283</span> </span><span class="WHIT">		</span><span class="NAME">this.cachedValueForSync</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2284</span> </span><span class="WHIT">		</span><span class="NAME">this.cachedValueForSending</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2285</span> </span><span class="WHIT">		</span><span class="NAME">this.itemReceived</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2286</span> </span><span class="WHIT">		</span><span class="NAME">clearTimeout</span><span class="PUNC">(</span><span class="NAME">this.sendDataTimer</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2287</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2288</span> </span><span class="WHIT">	</span><span class="NAME">p_evt.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2289</span> </span><span class="WHIT">	</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2290</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2291</span> 
<span class='line'>2292</span> </span><span class="COMM">/**
<span class='line'>2293</span>  * @private
<span class='line'>2294</span>  */</span><span class="WHIT">
<span class='line'>2295</span> </span><span class="NAME">SharedProperty.prototype.itemReceive</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2296</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2297</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_evt.item.nodeName</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2298</span> </span><span class="WHIT">		</span><span class="NAME">this.value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.item.body</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2299</span> </span><span class="WHIT">		</span><span class="NAME">this.itemReceived</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2300</span> </span><span class="WHIT">		</span><span class="NAME">this.cachedValueForSync</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2301</span> </span><span class="WHIT">		
<span class='line'>2302</span> 		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2303</span> </span><span class="WHIT">		</span><span class="NAME">evt.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"change"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2304</span> </span><span class="WHIT">		</span><span class="NAME">evt.value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.value</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2305</span> </span><span class="WHIT">		</span><span class="NAME">p_evt.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2306</span> </span><span class="WHIT">		</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2307</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2308</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2309</span> 
<span class='line'>2310</span> </span><span class="COMM">/**
<span class='line'>2311</span>  * @private
<span class='line'>2312</span>  */</span><span class="WHIT">
<span class='line'>2313</span> </span><span class="NAME">SharedProperty.prototype.myRoleChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2314</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2315</span> </span><span class="WHIT">	</span><span class="COMM">//TODO: Peldi clean up my model if I have to?</span><span class="WHIT">
<span class='line'>2316</span> </span><span class="WHIT">	</span><span class="NAME">p_evt.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2317</span> </span><span class="WHIT">	</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2318</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2319</span> 
<span class='line'>2320</span> </span><span class="COMM">/**
<span class='line'>2321</span>  * @private
<span class='line'>2322</span>  */</span><span class="WHIT">
<span class='line'>2323</span> </span><span class="NAME">SharedProperty.prototype.commitProperties</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2324</span> </span><span class="PUNC">{</span><span class="WHIT">	
<span class='line'>2325</span> 	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodeConf</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2326</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.publishModel</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">publishModel</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">this.publishModel</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2327</span> </span><span class="WHIT">		</span><span class="NAME">nodeConf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2328</span> </span><span class="WHIT">		</span><span class="NAME">nodeConf.publishModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.publishModel</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2329</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.setNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">,</span><span class="NAME">nodeConf</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2330</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2331</span> </span><span class="WHIT">	
<span class='line'>2332</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.accessModel</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">accessModel</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">_accessModel</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2333</span> </span><span class="WHIT">		</span><span class="NAME">nodeConf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2334</span> </span><span class="WHIT">		</span><span class="NAME">nodeConf.accessModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.accessModel</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2335</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.setNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nodeConf</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2336</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2337</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2338</span> 
<span class='line'>2339</span> </span><span class="COMM">/**
<span class='line'>2340</span>  *@private
<span class='line'>2341</span>  */</span><span class="WHIT">
<span class='line'>2342</span> </span><span class="NAME">SharedProperty.prototype.onTimerComplete</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2343</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2344</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">msg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">MessageItem</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2345</span> </span><span class="WHIT">	</span><span class="NAME">msg.nodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.nodeName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2346</span> </span><span class="WHIT">	</span><span class="NAME">msg.body</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args.cachedValueForSending</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2347</span> </span><span class="WHIT">	</span><span class="NAME">args.collectionNode.publishItem</span><span class="PUNC">(</span><span class="NAME">msg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2348</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2349</span> 
<span class='line'>2350</span> </span><span class="COMM">/**
<span class='line'>2351</span>  * @class Baton is a model class which provides a workflow between users. Essentially, it tracks the "holder" of a given resource and provides APIs for grabbing, putting down, and giving control to others. Users with an owner role always have the power to grab the baton, put it down, or give it to others regardless of who has the baton. Users with a publisher role must wait according to the grabbable property:
<span class='line'>2352</span>  *
<span class='line'>2353</span>  *    * If the baton is set to grabbable, they may grab the baton as soon as it is available (since it will then have no controller).
<span class='line'>2354</span>  *    * If the baton is not grabbable, the owner must explicitly pass the baton to someone else. 
<span class='line'>2355</span>  *
<span class='line'>2356</span>  * Note that users with an owner role may adjust the roles of other users relative to the baton using allowUserToGrab (which makes that user a publisher) and allowUserToAdminister (which makes that user an owner).
<span class='line'>2357</span>  *
<span class='line'>2358</span>  * This component also supports "piggybacking" on existing CollectionNodes through its constructor. Developers can avoid CollectionNode proliferation in their applications by pre-supplying a CollectionNode and a nodeName for the baton to use. If none is supplied, the baton will create its own collection node for sending and receiving messages.
<span class='line'>2359</span>  * &lt;table>&lt;tr>&lt;th>&lt;b>Event&lt;/b>&lt;/th>&lt;th>&lt;b>Summary&lt;/b>&lt;/th>&lt;/tr>
<span class='line'>2360</span>  * &lt;tr>&lt;td valign="top">&lt;code>batonHolderChange &lt;/code>&lt;/td> &lt;td> Dispatched when the baton is given to someone or put down.&lt;/td>&lt;/tr>
<span class='line'>2361</span>  * &lt;tr>&lt;td valign="top">&lt;code>synchronizationChange&lt;/code>&lt;/td> &lt;td> Dispatched when the component has fully connected and synchronized with the service or when it loses the connection.&lt;/td>&lt;/tr>
<span class='line'>2362</span>  * &lt;/table> 
<span class='line'>2363</span>  * @constructor
<span class='line'>2364</span>  */</span><span class="WHIT">
<span class='line'>2365</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">Baton</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2366</span> </span><span class="WHIT">	</span><span class="NAME">this.connectSession</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ConnectSession.primarySession</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2367</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2368</span> 
<span class='line'>2369</span> </span><span class="COMM">/**
<span class='line'>2370</span>  * The the Node Name to which the value is published
<span class='line'>2371</span>  * @field
<span class='line'>2372</span>  */</span><span class="WHIT">
<span class='line'>2373</span> 
<span class='line'>2374</span> </span><span class="NAME">Baton.prototype.nodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"holderID"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2375</span> </span><span class="COMM">/**
<span class='line'>2376</span>  * The Collection Node to which the shared property subscribes/publishes
<span class='line'>2377</span>  * @field
<span class='line'>2378</span>  */</span><span class="WHIT">
<span class='line'>2379</span> 
<span class='line'>2380</span> </span><span class="NAME">Baton.prototype.collectionNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2381</span> </span><span class="COMM">/**
<span class='line'>2382</span>  * Specifies the &lt;code>userID&lt;/code> of the person controlling the baton. Returns null if 
<span class='line'>2383</span>  * noone has the baton. For example, this function might be used to create a "controlled 
<span class='line'>2384</span>  * by XXX" tooltip for your component.
<span class='line'>2385</span>  * @field
<span class='line'>2386</span>  */</span><span class="WHIT">
<span class='line'>2387</span> </span><span class="NAME">Baton.prototype.holderID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2388</span> </span><span class="COMM">/**
<span class='line'>2389</span>  * Defines the logical location of the component on the service - typically this assigns the sharedID of the collectionNode
<span class='line'>2390</span>  * used by the component. sharedIDs should be unique within a room (if they're expressing 2 unique locations). Note that
<span class='line'>2391</span>  * this can only be assigned once (before &lt;code>subscribe()&lt;/code> is called). For components with an &lt;code>id&lt;/code> property, 
<span class='line'>2392</span>  * sharedID defaults to that value.
<span class='line'>2393</span>  * @field
<span class='line'>2394</span>  */</span><span class="WHIT">
<span class='line'>2395</span> </span><span class="NAME">Baton.prototype.sharedID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Baton"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2396</span> </span><span class="COMM">/**
<span class='line'>2397</span>  * @private
<span class='line'>2398</span>  */</span><span class="WHIT">
<span class='line'>2399</span> </span><span class="NAME">Baton.prototype.pubModelForControlling</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">50</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2400</span> </span><span class="COMM">/**
<span class='line'>2401</span>  * @private
<span class='line'>2402</span>  */</span><span class="WHIT">
<span class='line'>2403</span> </span><span class="NAME">Baton.prototype.pubModelForYanking</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2404</span> </span><span class="COMM">/**
<span class='line'>2405</span>  * @private
<span class='line'>2406</span>  */</span><span class="WHIT">
<span class='line'>2407</span> </span><span class="NAME">Baton.prototype.cachedBatonHolderID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2408</span> </span><span class="COMM">/**
<span class='line'>2409</span>  * @private
<span class='line'>2410</span>  */</span><span class="WHIT">
<span class='line'>2411</span> </span><span class="NAME">Baton.prototype.userManager</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2412</span> </span><span class="COMM">/**
<span class='line'>2413</span>  * @private
<span class='line'>2414</span>  */</span><span class="WHIT">
<span class='line'>2415</span> </span><span class="NAME">Baton.prototype.inSync</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">		
<span class='line'>2416</span> </span><span class="COMM">/**
<span class='line'>2417</span>  * @private
<span class='line'>2418</span>  */</span><span class="WHIT">
<span class='line'>2419</span> </span><span class="NAME">Baton.prototype.yankable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2420</span> </span><span class="COMM">/**
<span class='line'>2421</span>  * @private
<span class='line'>2422</span>  */</span><span class="WHIT">
<span class='line'>2423</span> </span><span class="NAME">Baton.prototype.grabbable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2424</span> </span><span class="COMM">/**
<span class='line'>2425</span>  * Role value which is required for seeing the baton
<span class='line'>2426</span>  * @field
<span class='line'>2427</span>  */</span><span class="WHIT">
<span class='line'>2428</span> </span><span class="NAME">Baton.prototype.accessModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2429</span> </span><span class="COMM">/**
<span class='line'>2430</span>  * Role value which is required for publishing to the baton
<span class='line'>2431</span>  * @field
<span class='line'>2432</span>  */</span><span class="WHIT">
<span class='line'>2433</span> </span><span class="NAME">Baton.prototype.publishModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2434</span> </span><span class="COMM">/**
<span class='line'>2435</span>  * The ConnectSession with which this component is associated. Note that this may only be set once before &lt;code>subscribe&lt;/code>
<span class='line'>2436</span>  * is called; re-sessioning of components is not supported.
<span class='line'>2437</span>  * @field
<span class='line'>2438</span>  */</span><span class="WHIT">
<span class='line'>2439</span> </span><span class="NAME">Baton.prototype.connectSession</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2440</span> </span><span class="COMM">/**
<span class='line'>2441</span>  * Number of seconds after which the baton times out
<span class='line'>2442</span>  * @field
<span class='line'>2443</span>  */</span><span class="WHIT"> 
<span class='line'>2444</span> </span><span class="NAME">Baton.prototype.timeOut</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2445</span> </span><span class="COMM">/**
<span class='line'>2446</span>  * @private
<span class='line'>2447</span>  */</span><span class="WHIT">
<span class='line'>2448</span> </span><span class="NAME">Baton.prototype.autoPutDownTimer</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2449</span> 
<span class='line'>2450</span> </span><span class="NAME">EventDispatcher.initialize</span><span class="PUNC">(</span><span class="NAME">Baton.prototype</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2451</span> 
<span class='line'>2452</span> </span><span class="COMM">/**
<span class='line'>2453</span>  * Tells the component to begin synchronizing with the service.  
<span class='line'>2454</span>  * This method must be called explicitly.
<span class='line'>2455</span>  * @function
<span class='line'>2456</span>  */</span><span class="WHIT">
<span class='line'>2457</span> </span><span class="NAME">Baton.prototype.subscribe</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2458</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2459</span> </span><span class="WHIT">	</span><span class="NAME">this.userManager</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.connectSession.userManager</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2460</span> </span><span class="WHIT">	</span><span class="COMM">//this.autoPutDownTimer=setTimeout(this.onTimerComplete,this.timeOut*1000,this);</span><span class="WHIT">
<span class='line'>2461</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.collectionNode</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">			
<span class='line'>2462</span> 		</span><span class="NAME">this.collectionNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">CollectionNode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2463</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.sharedID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.sharedID</span><span class="WHIT">  </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2464</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.connectSession</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.connectSession</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2465</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.subscribe</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2466</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2467</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.collectionNode.isSynchronized</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2468</span> </span><span class="WHIT">			</span><span class="NAME">this.synchronizationChange</span><span class="PUNC">(</span><span class="STRN">"synchronizationChange"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2469</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2470</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2471</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.addEventListener</span><span class="PUNC">(</span><span class="STRN">"synchronizationChange"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				
<span class='line'>2472</span> 	</span><span class="NAME">this.collectionNode.addEventListener</span><span class="PUNC">(</span><span class="STRN">"itemReceive"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2473</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.addEventListener</span><span class="PUNC">(</span><span class="STRN">"itemRetract"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2474</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2475</span> 
<span class='line'>2476</span> 
<span class='line'>2477</span> </span><span class="COMM">/**
<span class='line'>2478</span>  * Gets the NodeConfiguration of the Baton Node.
<span class='line'>2479</span>  * @function
<span class='line'>2480</span>  */</span><span class="WHIT">
<span class='line'>2481</span> </span><span class="NAME">Baton.prototype.getNodeConfiguration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2482</span> </span><span class="PUNC">{</span><span class="WHIT">	
<span class='line'>2483</span> 	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2484</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2485</span> 
<span class='line'>2486</span> </span><span class="COMM">/**
<span class='line'>2487</span>  * Sets the NodeConfiguration on the baton node.
<span class='line'>2488</span>  * @param p_nodeConfiguration The node Configuration of the baton node to be set.
<span class='line'>2489</span>  * @function
<span class='line'>2490</span>  * 
<span class='line'>2491</span>  */</span><span class="WHIT">
<span class='line'>2492</span> </span><span class="NAME">Baton.prototype.setNodeConfiguration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_nodeConfiguration</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2493</span> </span><span class="PUNC">{</span><span class="WHIT">	
<span class='line'>2494</span> 	</span><span class="NAME">this.collectionNode.setNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">,</span><span class="NAME">p_nodeConfiguration</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2495</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2496</span> 
<span class='line'>2497</span> </span><span class="COMM">/**
<span class='line'>2498</span>  * Set the Role Value required to publish the baton
<span class='line'>2499</span>  * @function
<span class='line'>2500</span>  */</span><span class="WHIT">
<span class='line'>2501</span> </span><span class="NAME">Baton.prototype.setPublishModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_publishModel</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2502</span> </span><span class="PUNC">{</span><span class="WHIT">	
<span class='line'>2503</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">p_publishModel</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">p_publishModel</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>2504</span> 	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2505</span> </span><span class="WHIT">		</span><span class="NAME">this.publishModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_publishModel</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2506</span> </span><span class="WHIT">		</span><span class="NAME">this.commitProperties</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2507</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2508</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2509</span> 
<span class='line'>2510</span> </span><span class="COMM">/**
<span class='line'>2511</span>  * Role Value required to publish the baton
<span class='line'>2512</span>  * @function
<span class='line'>2513</span>  */</span><span class="WHIT">
<span class='line'>2514</span> </span><span class="NAME">Baton.prototype.getPublishModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2515</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2516</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">publishModel</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2517</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2518</span> 
<span class='line'>2519</span> </span><span class="COMM">/**
<span class='line'>2520</span>  * Set the role value which is required for seeing the baton
<span class='line'>2521</span>  * @function
<span class='line'>2522</span>  */</span><span class="WHIT">
<span class='line'>2523</span> </span><span class="NAME">Baton.prototype.setAccessModel</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_accessModel</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2524</span> </span><span class="PUNC">{</span><span class="WHIT">	
<span class='line'>2525</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">p_accessModel</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">p_accessModel</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>2526</span> 	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2527</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.isSynchronized</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2528</span> </span><span class="WHIT">			</span><span class="NAME">this.accessModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_accessModel</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2529</span> </span><span class="WHIT">			</span><span class="NAME">this.commitProperties</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2530</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2531</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2532</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2533</span> </span><span class="COMM">/**
<span class='line'>2534</span>  * Role value which is required for seeing the baton
<span class='line'>2535</span>  * @function
<span class='line'>2536</span>  */</span><span class="WHIT">
<span class='line'>2537</span> </span><span class="NAME">Baton.prototype.getAccessModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2538</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2539</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">accessModel</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2540</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2541</span> 
<span class='line'>2542</span> 
<span class='line'>2543</span> </span><span class="COMM">/**
<span class='line'>2544</span>  *  Returns the role of a given user for the baton.
<span class='line'>2545</span>  * 
<span class='line'>2546</span>  * @param p_userID UserID of the user in question
<span class='line'>2547</span>  * @function
<span class='line'>2548</span>  */</span><span class="WHIT">
<span class='line'>2549</span> </span><span class="NAME">Baton.prototype.getUserRole</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2550</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2551</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getUserRole</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2552</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2553</span> 
<span class='line'>2554</span> </span><span class="COMM">/**
<span class='line'>2555</span>  * Determines whether the component has connected to the server and has fully synchronized.
<span class='line'>2556</span>  * @function
<span class='line'>2557</span>  */</span><span class="WHIT">
<span class='line'>2558</span> </span><span class="NAME">Baton.prototype.isSynchronized</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2559</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2560</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.isSynchronized</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2561</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2562</span> 
<span class='line'>2563</span> </span><span class="COMM">/**
<span class='line'>2564</span>  * Determines whether the current user has permission to administer the baton 
<span class='line'>2565</span>  * by taking it from someone or forcing them to put it down.
<span class='line'>2566</span>  * @function
<span class='line'>2567</span>  */</span><span class="WHIT">
<span class='line'>2568</span> </span><span class="NAME">Baton.prototype.canIAdminister</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2569</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2570</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.canUserAdminister</span><span class="PUNC">(</span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2571</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2572</span> 
<span class='line'>2573</span> </span><span class="COMM">/**
<span class='line'>2574</span>  * Determines whether a specified user can administer the baton from others. 
<span class='line'>2575</span>  * 
<span class='line'>2576</span>  * @param p_userID The &lt;code>userID&lt;/code> of the user to check if they have 
<span class='line'>2577</span>  * adminstrator rights.
<span class='line'>2578</span>  * @function
<span class='line'>2579</span>  */</span><span class="WHIT">		
<span class='line'>2580</span> </span><span class="NAME">Baton.prototype.canUserAdminister</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2581</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2582</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.yankable</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getUserRole</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">this.pubModelForYanking</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2583</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2584</span> 
<span class='line'>2585</span> </span><span class="COMM">/**
<span class='line'>2586</span>  * Determines whether the current user has permission to grab the baton 
<span class='line'>2587</span>  * when available.
<span class='line'>2588</span>  * @function
<span class='line'>2589</span>  */</span><span class="WHIT">
<span class='line'>2590</span> </span><span class="NAME">Baton.prototype.canIGrab</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2591</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2592</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.canUserGrab</span><span class="PUNC">(</span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2593</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2594</span> 
<span class='line'>2595</span> </span><span class="COMM">/**
<span class='line'>2596</span>  * Determines whether a specified user can grab the baton if it's available.
<span class='line'>2597</span>  * 
<span class='line'>2598</span>  * @param p_userID  The &lt;code>userID&lt;/code> of the user to check if they 
<span class='line'>2599</span>  * can grab the baton.
<span class='line'>2600</span>  * @function
<span class='line'>2601</span>  */</span><span class="WHIT">
<span class='line'>2602</span> </span><span class="NAME">Baton.prototype.canUserGrab</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2603</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2604</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.grabbable</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getUserRole</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">this.pubModelForControlling</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2605</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2606</span> 
<span class='line'>2607</span> </span><span class="COMM">/**
<span class='line'>2608</span>  * When called by an owner, &lt;code>setUserRole()&lt;/code> sets the role of the specified 
<span class='line'>2609</span>  * user with respect to this baton. The following rules apply: 
<span class='line'>2610</span>  * &lt;ul>
<span class='line'>2611</span>  * &lt;li>Setting the role to &lt;code>UserRoles.PUBLISHER&lt;/code> allows the user to grab the baton. &lt;/li>
<span class='line'>2612</span>  * &lt;li>Setting the role to &lt;code>UserRoles.OWNER&lt;/code> allows the user to administer the baton.&lt;/li> 
<span class='line'>2613</span>  * &lt;li>Setting to &lt;code>UserRoles.VIEWER&lt;/code> will allow neither.&lt;/li>
<span class='line'>2614</span>  * &lt;/ul>
<span class='line'>2615</span>  * 
<span class='line'>2616</span>  * @param p_userID The &lt;code>userID&lt;/code> of the user to set the role for. 
<span class='line'>2617</span>  * @param p_role The new role for that user.
<span class='line'>2618</span>  * @function
<span class='line'>2619</span>  */</span><span class="WHIT">
<span class='line'>2620</span> </span><span class="NAME">Baton.prototype.setUserRole</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_role</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2621</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2622</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">p_userID</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2623</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2624</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_role</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">p_role</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">p_role</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">999</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2625</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2626</span> </span><span class="WHIT">			</span><span class="NAME">this.collectionNode.setUserRole</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_role</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2627</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2628</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2629</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2630</span> 
<span class='line'>2631</span> 
<span class='line'>2632</span> </span><span class="COMM">/**
<span class='line'>2633</span>  * Determines whether the current user is holding the baton.
<span class='line'>2634</span>  * @function
<span class='line'>2635</span>  */</span><span class="WHIT">
<span class='line'>2636</span> </span><span class="NAME">Baton.prototype.amIHolding</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2637</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2638</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.holderID</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2639</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2640</span> 
<span class='line'>2641</span> </span><span class="COMM">/**
<span class='line'>2642</span>  * Determines whether the baton is up for grabs because it has no current holder.
<span class='line'>2643</span>  * @function
<span class='line'>2644</span>  */</span><span class="WHIT">
<span class='line'>2645</span> </span><span class="NAME">Baton.prototype.available</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2646</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2647</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.holderID</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.grabbable</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2648</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2649</span> 
<span class='line'>2650</span> </span><span class="COMM">/**
<span class='line'>2651</span>  * Cleans up all networking and event handling; recommended for garbage collection.
<span class='line'>2652</span>  * @function
<span class='line'>2653</span>  */</span><span class="WHIT">
<span class='line'>2654</span> </span><span class="NAME">Baton.prototype.close</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2655</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2656</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.unsubscribe</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2657</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2658</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2659</span> 
<span class='line'>2660</span> </span><span class="COMM">/**
<span class='line'>2661</span>  * If grabbable, users with a publisher role can grab the control if it's available 
<span class='line'>2662</span>  * by using this method. Users with an owner role may grab the baton at any time.
<span class='line'>2663</span>  * @function
<span class='line'>2664</span>  */</span><span class="WHIT">
<span class='line'>2665</span> </span><span class="NAME">Baton.prototype.grab</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2666</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2667</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.canIAdminister</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2668</span> </span><span class="WHIT">		</span><span class="COMM">// if I can Yank, don't worry about other</span><span class="WHIT">
<span class='line'>2669</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">this.available</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">this.canIGrab</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2670</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2671</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2672</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2673</span> </span><span class="WHIT">	
<span class='line'>2674</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.amIHolding</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2675</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2676</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2677</span> </span><span class="WHIT">	
<span class='line'>2678</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.isSynchronized</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2679</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">msgItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">MessageItem</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2680</span> </span><span class="WHIT">		</span><span class="NAME">msgItem.nodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="NAME">this.nodeName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2681</span> </span><span class="WHIT">		</span><span class="NAME">msgItem.body</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2682</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.publishItem</span><span class="PUNC">(</span><span class="NAME">msgItem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2683</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2684</span> </span><span class="WHIT">		</span><span class="NAME">this.cachedBatonHolderID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2685</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2686</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2687</span> 
<span class='line'>2688</span> </span><span class="COMM">/**
<span class='line'>2689</span>  * Users with an publisher role in control can use this method to 
<span class='line'>2690</span>  * release their control. Users with an owner role  can use this method 
<span class='line'>2691</span>  * to remove the baton from a user who has it.
<span class='line'>2692</span>  * @function
<span class='line'>2693</span>  */</span><span class="WHIT">
<span class='line'>2694</span> </span><span class="NAME">Baton.prototype.putDown</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2695</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2696</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.available</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2697</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2698</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2699</span> </span><span class="WHIT">	
<span class='line'>2700</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.canIAdminister</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">this.amIHolding</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2701</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2702</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">			
<span class='line'>2703</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.isSynchronized</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">				
<span class='line'>2704</span> 		</span><span class="NAME">this.collectionNode.retractItem</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2705</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2706</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2707</span> 
<span class='line'>2708</span> </span><span class="COMM">/**
<span class='line'>2709</span>  * If the baton is grabbable, the holding user can hand the baton to a specified user. 
<span class='line'>2710</span>  * A user with an owner role can give a baton to anyone with the required permissions 
<span class='line'>2711</span>  * at any time.
<span class='line'>2712</span>  * 
<span class='line'>2713</span>  * @param p_userID  The &lt;code>userID&lt;/code> of the user to allow to grab the baton.
<span class='line'>2714</span>  * @function
<span class='line'>2715</span>  */</span><span class="WHIT">
<span class='line'>2716</span> </span><span class="NAME">Baton.prototype.giveTo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2717</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2718</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.canIAdminister</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.grabbable</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">this.amIHolding</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2719</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2720</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2721</span> </span><span class="WHIT">	
<span class='line'>2722</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.isSynchronized</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2723</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">msgItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">MessageItem</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2724</span> </span><span class="WHIT">		</span><span class="NAME">msgItem.nodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="NAME">this.nodeName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2725</span> </span><span class="WHIT">		</span><span class="NAME">msgItem.body</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_userID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2726</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.publishItem</span><span class="PUNC">(</span><span class="NAME">msgItem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2727</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2728</span> </span><span class="WHIT">		</span><span class="NAME">this.cachedBatonHolderID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_userID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2729</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2730</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2731</span> 
<span class='line'>2732</span> </span><span class="COMM">/**
<span class='line'>2733</span>  *@private
<span class='line'>2734</span>  */</span><span class="WHIT">
<span class='line'>2735</span> </span><span class="NAME">Baton.prototype.synchronizationChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2736</span> </span><span class="PUNC">{</span><span class="WHIT">						
<span class='line'>2737</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.isSynchronized</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2738</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.collectionNode.isNodeDefined</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">	</span><span class="COMM">//we're the first ones here</span><span class="WHIT">
<span class='line'>2739</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodeConf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">NodeConfiguration</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2740</span> </span><span class="WHIT">			</span><span class="NAME">nodeConf.accessModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2741</span> </span><span class="WHIT">			</span><span class="NAME">nodeConf.publishModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.pubModelForControlling</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2742</span> </span><span class="WHIT">			</span><span class="NAME">nodeConf.modifyAnyItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2743</span> </span><span class="WHIT">			</span><span class="NAME">nodeConf.userDependentItems</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2744</span> </span><span class="WHIT">			</span><span class="NAME">this.collectionNode.createNode</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nodeConf</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2745</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2746</span> </span><span class="WHIT">		
<span class='line'>2747</span> 		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.holderID</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.cachedBatonHolderID</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">	</span><span class="COMM">//this will work but I don't like it...we might want to use this.holderIDSetFromNetwork</span><span class="WHIT">
<span class='line'>2748</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.getUserRole</span><span class="PUNC">(</span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">this.pubModelForYanking</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2749</span> </span><span class="WHIT">				</span><span class="NAME">this.giveTo</span><span class="PUNC">(</span><span class="NAME">this.cachedBatonHolderID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2750</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.canIGrab</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.cachedBatonHolderID</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">this.userManager.myUserID</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2751</span> </span><span class="WHIT">				</span><span class="NAME">this.grab</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2752</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2753</span> </span><span class="WHIT">			</span><span class="NAME">this.cachedBatonHolderID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2754</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2755</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2756</span> </span><span class="WHIT">		</span><span class="NAME">clearTimeout</span><span class="PUNC">(</span><span class="NAME">this.autoPutDownTimer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2757</span> </span><span class="WHIT">		</span><span class="NAME">this.cachedBatonHolderID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2758</span> </span><span class="WHIT">		</span><span class="NAME">this.holderID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2759</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2760</span> </span><span class="WHIT">	</span><span class="NAME">p_evt.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2761</span> </span><span class="WHIT">	</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="COMM">//bubble it</span><span class="WHIT">
<span class='line'>2762</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2763</span> 
<span class='line'>2764</span> </span><span class="COMM">/**
<span class='line'>2765</span>  *@private
<span class='line'>2766</span>  */</span><span class="WHIT">
<span class='line'>2767</span> </span><span class="NAME">Baton.prototype.itemReceive</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2768</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2769</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">theItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.item</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2770</span> </span><span class="WHIT">	
<span class='line'>2771</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">theItem.nodeName</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2772</span> </span><span class="WHIT">		</span><span class="NAME">this.holderID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">theItem.body</span><span class="PUNC">;</span><span class="WHIT">	
<span class='line'>2773</span> 		</span><span class="NAME">this.cachedBatonHolderID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2774</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.amIHolding</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.timeOut</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2775</span> </span><span class="WHIT">			</span><span class="NAME">this.autoPutDownTimer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">bindUsingClosure</span><span class="PUNC">(</span><span class="NAME">this.onTimerComplete</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.timeOut</span><span class="PUNC">*</span><span class="NUMB">1000</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2776</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2777</span> </span><span class="WHIT">		</span><span class="NAME">p_evt.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2778</span> </span><span class="WHIT">		</span><span class="NAME">p_evt.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"batonHolderChange"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2779</span> </span><span class="WHIT">		</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2780</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">			
<span class='line'>2781</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2782</span> 
<span class='line'>2783</span> </span><span class="COMM">/**
<span class='line'>2784</span>  *@private
<span class='line'>2785</span>  */</span><span class="WHIT">
<span class='line'>2786</span> </span><span class="NAME">Baton.prototype.itemRetract</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2787</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2788</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_evt.nodeName</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">			</span><span class="COMM">//no need to check the itemID, I only have one</span><span class="WHIT">
<span class='line'>2789</span> </span><span class="WHIT">		</span><span class="NAME">this.holderID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2790</span> </span><span class="WHIT">		</span><span class="NAME">this.cachedBatonHolderID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2791</span> </span><span class="WHIT">		</span><span class="NAME">p_evt.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2792</span> </span><span class="WHIT">		</span><span class="NAME">p_evt.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"batonHolderChange"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2793</span> </span><span class="WHIT">		</span><span class="NAME">clearTimeout</span><span class="PUNC">(</span><span class="NAME">this.autoPutDownTimer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2794</span> </span><span class="WHIT">		</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2795</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2796</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2797</span> 
<span class='line'>2798</span> 
<span class='line'>2799</span> </span><span class="COMM">/**
<span class='line'>2800</span>  *@private
<span class='line'>2801</span>  */</span><span class="WHIT">
<span class='line'>2802</span> </span><span class="NAME">Baton.prototype.commitProperties</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2803</span> </span><span class="PUNC">{</span><span class="WHIT">	
<span class='line'>2804</span> 	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodeConf</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2805</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.publishModel</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">publishModel</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">this.publishModel</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2806</span> </span><span class="WHIT">		</span><span class="NAME">nodeConf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2807</span> </span><span class="WHIT">		</span><span class="NAME">nodeConf.publishModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.publishModel</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2808</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.setNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">,</span><span class="NAME">nodeConf</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2809</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2810</span> </span><span class="WHIT">	
<span class='line'>2811</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.accessModel</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">accessModel</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">this.accessModel</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2812</span> </span><span class="WHIT">		</span><span class="NAME">nodeConf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2813</span> </span><span class="WHIT">		</span><span class="NAME">nodeConf.accessModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.accessModel</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2814</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.setNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nodeConf</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2815</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2816</span> </span><span class="WHIT">	
<span class='line'>2817</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2818</span> 
<span class='line'>2819</span> </span><span class="COMM">/**
<span class='line'>2820</span>  *@private
<span class='line'>2821</span>  */</span><span class="WHIT">
<span class='line'>2822</span> </span><span class="NAME">Baton.prototype.onTimerComplete</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2823</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2824</span> </span><span class="WHIT">	</span><span class="NAME">args.collectionNode.retractItem</span><span class="PUNC">(</span><span class="NAME">args.nodeName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2825</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2826</span> 
<span class='line'>2827</span> </span><span class="COMM">/**
<span class='line'>2828</span>  * Extends the timeout if the baton has one. 
<span class='line'>2829</span>  */</span><span class="WHIT">
<span class='line'>2830</span> </span><span class="NAME">Baton.prototype.extendTimer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2831</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2832</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.autoPutDownTimer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2833</span> </span><span class="WHIT">		</span><span class="NAME">clearTimeout</span><span class="PUNC">(</span><span class="NAME">this.autoPutDownTimer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2834</span> </span><span class="WHIT">		</span><span class="NAME">this.autoPutDownTimer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2835</span> </span><span class="WHIT">		</span><span class="NAME">this.autoPutDownTimer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">bindUsingClosure</span><span class="PUNC">(</span><span class="NAME">this.onTimerComplete</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.timeOut</span><span class="PUNC">*</span><span class="NUMB">1000</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2836</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2837</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2838</span> 
<span class='line'>2839</span> </span><span class="COMM">/**
<span class='line'>2840</span>  * @class BatonProperty is a model component which manages a property of any type that 
<span class='line'>2841</span>  * only one user can edit at a time. It exposes a standard Baton component to 
<span class='line'>2842</span>  * manage this workflow.
<span class='line'>2843</span>  * &lt;p>
<span class='line'>2844</span>  * This component supports "piggybacking" on existing CollectionNodes through its 
<span class='line'>2845</span>  * constructor. Developers can avoid CollectionNode proliferation in their applications
<span class='line'>2846</span>  * by pre-supplying a CollectionNode and a &lt;code>nodeName&lt;/code> for the &lt;code>
<span class='line'>2847</span>  * BatonProperty&lt;/code> to use. If none is supplied, the &lt;code>BatonProperty&lt;/code> will 
<span class='line'>2848</span>  * create its own CollectionNode for sending and receiving messages.
<span class='line'>2849</span>  * &lt;table>&lt;tr>&lt;th>&lt;b>Event&lt;/b>&lt;/th>&lt;th>&lt;b>Summary&lt;/b>&lt;/th>&lt;/tr>
<span class='line'>2850</span>  * &lt;tr>&lt;td valign="top">&lt;code>batonHolderChange &lt;/code>&lt;/td> &lt;td> Dispatched when the baton holder for the string is assigned or when the string becomes available.&lt;/td>&lt;/tr>
<span class='line'>2851</span>  * &lt;tr>&lt;td valign="top">&lt;code>change &lt;/code>&lt;/td> &lt;td> Dispatched when the value of the property is changed: it is subject to round tripping to the service.&lt;/td>&lt;/tr>
<span class='line'>2852</span>  * &lt;tr>&lt;td valign="top">&lt;code>myRoleChange&lt;/code>&lt;/td> &lt;td> Dispatched when the user's role with respect to this SharedProperty  changes.&lt;/td>&lt;/tr>
<span class='line'>2853</span>  * &lt;tr>&lt;td valign="top">&lt;code>synchronizationChange&lt;/code>&lt;/td> &lt;td> Dispatched when the SharedProperty goes in and out of sync.&lt;/td>&lt;/tr>
<span class='line'>2854</span>  * &lt;/table> 
<span class='line'>2855</span>  * @constructor
<span class='line'>2856</span>  */</span><span class="WHIT">
<span class='line'>2857</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">BatonProperty</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2858</span> </span><span class="WHIT">	</span><span class="NAME">this.baton</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Baton</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2859</span> </span><span class="WHIT">	</span><span class="NAME">this.connectSession</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ConnectSession.primarySession</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2860</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2861</span> 
<span class='line'>2862</span> </span><span class="COMM">/**
<span class='line'>2863</span>  *@private
<span class='line'>2864</span>  */</span><span class="WHIT">
<span class='line'>2865</span> </span><span class="NAME">BatonProperty.prototype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">SharedProperty</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2866</span> </span><span class="NAME">BatonProperty.prototype.constructor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">BatonProperty</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2867</span> </span><span class="COMM">/**
<span class='line'>2868</span>  *@private
<span class='line'>2869</span>  */</span><span class="WHIT">
<span class='line'>2870</span> </span><span class="NAME">BatonProperty.prototype.baton</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2871</span> </span><span class="COMM">/**
<span class='line'>2872</span>  *@private
<span class='line'>2873</span>  */</span><span class="WHIT">
<span class='line'>2874</span> </span><span class="NAME">BatonProperty.prototype.cachedValueForToggle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2875</span> </span><span class="COMM">/**
<span class='line'>2876</span>  *@private
<span class='line'>2877</span>  */</span><span class="WHIT">
<span class='line'>2878</span> </span><span class="NAME">BatonProperty.prototype.nodeNameResource</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"cID"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2879</span> </span><span class="COMM">/**
<span class='line'>2880</span>  * Defines the logical location of the component on the service - typically this assigns the sharedID of the collectionNode
<span class='line'>2881</span>  * used by the component. If this is used to "piggyback" on an existing collectionNode, sharedID specifies the nodeName
<span class='line'>2882</span>  * to use for the property itself. sharedIDs should be unique within a room (if they're expressing 2 unique locations). Note that
<span class='line'>2883</span>  * this can only be assigned once (before &lt;code>subscribe()&lt;/code> is called). For components with an &lt;code>id&lt;/code> property, 
<span class='line'>2884</span>  * sharedID defaults to that value.
<span class='line'>2885</span>  * @field
<span class='line'>2886</span>  */</span><span class="WHIT">
<span class='line'>2887</span> </span><span class="NAME">BatonProperty.prototype.sharedID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"batonProperty"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2888</span> </span><span class="NAME">EventDispatcher.initialize</span><span class="PUNC">(</span><span class="NAME">BatonProperty.prototype</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2889</span> 
<span class='line'>2890</span> </span><span class="COMM">/**
<span class='line'>2891</span>  * Sets the CollectionNode to be used in setting up the property and baton nodes, when used in "piggybacking"
<span class='line'>2892</span>  * @function
<span class='line'>2893</span>  */</span><span class="WHIT">
<span class='line'>2894</span> </span><span class="NAME">BatonProperty.prototype.setCollectionNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_collectionNode</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2895</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2896</span> </span><span class="WHIT">	</span><span class="NAME">SharedProperty.prototype.collectionNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.baton.collectionNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_collectionNode</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">	
<span class='line'>2897</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2898</span> 
<span class='line'>2899</span> </span><span class="COMM">/**
<span class='line'>2900</span>  * Node Name for the baton
<span class='line'>2901</span>  * @function
<span class='line'>2902</span>  */</span><span class="WHIT">
<span class='line'>2903</span> </span><span class="NAME">BatonProperty.prototype.setNodeNameBaton</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_nodeNameBaton</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2904</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2905</span> </span><span class="WHIT">	</span><span class="NAME">this.nodeNameResource</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_nodeNameBaton</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2906</span> </span><span class="WHIT">	</span><span class="NAME">this.baton.nodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.nodeNameResource</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">	
<span class='line'>2907</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2908</span> 
<span class='line'>2909</span> </span><span class="COMM">/**
<span class='line'>2910</span>  * When used with "piggybacking" on an existing CollectionNode, specifies the node name for the baton
<span class='line'>2911</span>  * @function
<span class='line'>2912</span>  */</span><span class="WHIT">
<span class='line'>2913</span> </span><span class="NAME">BatonProperty.prototype.getNodeNameBaton</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2914</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2915</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.baton.nodeName</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2916</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2917</span> 
<span class='line'>2918</span> 
<span class='line'>2919</span> </span><span class="COMM">/**
<span class='line'>2920</span>  * Tells the component to begin synchronizing with the service.  
<span class='line'>2921</span>  * For "headless" components such as this one, this method must be called explicitly.
<span class='line'>2922</span>  * @function
<span class='line'>2923</span>  */</span><span class="WHIT">
<span class='line'>2924</span> </span><span class="NAME">BatonProperty.prototype.subscribe</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2925</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2926</span> </span><span class="WHIT">	</span><span class="NAME">SharedProperty.prototype.subscribe.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2927</span> </span><span class="WHIT">	</span><span class="NAME">this.baton.sharedID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.sharedID</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2928</span> </span><span class="WHIT">	</span><span class="NAME">this.baton.collectionNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.collectionNode</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2929</span> </span><span class="WHIT">	</span><span class="NAME">this.baton.nodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.nodeNameResource</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2930</span> </span><span class="WHIT">	</span><span class="NAME">this.baton.connectSession</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.connectSession</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2931</span> </span><span class="WHIT">	</span><span class="NAME">this.baton.addEventListener</span><span class="PUNC">(</span><span class="STRN">"batonHolderChange"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2932</span> </span><span class="WHIT">	</span><span class="NAME">this.baton.subscribe</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2933</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2934</span> 
<span class='line'>2935</span> </span><span class="COMM">/**
<span class='line'>2936</span>  * Cleans up all listeners and network connections: recommended for garbage collection.
<span class='line'>2937</span>  * @function
<span class='line'>2938</span>  */</span><span class="WHIT">
<span class='line'>2939</span> </span><span class="NAME">BatonProperty.prototype.close</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2940</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2941</span> </span><span class="WHIT">	</span><span class="NAME">SharedProperty.prototype.close.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2942</span> </span><span class="WHIT">	</span><span class="NAME">this.baton.removeEventListener</span><span class="PUNC">(</span><span class="STRN">"batonHolderChange"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2943</span> </span><span class="WHIT">	</span><span class="NAME">this.baton.close</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2944</span> </span><span class="WHIT">	</span><span class="NAME">this.cachedValueForToggle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2945</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2946</span> 
<span class='line'>2947</span> </span><span class="COMM">/**
<span class='line'>2948</span>  * The value of the BatonProperty which a user can only set it if the user is in 
<span class='line'>2949</span>  * control of it.
<span class='line'>2950</span>  * &lt;p>
<span class='line'>2951</span>  * If the BatonProperty is not yet synchrnonized, the value will be cached and 
<span class='line'>2952</span>  * sent when the BatonProperty is back in sync.
<span class='line'>2953</span>  * &lt;p>
<span class='line'>2954</span>  * If the BatonProperty is available, setting the value will also try to grab 
<span class='line'>2955</span>  * control of the BatonProperty before setting the text.
<span class='line'>2956</span>  * @function
<span class='line'>2957</span>  */</span><span class="WHIT">
<span class='line'>2958</span> </span><span class="NAME">BatonProperty.prototype.setValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_value</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2959</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2960</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_value</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">this.value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">	</span><span class="COMM">//no need to set it again</span><span class="WHIT">
<span class='line'>2961</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2962</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2963</span> </span><span class="WHIT">	
<span class='line'>2964</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.collectionNode.isSynchronized</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2965</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.baton.amIHolding</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2966</span> </span><span class="WHIT">			</span><span class="NAME">this.cachedValueForSending</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2967</span> </span><span class="WHIT">			</span><span class="NAME">this.sendDataTimer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">bindUsingClosure</span><span class="PUNC">(</span><span class="NAME">this.onTimerComplete</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.updateInterval</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">300</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2968</span> </span><span class="WHIT">			</span><span class="NAME">this.baton.extendTimer</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2969</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.baton.available</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2970</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.cachedValueForToggle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">	</span><span class="COMM">//only toggle the first time</span><span class="WHIT">
<span class='line'>2971</span> </span><span class="WHIT">				</span><span class="NAME">this.baton.grab</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2972</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2973</span> </span><span class="WHIT">			</span><span class="NAME">this.cachedValueForToggle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_value</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="COMM">//overwrite the value that will eventually be published</span><span class="WHIT">
<span class='line'>2974</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2975</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2976</span> </span><span class="WHIT">		</span><span class="NAME">this.cachedValueForSync</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2977</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2978</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2979</span> 
<span class='line'>2980</span> </span><span class="COMM">/**
<span class='line'>2981</span>  * @private
<span class='line'>2982</span>  */</span><span class="WHIT">
<span class='line'>2983</span> </span><span class="NAME">BatonProperty.prototype.batonHolderChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2984</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2985</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.baton.amIHolding</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.cachedValueForToggle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2986</span> </span><span class="WHIT">		</span><span class="NAME">this.setValue</span><span class="PUNC">(</span><span class="NAME">this.cachedValueForToggle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2987</span> </span><span class="WHIT">		</span><span class="NAME">this.cachedValueForToggle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2988</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2989</span> </span><span class="WHIT">	</span><span class="NAME">p_evt.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2990</span> </span><span class="WHIT">	</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2991</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2992</span> 
<span class='line'>2993</span> </span><span class="COMM">/**
<span class='line'>2994</span>  * @private
<span class='line'>2995</span>  */</span><span class="WHIT">
<span class='line'>2996</span> </span><span class="NAME">BatonProperty.prototype.synchronizationChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2997</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2998</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.collectionNode.isSynchronized</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2999</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3000</span> </span><span class="WHIT">		</span><span class="COMM">//clear model</span><span class="WHIT">
<span class='line'>3001</span> </span><span class="WHIT">		</span><span class="NAME">this.cachedValueForToggle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3002</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3003</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3004</span> </span><span class="WHIT">	</span><span class="NAME">args.push</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3005</span> </span><span class="WHIT">	</span><span class="NAME">SharedProperty.prototype.synchronizationChange.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3006</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3007</span> 
<span class='line'>3008</span> 
<span class='line'>3009</span> </span><span class="COMM">/**
<span class='line'>3010</span>  * Determines whether the specified user can edit the property.
<span class='line'>3011</span>  * 
<span class='line'>3012</span>  * @param p_userID The user to query regarding whether they can edit.
<span class='line'>3013</span>  * @function
<span class='line'>3014</span>  */</span><span class="WHIT">
<span class='line'>3015</span> </span><span class="NAME">BatonProperty.prototype.canUserEdit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3016</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3017</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SharedProperty.prototype.canUserEdit.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.baton.canUserGrab</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3018</span> </span><span class="WHIT">	
<span class='line'>3019</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3020</span> 
<span class='line'>3021</span> </span><span class="COMM">/**
<span class='line'>3022</span>  * Allows the current user with an owner role to grant the specified user 
<span class='line'>3023</span>  * the ability to edit the property. 
<span class='line'>3024</span>  * 
<span class='line'>3025</span>  * @param p_userID The userID of the user being granted editing privileges.
<span class='line'>3026</span>  * @function
<span class='line'>3027</span>  */</span><span class="WHIT">
<span class='line'>3028</span> </span><span class="NAME">BatonProperty.prototype.allowUserToEdit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3029</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3030</span> </span><span class="WHIT">	</span><span class="COMM">// Let the user grab the baton.</span><span class="WHIT">
<span class='line'>3031</span> </span><span class="WHIT">	</span><span class="NAME">this.baton.setUserRole</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">UserRoles.PUBLISHER</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3032</span> </span><span class="WHIT">	
<span class='line'>3033</span> 	</span><span class="COMM">// Let the user edit the text.</span><span class="WHIT">
<span class='line'>3034</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">superArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3035</span> </span><span class="WHIT">	</span><span class="NAME">superArgs.userID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_userID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3036</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3037</span> </span><span class="WHIT">	</span><span class="NAME">args.push</span><span class="PUNC">(</span><span class="NAME">superArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3038</span> </span><span class="WHIT">	</span><span class="NAME">SharedProperty.prototype.allowUserToEdit.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3039</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3040</span> 
<span class='line'>3041</span> 
<span class='line'>3042</span> </span><span class="COMM">/**
<span class='line'>3043</span>  * Set the role Value required to publish on the property
<span class='line'>3044</span>  * @function
<span class='line'>3045</span>  */</span><span class="WHIT">
<span class='line'>3046</span> </span><span class="NAME">BatonProperty.prototype.setPublishModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_publishModel</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3047</span> </span><span class="PUNC">{</span><span class="WHIT">	
<span class='line'>3048</span> 	</span><span class="NAME">this.baton.publishModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_publishModel</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3049</span> </span><span class="WHIT">	</span><span class="NAME">this.accessModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_publishModel</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3050</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3051</span> 
<span class='line'>3052</span> </span><span class="COMM">/**
<span class='line'>3053</span>  * Role Value required to publish on the property
<span class='line'>3054</span>  * @function
<span class='line'>3055</span>  */</span><span class="WHIT">
<span class='line'>3056</span> </span><span class="NAME">BatonProperty.prototype.getPublishModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3057</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3058</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.baton.publishModel</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3059</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3060</span> 
<span class='line'>3061</span> </span><span class="COMM">/**
<span class='line'>3062</span>  * Set the Role value which is required for accessing the property value
<span class='line'>3063</span>  * @function
<span class='line'>3064</span>  */</span><span class="WHIT">
<span class='line'>3065</span> </span><span class="NAME">BatonProperty.prototype.setAccessModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_accessModel</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3066</span> </span><span class="PUNC">{</span><span class="WHIT">	
<span class='line'>3067</span> 	</span><span class="NAME">this.baton.accessModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_accessModel</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3068</span> </span><span class="WHIT">	</span><span class="NAME">this.accessModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_accessModel</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3069</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3070</span> 
<span class='line'>3071</span> </span><span class="COMM">/**
<span class='line'>3072</span>  * Role value which is required for accessing the property value
<span class='line'>3073</span>  * @function
<span class='line'>3074</span>  */</span><span class="WHIT">
<span class='line'>3075</span> </span><span class="NAME">BatonProperty.prototype.getAccessModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3076</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3077</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.baton.accessModel</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3078</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3079</span> 
<span class='line'>3080</span> </span><span class="COMM">/**
<span class='line'>3081</span>  *  Returns the role of a given user for the property.
<span class='line'>3082</span>  * 
<span class='line'>3083</span>  * @param p_userID UserID of the user in question
<span class='line'>3084</span>  * @function
<span class='line'>3085</span>  */</span><span class="WHIT">
<span class='line'>3086</span> </span><span class="NAME">BatonProperty.prototype.getUserRole</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3087</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3088</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.baton.getUserRole</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3089</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3090</span> 
<span class='line'>3091</span> </span><span class="COMM">/**
<span class='line'>3092</span>  *  Sets the role of a given user for the property.
<span class='line'>3093</span>  * 
<span class='line'>3094</span>  * @param p_userID UserID of the user whose role we are setting
<span class='line'>3095</span>  * @param p_userRole Role value we are setting
<span class='line'>3096</span>  * @function
<span class='line'>3097</span>  */</span><span class="WHIT">
<span class='line'>3098</span> </span><span class="NAME">BatonProperty.prototype.setUserRole</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="WHIT"> </span><span class="PUNC">,</span><span class="NAME">p_userRole</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3099</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3100</span> </span><span class="WHIT">	</span><span class="NAME">this.baton.setUserRole</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="NAME">p_userRole</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3101</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">superArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3102</span> </span><span class="WHIT">	</span><span class="NAME">superArgs.userID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_userID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3103</span> </span><span class="WHIT">	</span><span class="NAME">superArgs.userRole</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_userRole</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3104</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3105</span> </span><span class="WHIT">	</span><span class="NAME">args.push</span><span class="PUNC">(</span><span class="NAME">superArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3106</span> </span><span class="WHIT">	</span><span class="NAME">SharedProperty.prototype.setUserRole.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3107</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3108</span> 
<span class='line'>3109</span> </span><span class="COMM">/**
<span class='line'>3110</span>  *@private
<span class='line'>3111</span>  */</span><span class="WHIT">
<span class='line'>3112</span> </span><span class="NAME">BatonProperty.prototype.onTimerComplete</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3113</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3114</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">argsArray</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3115</span> </span><span class="WHIT">	</span><span class="NAME">argsArray.push</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3116</span> </span><span class="WHIT">	</span><span class="NAME">SharedProperty.prototype.onTimerComplete.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">argsArray</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3117</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3118</span> 
<span class='line'>3119</span> </span><span class="COMM">/**
<span class='line'>3120</span>  * @class BatonObject is a model class which provides a workflow between users for muliple resources. Essentially, it 
<span class='line'>3121</span>  * tracks the "holder" of a given resource and provides APIs for grabbing, putting down, 
<span class='line'>3122</span>  * and giving control to others. Users with an owner role always have the power to 
<span class='line'>3123</span>  * grab the BatonObject, put it down, or give it to others regardless of who has the BatonObject. 
<span class='line'>3124</span>  * Users with a publisher role must wait according to the &lt;code>grabbable&lt;/code> property:
<span class='line'>3125</span>  * &lt;p>
<span class='line'>3126</span>  * &lt;ul>
<span class='line'>3127</span>  * &lt;li>If the BatonObject is set to &lt;code>grabbable&lt;/code>, they may grab the resources in the BatonObject as soon 
<span class='line'>3128</span>  * as it is available (since it will then have no controller).&lt;/li>
<span class='line'>3129</span>  * &lt;li>If the BatonObject is not &lt;code>grabbable&lt;/code>, the owner must explicitly pass the resources in the BatonObject
<span class='line'>3130</span>  * to someone else. 
<span class='line'>3131</span>  * &lt;/ul>
<span class='line'>3132</span>  * By default, a BatonObject will timeout in five seconds and be released. This timeout can be 
<span class='line'>3133</span>  * adjusted in the constructor and extended during use of the resource in question using 
<span class='line'>3134</span>  * &lt;code>extendTimer&lt;/code>.
<span class='line'>3135</span>  * &lt;p>
<span class='line'>3136</span>  * Note that users with an owner role may adjust the roles of other users relative to the 
<span class='line'>3137</span>  * BatonObject using &lt;code>allowUserToGrab&lt;/code> (which makes that user a publisher) and &lt;code>
<span class='line'>3138</span>  * allowUserToAdminister&lt;/code> (which makes that user an owner).
<span class='line'>3139</span>  * &lt;/p>
<span class='line'>3140</span>  * &lt;p>
<span class='line'>3141</span>  * This component also supports "piggybacking" on existing CollectionNodes through its constructor. 
<span class='line'>3142</span>  * Developers can avoid CollectionNode proliferation in their applications by pre-supplying a 
<span class='line'>3143</span>  * CollectionNode and a &lt;code>nodeName&lt;/code> for the BatonObject to use. If none is supplied, the 
<span class='line'>3144</span>  * BatonObject will create its own collection node for sending and receiving messages.
<span class='line'>3145</span> 
<span class='line'>3146</span>  * &lt;table>&lt;tr>&lt;th>&lt;b>Event&lt;/b>&lt;/th>&lt;th>&lt;b>Summary&lt;/b>&lt;/th>&lt;/tr>
<span class='line'>3147</span>  * &lt;tr>&lt;td valign="top">&lt;code>batonHolderChange &lt;/code>&lt;/td> &lt;td> Dispatched when the one of the batonObjects property is assigned,grabbed or when its available.&lt;/td>&lt;/tr>
<span class='line'>3148</span>  * &lt;tr>&lt;td valign="top">&lt;code>synchronizationChange&lt;/code>&lt;/td> &lt;td> Dispatched when the SharedProperty goes in and out of sync.&lt;/td>&lt;/tr>
<span class='line'>3149</span>  * &lt;/table> 
<span class='line'>3150</span>  * @constructor
<span class='line'>3151</span>  */</span><span class="WHIT">
<span class='line'>3152</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">BatonObject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3153</span> </span><span class="WHIT">	</span><span class="NAME">this.holderID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3154</span> </span><span class="WHIT">	</span><span class="NAME">this.cachedBatonHolderID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3155</span> </span><span class="WHIT">	</span><span class="NAME">this.autoReleaseTimers</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3156</span> </span><span class="WHIT">	</span><span class="NAME">this.sharedID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SharedObject.prototype.sharedID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"_BatonObject"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3157</span> </span><span class="WHIT">	</span><span class="NAME">this.cachedValueForSetProp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3158</span> </span><span class="WHIT">	</span><span class="NAME">this.cachedValueForDeleteProp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3159</span> </span><span class="WHIT">	</span><span class="NAME">this.connectSession</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ConnectSession.primarySession</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3160</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3161</span> 
<span class='line'>3162</span> </span><span class="COMM">/**
<span class='line'>3163</span>  * @private
<span class='line'>3164</span>  */</span><span class="WHIT">
<span class='line'>3165</span> </span><span class="NAME">BatonObject.prototype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">SharedObject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3166</span> </span><span class="NAME">BatonObject.prototype.constructor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">BatonObject</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3167</span> 
<span class='line'>3168</span> </span><span class="COMM">/**
<span class='line'>3169</span>  * @field
<span class='line'>3170</span>  */</span><span class="WHIT">
<span class='line'>3171</span> </span><span class="NAME">BatonObject.prototype.batonNodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"holderIDs"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3172</span> </span><span class="COMM">/**
<span class='line'>3173</span>  * @private
<span class='line'>3174</span>  */</span><span class="WHIT">
<span class='line'>3175</span> </span><span class="NAME">BatonObject.prototype.holderID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3176</span> 
<span class='line'>3177</span> </span><span class="COMM">/**
<span class='line'>3178</span>  * @private
<span class='line'>3179</span>  */</span><span class="WHIT">
<span class='line'>3180</span> </span><span class="NAME">BatonObject.prototype.pubModelForControlling</span><span class="PUNC">=</span><span class="NUMB">50</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3181</span> </span><span class="COMM">/**
<span class='line'>3182</span>  * @private
<span class='line'>3183</span>  */</span><span class="WHIT">
<span class='line'>3184</span> </span><span class="NAME">BatonObject.prototype.pubModelForYanking</span><span class="PUNC">=</span><span class="NUMB">100</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3185</span> </span><span class="COMM">/**
<span class='line'>3186</span>  * @private
<span class='line'>3187</span>  */</span><span class="WHIT">
<span class='line'>3188</span> </span><span class="NAME">BatonObject.prototype.autoReleaseTimers</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3189</span> </span><span class="COMM">/**
<span class='line'>3190</span>  * @private
<span class='line'>3191</span>  */</span><span class="WHIT">
<span class='line'>3192</span> </span><span class="NAME">BatonObject.prototype.timeOut</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="COMM">//in seconds</span><span class="WHIT">
<span class='line'>3193</span> </span><span class="COMM">/**
<span class='line'>3194</span>  * @private
<span class='line'>3195</span>  */</span><span class="WHIT">
<span class='line'>3196</span> </span><span class="NAME">BatonObject.prototype.cachedBatonHolderID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3197</span> </span><span class="COMM">/**
<span class='line'>3198</span>  * @private
<span class='line'>3199</span>  */</span><span class="WHIT">
<span class='line'>3200</span> </span><span class="NAME">BatonObject.prototype.userManager</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3201</span> </span><span class="COMM">/**
<span class='line'>3202</span>  * @private
<span class='line'>3203</span>  */</span><span class="WHIT">
<span class='line'>3204</span> </span><span class="NAME">BatonObject.prototype.yankable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3205</span> </span><span class="COMM">/**
<span class='line'>3206</span>  * Whether or not to allow users with a publisher role to grab an available resource in BatonObject.
<span class='line'>3207</span>  * When false, the resources in BatonObject can only be handed off by users with an owner role.
<span class='line'>3208</span>  * @field
<span class='line'>3209</span>  */</span><span class="WHIT">
<span class='line'>3210</span> </span><span class="NAME">BatonObject.prototype.grabbable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3211</span> </span><span class="COMM">/**
<span class='line'>3212</span>  * @private
<span class='line'>3213</span>  */</span><span class="WHIT">
<span class='line'>3214</span> </span><span class="NAME">BatonObject.prototype.accessModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3215</span> </span><span class="COMM">/**
<span class='line'>3216</span>  * @private
<span class='line'>3217</span>  */</span><span class="WHIT">
<span class='line'>3218</span> </span><span class="NAME">BatonObject.prototype.publishModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3219</span> </span><span class="COMM">/**
<span class='line'>3220</span>  * @private
<span class='line'>3221</span>  */</span><span class="WHIT">
<span class='line'>3222</span> </span><span class="NAME">BatonObject.prototype.cachedValueForSetProp</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3223</span> </span><span class="COMM">/**
<span class='line'>3224</span>  * @private
<span class='line'>3225</span>  */</span><span class="WHIT">
<span class='line'>3226</span> </span><span class="NAME">BatonObject.prototype.cachedValueForDeleteProp</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3227</span> 
<span class='line'>3228</span> </span><span class="NAME">EventDispatcher.initialize</span><span class="PUNC">(</span><span class="NAME">BatonObject.prototype</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3229</span> 
<span class='line'>3230</span> </span><span class="COMM">/**
<span class='line'>3231</span>  * Number of seconds after which the BatonObject times out
<span class='line'>3232</span>  * If 0, no timeout is used. 
<span class='line'>3233</span>  * @param p_timeOut Number of seconds until the resources in the BatonObject is released
<span class='line'>3234</span>  * @param p_propertyName The id of the property, If null would set the p_timeOut value to all the properties
<span class='line'>3235</span>  * @function
<span class='line'>3236</span>  */</span><span class="WHIT">
<span class='line'>3237</span> </span><span class="NAME">BatonObject.prototype.setTimeOut</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_timeOut</span><span class="PUNC">,</span><span class="NAME">p_propertyName</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3238</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3239</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_propertyName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3240</span> </span><span class="WHIT">		</span><span class="COMM">//this.createTimer(p_propertyName);</span><span class="WHIT">
<span class='line'>3241</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">p_propertyName</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3242</span> </span><span class="WHIT">			</span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">p_propertyName</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">delay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="NAME">p_timeOut</span><span class="PUNC">*</span><span class="NUMB">1000</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3243</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3244</span> </span><span class="WHIT">			</span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">p_propertyName</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3245</span> </span><span class="WHIT">			</span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">p_propertyName</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">delay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="NAME">p_timeOut</span><span class="PUNC">*</span><span class="NUMB">1000</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3246</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3247</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3248</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3249</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">property</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3250</span> </span><span class="WHIT">				</span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">p_propertyName</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">delay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="NAME">p_timeOut</span><span class="PUNC">*</span><span class="NUMB">1000</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3251</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3252</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3253</span> </span><span class="WHIT">		</span><span class="NAME">this.timeOut</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_timeOut</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3254</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3255</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3256</span> 
<span class='line'>3257</span> </span><span class="COMM">/**
<span class='line'>3258</span>  * Number of seconds after which the BatonObject times out
<span class='line'>3259</span>  * @param p_propertyName The id of the property. If null would return the defualt timeout value
<span class='line'>3260</span>  * @function
<span class='line'>3261</span>  */</span><span class="WHIT">
<span class='line'>3262</span> </span><span class="NAME">BatonObject.prototype.getTimeOut</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_propertyName</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3263</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3264</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_propertyName</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">p_propertyName</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">delay</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3265</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">p_propertyName</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">delay</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3266</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3267</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.timeOut</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3268</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3269</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3270</span> 
<span class='line'>3271</span> </span><span class="COMM">/**
<span class='line'>3272</span>  * Set the role Value required to grab the BatonObject
<span class='line'>3273</span>  * @function
<span class='line'>3274</span>  */</span><span class="WHIT">
<span class='line'>3275</span> </span><span class="NAME">BatonObject.prototype.setPublishModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_publishModel</span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>3276</span> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>3277</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">p_publishModel</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">p_publishModel</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">100</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>3278</span> 		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>3279</span> 	
<span class='line'>3280</span> 	</span><span class="NAME">this.publishModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_publishModel</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3281</span> </span><span class="WHIT">	</span><span class="NAME">commitProperties</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3282</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3283</span> 
<span class='line'>3284</span> </span><span class="COMM">/**
<span class='line'>3285</span>  * Get the role Value required to grab the BatonObject
<span class='line'>3286</span>  * @function
<span class='line'>3287</span>  */</span><span class="WHIT">
<span class='line'>3288</span> </span><span class="NAME">BatonObject.prototype.getPublishModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>3289</span> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>3290</span> 	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.batonNodeName</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">publishModel</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3291</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3292</span> 
<span class='line'>3293</span> </span><span class="COMM">/**
<span class='line'>3294</span>  * Set the role value which is required for seeing the BatonObject
<span class='line'>3295</span>  * @function
<span class='line'>3296</span>  */</span><span class="WHIT">
<span class='line'>3297</span> </span><span class="NAME">BatonObject.prototype.setAccessModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_accessModel</span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>3298</span> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>3299</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">p_accessModel</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">p_accessModel</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">100</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>3300</span> 		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>3301</span> 	
<span class='line'>3302</span> 	</span><span class="NAME">this.accessModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_accessModel</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3303</span> </span><span class="WHIT">	</span><span class="NAME">commitProperties</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3304</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3305</span> 
<span class='line'>3306</span> </span><span class="COMM">/**
<span class='line'>3307</span>  * Get the role value which is required for seeing the BatonObject
<span class='line'>3308</span>  * @function
<span class='line'>3309</span>  */</span><span class="WHIT">
<span class='line'>3310</span> </span><span class="NAME">BatonObject.prototype.getAccessModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>3311</span> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>3312</span> 	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.batonNodeName</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">accessModel</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3313</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3314</span> 
<span class='line'>3315</span> </span><span class="COMM">/**
<span class='line'>3316</span>  * Get the role of a given user for the BatonObject.
<span class='line'>3317</span>  * @function
<span class='line'>3318</span>  */</span><span class="WHIT">
<span class='line'>3319</span> </span><span class="NAME">BatonObject.prototype.getUserRole</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>3320</span> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>3321</span> 	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getUserRole</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="NAME">this.batonNodeName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3322</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3323</span> 
<span class='line'>3324</span> </span><span class="COMM">/**
<span class='line'>3325</span>  * Specifies the &lt;code>userID&lt;/code> of the person controlling the the resource in the BatonObject. Returns null if 
<span class='line'>3326</span>  * no one has the BatonObject. For example, this function might be used to create a "controlled 
<span class='line'>3327</span>  * by XXX" tooltip for your component.
<span class='line'>3328</span>  * @param p_propertyName The id of the property
<span class='line'>3329</span>  * @function
<span class='line'>3330</span>  */</span><span class="WHIT">
<span class='line'>3331</span> </span><span class="NAME">BatonObject.prototype.getHolderID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_propertyName</span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>3332</span> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>3333</span> 	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.holderID</span><span class="PUNC">[</span><span class="NAME">p_propertyName</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3334</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3335</span> 
<span class='line'>3336</span> </span><span class="COMM">/**
<span class='line'>3337</span>  * Determines whether the current user has permission to administer the BatonObject 
<span class='line'>3338</span>  * by taking it from someone or forcing them to put it down.
<span class='line'>3339</span>  * @function
<span class='line'>3340</span>  */</span><span class="WHIT">
<span class='line'>3341</span> </span><span class="NAME">BatonObject.prototype.canIAdminister</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>3342</span> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>3343</span> 	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.canUserAdminister</span><span class="PUNC">(</span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3344</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3345</span> 
<span class='line'>3346</span> </span><span class="COMM">/**
<span class='line'>3347</span>  * Determines whether a specified user can administer the BatonObject from others. 
<span class='line'>3348</span>  * @param p_userID The &lt;code>userID&lt;/code> of the user to check if they have
<span class='line'>3349</span>  * @function
<span class='line'>3350</span>  */</span><span class="WHIT">
<span class='line'>3351</span> </span><span class="NAME">BatonObject.prototype.canUserAdminister</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>3352</span> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>3353</span> 	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.yankable</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getUserRole</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.batonNodeName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">this.pubModelForYanking</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3354</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3355</span> 
<span class='line'>3356</span> </span><span class="COMM">/**
<span class='line'>3357</span>  * Determines whether the current user has permission to grab the BatonObject 
<span class='line'>3358</span>  * when available. It just determines if you are allowed to grab any property inside the BatonObject.
<span class='line'>3359</span>  * @function
<span class='line'>3360</span>  */</span><span class="WHIT">
<span class='line'>3361</span> </span><span class="NAME">BatonObject.prototype.canIGrab</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>3362</span> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>3363</span> 	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.canUserGrab</span><span class="PUNC">(</span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3364</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3365</span> 
<span class='line'>3366</span> </span><span class="COMM">/**
<span class='line'>3367</span>  * Determines whether a specified user can grab the BatonObject if it's available.
<span class='line'>3368</span>  * @param p_userID  The &lt;code>userID&lt;/code> of the user to check if they 
<span class='line'>3369</span>  * can grab the BatonObject. 
<span class='line'>3370</span>  * @function
<span class='line'>3371</span>  */</span><span class="WHIT">
<span class='line'>3372</span> </span><span class="NAME">BatonObject.prototype.canUserGrab</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>3373</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3374</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.grabbable</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getUserRole</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.batonNodeName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">this.pubModelForControlling</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3375</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3376</span> 
<span class='line'>3377</span> </span><span class="COMM">/**
<span class='line'>3378</span>  * When called by an owner, &lt;code>setUserRole()&lt;/code> sets the role of the specified 
<span class='line'>3379</span>  * user with respect to this BatonObject. The following rules apply: 
<span class='line'>3380</span>  * &lt;ul>
<span class='line'>3381</span>  * &lt;li>Setting the role to &lt;code>UserRoles.PUBLISHER&lt;/code> allows the user to grab the resources in the BatonObject. &lt;/li>
<span class='line'>3382</span>  * &lt;li>Setting the role to &lt;code>UserRoles.OWNER&lt;/code> allows the user to administer the resources in the BatonObject.&lt;/li> 
<span class='line'>3383</span>  * &lt;li>Setting to &lt;code>UserRoles.VIEWER&lt;/code> will allow neither.&lt;/li>
<span class='line'>3384</span>  * &lt;/ul>
<span class='line'>3385</span>  * 
<span class='line'>3386</span>  * @param p_userID The &lt;code>userID&lt;/code> of the user to set the role for. 
<span class='line'>3387</span>  * @param p_role The new role for that user.
<span class='line'>3388</span>  * @function
<span class='line'>3389</span>  */</span><span class="WHIT">
<span class='line'>3390</span> </span><span class="NAME">BatonObject.prototype.setUserRole</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="WHIT"> </span><span class="PUNC">,</span><span class="NAME">p_userRole</span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>3391</span> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>3392</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">p_userID</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>3393</span> 		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3394</span> </span><span class="WHIT">	
<span class='line'>3395</span> 	
<span class='line'>3396</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_userRole</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">p_userRole</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">100</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">p_userRole</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">999</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>3397</span> 		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>3398</span> 	
<span class='line'>3399</span> 	</span><span class="NAME">this.collectionNode.setUserRole</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_userRole</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.batonNodeName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3400</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3401</span> </span><span class="WHIT">	</span><span class="NAME">args.push</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3402</span> </span><span class="WHIT">	</span><span class="NAME">args.push</span><span class="PUNC">(</span><span class="NAME">p_userRole</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3403</span> </span><span class="WHIT">	</span><span class="NAME">SharedObject.prototype.setUserRole.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">args</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3404</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3405</span> 
<span class='line'>3406</span> </span><span class="COMM">/**
<span class='line'>3407</span>  * Determines whether the current user is holding a resource in the BatonObject.
<span class='line'>3408</span>  * @param p_propertyName The id of the property
<span class='line'>3409</span>  * @function
<span class='line'>3410</span>  */</span><span class="WHIT">
<span class='line'>3411</span> </span><span class="NAME">BatonObject.prototype.amIHolding</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_propertyName</span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>3412</span> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>3413</span> 	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.holderID</span><span class="PUNC">[</span><span class="NAME">p_propertyName</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3414</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3415</span> 
<span class='line'>3416</span> </span><span class="COMM">/**
<span class='line'>3417</span>  * Determines whether the resource in the BatonObject is up for grabs because it has no current holder.
<span class='line'>3418</span>  * @param p_propertyName The id of the property 
<span class='line'>3419</span>  * @function
<span class='line'>3420</span>  */</span><span class="WHIT">
<span class='line'>3421</span> </span><span class="NAME">BatonObject.prototype.isAvailable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_propertyName</span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>3422</span> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>3423</span> 	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.holderID</span><span class="PUNC">[</span><span class="NAME">p_propertyName</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.grabbable</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3424</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3425</span> 
<span class='line'>3426</span> </span><span class="COMM">/**
<span class='line'>3427</span>  * Cleans up all networking and event handling; recommended for garbage collection.
<span class='line'>3428</span>  * @function
<span class='line'>3429</span>  */</span><span class="WHIT">
<span class='line'>3430</span> </span><span class="NAME">BatonObject.prototype.close</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>3431</span> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>3432</span> 	</span><span class="NAME">this.collectionNode.unsubscribe</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3433</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3434</span> </span><span class="WHIT">	</span><span class="NAME">this.stopAllTimers</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//REVISIT</span><span class="WHIT">
<span class='line'>3435</span> </span><span class="WHIT">	</span><span class="NAME">this.userManager</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3436</span> </span><span class="WHIT">	</span><span class="NAME">SharedObject.prototype.close.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3437</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3438</span> 
<span class='line'>3439</span> </span><span class="COMM">/**
<span class='line'>3440</span>  * If grabbable, users with a publisher role can grab the control if it's available 
<span class='line'>3441</span>  * by using this method. Users with an owner role may grab a resource in the BatonObject at any time.
<span class='line'>3442</span>  * @param p_propertyName The id of the property
<span class='line'>3443</span>  * @function
<span class='line'>3444</span>  */</span><span class="WHIT">
<span class='line'>3445</span> </span><span class="NAME">BatonObject.prototype.grab</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_propertyName</span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>3446</span> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>3447</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.canIAdminister</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3448</span> </span><span class="WHIT">		</span><span class="COMM">// if I can Yank, don't worry about other</span><span class="WHIT">
<span class='line'>3449</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">this.isAvailable</span><span class="PUNC">(</span><span class="NAME">p_propertyName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">this.canIGrab</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3450</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3451</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3452</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3453</span> </span><span class="WHIT">	
<span class='line'>3454</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.amIHolding</span><span class="PUNC">(</span><span class="NAME">p_propertyName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3455</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3456</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3457</span> </span><span class="WHIT">	
<span class='line'>3458</span> 	</span><span class="COMM">//this.createTimer(p_propertyName);</span><span class="WHIT">
<span class='line'>3459</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.isSynchronized</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3460</span> </span><span class="WHIT">		</span><span class="COMM">//grab it</span><span class="WHIT">
<span class='line'>3461</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">msg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">MessageItem</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3462</span> </span><span class="WHIT">		</span><span class="NAME">msg.nodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.batonNodeName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3463</span> </span><span class="WHIT">		</span><span class="NAME">msg.body</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3464</span> </span><span class="WHIT">		</span><span class="NAME">msg.itemID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_propertyName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3465</span> 
<span class='line'>3466</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.publishItem</span><span class="PUNC">(</span><span class="NAME">msg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3467</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3468</span> </span><span class="WHIT">		</span><span class="NAME">this.cachedBatonHolderID</span><span class="PUNC">[</span><span class="NAME">p_propertyName</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3469</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3470</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3471</span> 
<span class='line'>3472</span> </span><span class="COMM">/**
<span class='line'>3473</span>  * Users with an publisher role in control can use this method to 
<span class='line'>3474</span>  * release their control. Users with an owner role  can use this method 
<span class='line'>3475</span>  * to remove the BatonObject resource from a user who has it.
<span class='line'>3476</span>  * @param p_propertyName The id of the property
<span class='line'>3477</span>  * @function
<span class='line'>3478</span>  */</span><span class="WHIT">
<span class='line'>3479</span> </span><span class="NAME">BatonObject.prototype.putDown</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_propertyName</span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>3480</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3481</span> </span><span class="WHIT">	</span><span class="COMM">//REVISIT</span><span class="WHIT">
<span class='line'>3482</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.isAvailable</span><span class="PUNC">(</span><span class="NAME">p_propertyName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3483</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3484</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3485</span> </span><span class="WHIT">	
<span class='line'>3486</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.canIAdminister</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">this.amIHolding</span><span class="PUNC">(</span><span class="NAME">p_propertyName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3487</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3488</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">			
<span class='line'>3489</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.isSynchronized</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">				
<span class='line'>3490</span> 		</span><span class="COMM">//release it</span><span class="WHIT">
<span class='line'>3491</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.retractItem</span><span class="PUNC">(</span><span class="NAME">this.batonNodeName</span><span class="PUNC">,</span><span class="NAME">p_propertyName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3492</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// else not in sync, doing nothing</span><span class="WHIT">
<span class='line'>3493</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3494</span> 
<span class='line'>3495</span> </span><span class="COMM">/**
<span class='line'>3496</span>  * If the BatonObject is grabbable, the holding user can hand the BatonObject's resource to a specified user. 
<span class='line'>3497</span>  * A user with an owner role can give a BatonObject resource to anyone with the required permissions 
<span class='line'>3498</span>  * at any time.
<span class='line'>3499</span>  * 
<span class='line'>3500</span>  * @param p_userID  The &lt;code>userID&lt;/code> of the user to allow to grab the BatonObject.
<span class='line'>3501</span>  * @param p_propertyName The id of the property   
<span class='line'>3502</span>  * @function
<span class='line'>3503</span>  */</span><span class="WHIT">
<span class='line'>3504</span> </span><span class="NAME">BatonObject.prototype.giveTo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="NAME">p_propertyName</span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>3505</span> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>3506</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.canIAdminister</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.grabbable</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">this.amIHolding</span><span class="PUNC">(</span><span class="NAME">p_propertyName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3507</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3508</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3509</span> </span><span class="WHIT">	
<span class='line'>3510</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.isSynchronized</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3511</span> </span><span class="WHIT">		</span><span class="COMM">//give it to someone</span><span class="WHIT">
<span class='line'>3512</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">msg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">MessageItem</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3513</span> </span><span class="WHIT">		</span><span class="NAME">msg.nodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.batonNodeName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3514</span> </span><span class="WHIT">		</span><span class="NAME">msg.body</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_userID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3515</span> </span><span class="WHIT">		</span><span class="NAME">msg.itemID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_propertyName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3516</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.publishItem</span><span class="PUNC">(</span><span class="NAME">msg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3517</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3518</span> </span><span class="WHIT">		</span><span class="NAME">this.cachedBatonHolderID</span><span class="PUNC">[</span><span class="NAME">p_propertyName</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_userID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3519</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3520</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3521</span> 
<span class='line'>3522</span> </span><span class="COMM">/**
<span class='line'>3523</span>  * Extends the timeout if the BatonObject has one.
<span class='line'>3524</span>  * @param p_propertyName The id of the property  
<span class='line'>3525</span>  * @function
<span class='line'>3526</span>  */</span><span class="WHIT">
<span class='line'>3527</span> </span><span class="NAME">BatonObject.prototype.extendTimer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_propertyName</span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>3528</span> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>3529</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">p_propertyName</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3530</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">p_propertyName</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3531</span> </span><span class="WHIT">			</span><span class="NAME">clearTimeout</span><span class="PUNC">(</span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">p_propertyName</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3532</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3533</span> </span><span class="WHIT">		</span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">p_propertyName</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3534</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">p_propertyName</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">delay</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3535</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">delay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">p_propertyName</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">delay</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3536</span> </span><span class="WHIT">			</span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">p_propertyName</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">bindUsingClosure</span><span class="PUNC">(</span><span class="NAME">this.onTimerComplete</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">delay</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_propertyName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3537</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3538</span> </span><span class="WHIT">			</span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">p_propertyName</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">bindUsingClosure</span><span class="PUNC">(</span><span class="NAME">this.onTimerComplete</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.timeOut</span><span class="PUNC">*</span><span class="NUMB">1000</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_propertyName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3539</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3540</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3541</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3542</span> 
<span class='line'>3543</span> </span><span class="COMM">/**
<span class='line'>3544</span>  * The value of the BatonObjects property which a user can only set it if the user is in 
<span class='line'>3545</span>  * control of it.
<span class='line'>3546</span>  * &lt;p>
<span class='line'>3547</span>  * If the BatonObject is not yet synchrnonized, the value will be cached and 
<span class='line'>3548</span>  * sent when the BatonProperty is back in sync.
<span class='line'>3549</span>  * &lt;p>
<span class='line'>3550</span>  * If the BatonObjects property is available, setting the value will also try to grab 
<span class='line'>3551</span>  * control of the property before setting the value.
<span class='line'>3552</span>  * @param p_propertyName The key of the Property being added
<span class='line'>3553</span>  * @param p_value The value of the property, defaults to null
<span class='line'>3554</span>  * @function
<span class='line'>3555</span>  */</span><span class="WHIT">
<span class='line'>3556</span> </span><span class="NAME">BatonObject.prototype.setProperty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_propertyName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_value</span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>3557</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3558</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.isSynchronized</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3559</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.isAvailable</span><span class="PUNC">(</span><span class="NAME">p_propertyName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3560</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.cachedValueForSetProp</span><span class="PUNC">[</span><span class="NAME">p_propertyName</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">	</span><span class="COMM">//only toggle the first time</span><span class="WHIT">
<span class='line'>3561</span> </span><span class="WHIT">				</span><span class="NAME">this.grab</span><span class="PUNC">(</span><span class="NAME">p_propertyName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3562</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3563</span> </span><span class="WHIT">			</span><span class="NAME">this.cachedValueForSetProp</span><span class="PUNC">[</span><span class="NAME">p_propertyName</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_value</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//overwrite the value that will eventually be published</span><span class="WHIT">
<span class='line'>3564</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.amIHolding</span><span class="PUNC">(</span><span class="NAME">p_propertyName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3565</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3566</span> </span><span class="WHIT">			</span><span class="NAME">args.push</span><span class="PUNC">(</span><span class="NAME">p_propertyName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3567</span> </span><span class="WHIT">			</span><span class="NAME">args.push</span><span class="PUNC">(</span><span class="NAME">p_value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3568</span> </span><span class="WHIT">			</span><span class="NAME">SharedObject.prototype.setProperty.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">args</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3569</span> </span><span class="WHIT">			</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.cachedValueForSetProp</span><span class="PUNC">[</span><span class="NAME">p_propertyName</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3570</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3571</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3572</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3573</span> 
<span class='line'>3574</span> </span><span class="COMM">/**
<span class='line'>3575</span>  * The value of the BatonObjects property which a user can only delete it if the user is in 
<span class='line'>3576</span>  * control of it.
<span class='line'>3577</span>  * &lt;p>
<span class='line'>3578</span>  * If the BatonObject is not yet synchrnonized, the value will be cached and 
<span class='line'>3579</span>  * deleted when the BatonProperty is back in sync.
<span class='line'>3580</span>  * &lt;p>
<span class='line'>3581</span>  * If the BatonObjects property is available, deleting the value will also try to grab 
<span class='line'>3582</span>  * control of the property before deleting the value and then release the control as well.
<span class='line'>3583</span>  * @param p_propertyName The key of the Property that needs to be retracted from the BatonObject.
<span class='line'>3584</span>  * @function
<span class='line'>3585</span>  */</span><span class="WHIT">
<span class='line'>3586</span> </span><span class="NAME">BatonObject.prototype.removeProperty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_propertyName</span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>3587</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3588</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.isAvailable</span><span class="PUNC">(</span><span class="NAME">p_propertyName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3589</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.cachedValueForDeleteProp</span><span class="PUNC">[</span><span class="NAME">p_propertyName</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">	</span><span class="COMM">//only toggle the first time</span><span class="WHIT">
<span class='line'>3590</span> </span><span class="WHIT">			</span><span class="NAME">this.grab</span><span class="PUNC">(</span><span class="NAME">p_propertyName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3591</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3592</span> </span><span class="WHIT">		</span><span class="NAME">this.cachedValueForDeleteProp</span><span class="PUNC">[</span><span class="NAME">p_propertyName</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"someRandomValue"</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//overwrite the value that will eventually be published</span><span class="WHIT">
<span class='line'>3593</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.amIHolding</span><span class="PUNC">(</span><span class="NAME">p_propertyName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3594</span> </span><span class="WHIT">		</span><span class="COMM">//putDown(p_propertyName);</span><span class="WHIT">
<span class='line'>3595</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3596</span> </span><span class="WHIT">		</span><span class="NAME">args.push</span><span class="PUNC">(</span><span class="NAME">p_propertyName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3597</span> </span><span class="WHIT">		</span><span class="NAME">SharedObject.prototype.removeProperty.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">args</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3598</span> </span><span class="WHIT">		</span><span class="COMM">//delete _cachedValueForDeleteProp [p_propertyName];</span><span class="WHIT">
<span class='line'>3599</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3600</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3601</span> 
<span class='line'>3602</span> </span><span class="COMM">/**
<span class='line'>3603</span>  * Calls the &lt;code>removeProperty&lt;/code> for all the properties in the BatonObject. It would delete all the properties that are
<span class='line'>3604</span>  * avialable or properties that you are holding.
<span class='line'>3605</span>  * @function
<span class='line'>3606</span>  */</span><span class="WHIT">
<span class='line'>3607</span> </span><span class="NAME">BatonObject.prototype.removeAll</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>3608</span> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>3609</span> 	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">propertyName</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.sharedObject</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3610</span> </span><span class="WHIT">		</span><span class="NAME">this.removeProperty</span><span class="PUNC">(</span><span class="NAME">propertyName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3611</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3612</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3613</span> 
<span class='line'>3614</span> </span><span class="COMM">/**
<span class='line'>3615</span>  * @private
<span class='line'>3616</span>  */</span><span class="WHIT">
<span class='line'>3617</span> </span><span class="NAME">BatonObject.prototype.onTimerComplete</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>3618</span> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>3619</span> 	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3620</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timer</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">  </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3621</span> </span><span class="WHIT">			</span><span class="NAME">this.collectionNode.retractItem</span><span class="PUNC">(</span><span class="NAME">this.batonNodeName</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3622</span> </span><span class="WHIT">			</span><span class="NAME">clearTimeout</span><span class="PUNC">(</span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3623</span> </span><span class="WHIT">			</span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3624</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3625</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3626</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3627</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3628</span> 
<span class='line'>3629</span> </span><span class="COMM">/**
<span class='line'>3630</span>  * @private
<span class='line'>3631</span>  */</span><span class="WHIT">
<span class='line'>3632</span> </span><span class="NAME">BatonObject.prototype.synchronizationChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>3633</span> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>3634</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.userManager</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.connectSession</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3635</span> </span><span class="WHIT">		</span><span class="NAME">this.userManager</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.connectSession.userManager</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3636</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3637</span> 
<span class='line'>3638</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3639</span> </span><span class="WHIT">	</span><span class="NAME">args.push</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3640</span> </span><span class="WHIT">	</span><span class="NAME">SharedObject.prototype.synchronizationChange.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">args</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3641</span> 
<span class='line'>3642</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.isSynchronized</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3643</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.collectionNode.isNodeDefined</span><span class="PUNC">(</span><span class="NAME">this.batonNodeName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">	</span><span class="COMM">//we're the first ones here</span><span class="WHIT">
<span class='line'>3644</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodeConf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3645</span> </span><span class="WHIT">			</span><span class="NAME">nodeConf.accessModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3646</span> </span><span class="WHIT">			</span><span class="NAME">nodeConf.publishModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.pubModelForControlling</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3647</span> </span><span class="WHIT">			</span><span class="NAME">nodeConf.modifyAnyItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3648</span> </span><span class="WHIT">			</span><span class="NAME">nodeConf.userDependentItems</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3649</span> </span><span class="WHIT">			</span><span class="NAME">this.collectionNode.createNode</span><span class="PUNC">(</span><span class="NAME">this.batonNodeName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nodeConf</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3650</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3651</span> </span><span class="WHIT">		
<span class='line'>3652</span> 		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.holderID</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.cachedBatonHolderID</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">	</span><span class="COMM">//this will work but I don't like it...we might want to use _holderIDSetFromNetwork:Boolean</span><span class="WHIT">
<span class='line'>3653</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.cachedBatonHolderID</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3654</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.getUserRole</span><span class="PUNC">(</span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">this.pubModelForYanking</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3655</span> </span><span class="WHIT">					</span><span class="COMM">//giveTo(_cachedBatonHolderID);</span><span class="WHIT">
<span class='line'>3656</span> </span><span class="WHIT">					</span><span class="NAME">this.giveTo</span><span class="PUNC">(</span><span class="NAME">this.cachedBatonHolderID</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3657</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.canIGrab</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.cachedBatonHolderID</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">this.userManager.myUserID</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3658</span> </span><span class="WHIT">					</span><span class="NAME">this.grab</span><span class="PUNC">(</span><span class="NAME">this.cachedBatonHolderID</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3659</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3660</span> </span><span class="WHIT">				</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.cachedBatonHolderID</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3661</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3662</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3663</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3664</span> </span><span class="WHIT">		</span><span class="COMM">//clean up model!</span><span class="WHIT">
<span class='line'>3665</span> </span><span class="WHIT">		</span><span class="NAME">this.stopAllTimers</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3666</span> </span><span class="WHIT">		</span><span class="NAME">this.cachedBatonHolderID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3667</span> </span><span class="WHIT">		</span><span class="NAME">this.holderID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3668</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3669</span> </span><span class="WHIT">	
<span class='line'>3670</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3671</span> 
<span class='line'>3672</span> </span><span class="COMM">/**
<span class='line'>3673</span>  * @private
<span class='line'>3674</span>  */</span><span class="WHIT">
<span class='line'>3675</span> </span><span class="NAME">BatonObject.prototype.itemReceive</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>3676</span> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>3677</span> 	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">theItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.item</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3678</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.userManager</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.connectSession</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3679</span> </span><span class="WHIT">		</span><span class="NAME">this.userManager</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.connectSession.userManager</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3680</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3681</span> </span><span class="WHIT">	
<span class='line'>3682</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">theItem.nodeName</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">this.batonNodeName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3683</span> </span><span class="WHIT">		</span><span class="NAME">this.holderID</span><span class="PUNC">[</span><span class="NAME">theItem.itemID</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">theItem.body</span><span class="PUNC">;</span><span class="WHIT">	
<span class='line'>3684</span> 		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.cachedBatonHolderID</span><span class="PUNC">[</span><span class="NAME">theItem.itemID</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3685</span> </span><span class="WHIT">			</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.cachedBatonHolderID</span><span class="PUNC">[</span><span class="NAME">theItem.itemID</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3686</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3687</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.amIHolding</span><span class="PUNC">(</span><span class="NAME">theItem.itemID</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3688</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">theItem.itemID</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">theItem.itemID</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">delay</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.timeOut</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3689</span> </span><span class="WHIT">				</span><span class="NAME">this.createTimer</span><span class="PUNC">(</span><span class="NAME">theItem.itemID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3690</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3691</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3692</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3693</span> </span><span class="WHIT">		</span><span class="NAME">evt.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"batonHolderChange"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3694</span> </span><span class="WHIT">		</span><span class="NAME">evt.PROPERTY_ID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">theItem.itemID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3695</span> </span><span class="WHIT">		</span><span class="NAME">evt.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">evt.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3696</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.cachedValueForSetProp</span><span class="PUNC">[</span><span class="NAME">theItem.itemID</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3697</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.isSynchronized</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.amIHolding</span><span class="PUNC">(</span><span class="NAME">theItem.itemID</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3698</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3699</span> </span><span class="WHIT">				</span><span class="NAME">args.push</span><span class="PUNC">(</span><span class="NAME">theItem.itemID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3700</span> </span><span class="WHIT">				</span><span class="NAME">args.push</span><span class="PUNC">(</span><span class="NAME">this.cachedValueForSetProp</span><span class="PUNC">[</span><span class="NAME">theItem.itemID</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3701</span> </span><span class="WHIT">				</span><span class="NAME">SharedObject.prototype.setProperty.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3702</span> </span><span class="WHIT">				</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.cachedValueForSetProp</span><span class="PUNC">[</span><span class="NAME">theItem.itemID</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3703</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3704</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.cachedValueForDeleteProp</span><span class="PUNC">[</span><span class="NAME">theItem.itemID</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3705</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.isSynchronized</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.amIHolding</span><span class="PUNC">(</span><span class="NAME">theItem.itemID</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3706</span> </span><span class="WHIT">				</span><span class="NAME">this.removeProperty</span><span class="PUNC">(</span><span class="NAME">theItem.itemID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3707</span> </span><span class="WHIT">				</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.cachedValueForDeleteProp</span><span class="PUNC">[</span><span class="NAME">theItem.itemID</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3708</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3709</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3710</span> </span><span class="WHIT">		</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3711</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3712</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3713</span> </span><span class="WHIT">		</span><span class="NAME">args.push</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3714</span> </span><span class="WHIT">		</span><span class="NAME">SharedObject.prototype.itemReceive.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">args</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3715</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3716</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3717</span> 
<span class='line'>3718</span> </span><span class="COMM">/**
<span class='line'>3719</span>  * @private
<span class='line'>3720</span>  */</span><span class="WHIT">
<span class='line'>3721</span> </span><span class="NAME">BatonObject.prototype.itemRetract</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>3722</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3723</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">theItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.item</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3724</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_evt.nodeName</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">this.batonNodeName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">			</span><span class="COMM">//no need to check the itemID, I only have one</span><span class="WHIT">
<span class='line'>3725</span> </span><span class="WHIT">		</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.holderID</span><span class="PUNC">[</span><span class="NAME">theItem.itemID</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3726</span> </span><span class="WHIT">		</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.cachedBatonHolderID</span><span class="PUNC">[</span><span class="NAME">theItem.itemID</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3727</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">theItem.itemID</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">theItem.itemID</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3728</span> </span><span class="WHIT">			</span><span class="NAME">clearTimeout</span><span class="PUNC">(</span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">theItem.itemID</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3729</span> </span><span class="WHIT">			</span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">theItem.itemID</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3730</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3731</span> </span><span class="WHIT">		</span><span class="COMM">//super.removeProperty(theItem.itemID);</span><span class="WHIT">
<span class='line'>3732</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3733</span> </span><span class="WHIT">		</span><span class="NAME">evt.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"batonHolderChange"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3734</span> </span><span class="WHIT">		</span><span class="NAME">evt.PROPERTY_ID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">theItem.itemID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3735</span> </span><span class="WHIT">		</span><span class="NAME">evt.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">evt.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3736</span> </span><span class="WHIT">		</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3737</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3738</span> </span><span class="WHIT">		</span><span class="COMM">//super.onItemRetract(p_evt);</span><span class="WHIT">
<span class='line'>3739</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3740</span> </span><span class="WHIT">		</span><span class="NAME">args.push</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3741</span> </span><span class="WHIT">		</span><span class="NAME">SharedObject.prototype.itemRetract.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3742</span> </span><span class="WHIT">		</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.cachedValueForDeleteProp</span><span class="PUNC">[</span><span class="NAME">theItem.itemID</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3743</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.amIHolding</span><span class="PUNC">(</span><span class="NAME">theItem.itemID</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3744</span> </span><span class="WHIT">			</span><span class="NAME">this.putDown</span><span class="PUNC">(</span><span class="NAME">theItem.itemID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3745</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3746</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3747</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3748</span> 
<span class='line'>3749</span> </span><span class="COMM">/**
<span class='line'>3750</span>  * @private
<span class='line'>3751</span>  */</span><span class="WHIT">
<span class='line'>3752</span> </span><span class="NAME">BatonObject.prototype.commitProperties</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>3753</span> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>3754</span> 	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodeConf</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3755</span> 
<span class='line'>3756</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.publishModel</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.batonNodeName</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">publishModel</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">this.publishModel</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3757</span> </span><span class="WHIT">		</span><span class="NAME">nodeConf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.batonNodeName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3758</span> </span><span class="WHIT">		</span><span class="NAME">nodeConf.publishModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.publishModel</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3759</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.setNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.batonNodeName</span><span class="PUNC">,</span><span class="NAME">nodeConf</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3760</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3761</span> </span><span class="WHIT">	
<span class='line'>3762</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.accessModel</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.batonNodeName</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">accessModel</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">this.accessModel</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3763</span> </span><span class="WHIT">		</span><span class="NAME">nodeConf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.batonNodeName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3764</span> </span><span class="WHIT">		</span><span class="NAME">nodeConf.accessModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.accessModel</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3765</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.setNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.batonNodeName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nodeConf</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3766</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3767</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3768</span> 
<span class='line'>3769</span> </span><span class="COMM">/**
<span class='line'>3770</span>  * @private
<span class='line'>3771</span>  */</span><span class="WHIT">
<span class='line'>3772</span> </span><span class="NAME">BatonObject.prototype.createTimer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_timerID</span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>3773</span> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>3774</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">p_timerID</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">p_timerID</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">p_timerID</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timer</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3775</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">p_timerID</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">p_timerID</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">delay</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3776</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">delay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">p_timerID</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">delay</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3777</span> </span><span class="WHIT">			</span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">p_timerID</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">bindUsingClosure</span><span class="PUNC">(</span><span class="NAME">this.onTimerComplete</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">delay</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_timerID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3778</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3779</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">p_timerID</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3780</span> </span><span class="WHIT">				</span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">p_timerID</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3781</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3782</span> </span><span class="WHIT">			</span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">p_timerID</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">bindUsingClosure</span><span class="PUNC">(</span><span class="NAME">this.onTimerComplete</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.timeOut</span><span class="PUNC">*</span><span class="NUMB">1000</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_timerID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3783</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3784</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3785</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3786</span> 
<span class='line'>3787</span> </span><span class="COMM">/**
<span class='line'>3788</span>  * @private
<span class='line'>3789</span>  */</span><span class="WHIT">
<span class='line'>3790</span> </span><span class="NAME">BatonObject.prototype.stopAllTimers</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>3791</span> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>3792</span> 	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3793</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i.timer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3794</span> </span><span class="WHIT">			</span><span class="NAME">clearTimeOut</span><span class="PUNC">(</span><span class="NAME">i.timer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3795</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3796</span> </span><span class="WHIT">		</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.autoReleaseTimers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3797</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3798</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3799</span> 
<span class='line'>3800</span> </span><span class="COMM">/**
<span class='line'>3801</span>  * @class SharedCollection is a simple ArrayCollection which is shared across the LCCS services. Useful for sharing the contents
<span class='line'>3802</span>  * of a List or Datagrid (or any other component with a dataProvider), it supports the general addItem, setItemAt, removeItemAt,
<span class='line'>3803</span>  * and removeAll methods for updating the collection. Any changes through these APIs are shared with other users subscribed to 
<span class='line'>3804</span>  * the collection. Note, however, that changing a collection's object properties without calling setItemAt to update them results
<span class='line'>3805</span>  * in those properties not being shared.
<span class='line'>3806</span>  * &lt;p>
<span class='line'>3807</span>  * The collection does not share sort order: Any sorting desired should be performed on each respective client. As such,
<span class='line'>3808</span>  * addItemAt isn't supported, although addItem is. The collection makes update decisions on items based on a unique ID.
<span class='line'>3809</span>  * Items added to the collection should either implement the IUID interface or provide a field which is guaranteed to be unique 
<span class='line'>3810</span>  * for this collection. The SharedCollection exposes an &lt;code>idField&lt;/code> property to specify which 
<span class='line'>3811</span>  * field to use as unique ID; in the case the items do not implement IUID.
<span class='line'>3812</span>  * &lt;p>
<span class='line'>3813</span>  * The SharedCollection exposes the ability to set NodeConfiguration options for the node upon which the items are sent. In this way
<span class='line'>3814</span>  * the collection can have its access and publish rights assigned as well as the other settings allowed by NodeConfiguration.
<span class='line'>3815</span>  * Note that this component supports "piggybacking" on existing CollectionNodes through its &lt;code>collectionNode&lt;/code> property
<span class='line'>3816</span>  * and its subscribe method. Developers can avoid CollectionNode proliferation in their applications by pre-supplying a CollectionNode 
<span class='line'>3817</span>  * to the &lt;code>collectionNode&lt;/code> property and a &lt;code>nodeName&lt;/code> (in the subscribe method) 
<span class='line'>3818</span>  * for the SharedCollection to use. If none is supplied, the SharedCollection will create its own collectionNode named for the 
<span class='line'>3819</span>  * &lt;code>uniqueID&lt;/code> supplied in subscribe()for sending and receiving messages.
<span class='line'>3820</span>  * &lt;table>&lt;tr>&lt;th>&lt;b>Event&lt;/b>&lt;/th>&lt;th>&lt;b>Summary&lt;/b>&lt;/th>&lt;/tr>
<span class='line'>3821</span>  * &lt;tr>&lt;td valign="top">&lt;code>collectionChange &lt;/code>&lt;/td> &lt;td> Dispatched when the Collection has been updated in some way.&lt;/td>&lt;/tr>
<span class='line'>3822</span>  * &lt;tr>&lt;td valign="top">&lt;code>reconnect&lt;/code>&lt;/td> &lt;td> The type of event emitted when the CollectionNode is about to reconnect to the server.&lt;/td>&lt;/tr>
<span class='line'>3823</span>  * &lt;tr>&lt;td valign="top">&lt;code>synchronizationChange&lt;/code>&lt;/td> &lt;td> Dispatched when the SharedCollection goes in and out of sync with the service.&lt;/td>&lt;/tr>
<span class='line'>3824</span>  * &lt;/table>
<span class='line'>3825</span>  * 
<span class='line'>3826</span>  */</span><span class="WHIT">
<span class='line'>3827</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">SharedCollection</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3828</span> </span><span class="WHIT">	</span><span class="NAME">this.connectSession</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ConnectSession.primarySession</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3829</span> </span><span class="WHIT">	</span><span class="NAME">this.sharedArray</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3830</span> </span><span class="WHIT">	</span><span class="NAME">this.source</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.sharedArray</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3831</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3832</span> </span><span class="NAME">EventDispatcher.initialize</span><span class="PUNC">(</span><span class="NAME">SharedCollection.prototype</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3833</span> 
<span class='line'>3834</span> </span><span class="COMM">/**
<span class='line'>3835</span>  * Defines the logical location of the component on the service. Typically this assigns the &lt;code>sharedID&lt;/code> of the collectionNode
<span class='line'>3836</span>  * used by the component. &lt;code>sharedIDs&lt;/code> should be unique within a room if they're expressing 2 unique locations. Note that
<span class='line'>3837</span>  * this can only be assigned once before &lt;code>subscribe()&lt;/code> is called. For components with an &lt;code>id&lt;/code> property, 
<span class='line'>3838</span>  * &lt;code>sharedID&lt;/code> defaults to that value.
<span class='line'>3839</span>  */</span><span class="WHIT">
<span class='line'>3840</span> </span><span class="NAME">SharedCollection.prototype.sharedID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3841</span> </span><span class="COMM">/**
<span class='line'>3842</span>  * The ConnectSession with which this component is associated. Note that this may only be set once before &lt;code>subscribe&lt;/code>
<span class='line'>3843</span>  * is called; re-sessioning of components is not supported.
<span class='line'>3844</span>  */</span><span class="WHIT">
<span class='line'>3845</span> </span><span class="NAME">SharedCollection.prototype.connectSession</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3846</span> </span><span class="COMM">/**
<span class='line'>3847</span>  * Specifies an existing collectionNode to use in case a developer wishes to supply their own, and avoid having the 
<span class='line'>3848</span>  * sharedCollection create a new one.
<span class='line'>3849</span>  */</span><span class="WHIT">
<span class='line'>3850</span> </span><span class="NAME">SharedCollection.prototype.collectionNode</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3851</span> 
<span class='line'>3852</span> </span><span class="COMM">/**
<span class='line'>3853</span>  * @private
<span class='line'>3854</span>  */</span><span class="WHIT">
<span class='line'>3855</span> </span><span class="NAME">SharedCollection.prototype.ITEM_NODE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"itemNode"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3856</span> </span><span class="COMM">/**
<span class='line'>3857</span>  * @private
<span class='line'>3858</span>  */</span><span class="WHIT">
<span class='line'>3859</span> </span><span class="NAME">SharedCollection.prototype.nodeConfig</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3860</span> </span><span class="COMM">/**
<span class='line'>3861</span>  * @private
<span class='line'>3862</span>  */</span><span class="WHIT">
<span class='line'>3863</span> </span><span class="NAME">SharedCollection.prototype.nodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"itemNode"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3864</span> </span><span class="COMM">/**
<span class='line'>3865</span>  * @private
<span class='line'>3866</span>  */</span><span class="WHIT">
<span class='line'>3867</span> </span><span class="NAME">SharedCollection.prototype.myUserID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3868</span> 
<span class='line'>3869</span> </span><span class="COMM">/**
<span class='line'>3870</span>  * If each item doesn't implement IUID, specifies a field within the item to use as a unique ID.
<span class='line'>3871</span>  */</span><span class="WHIT">
<span class='line'>3872</span> </span><span class="NAME">SharedCollection.prototype.idField</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3873</span> </span><span class="COMM">/**
<span class='line'>3874</span>  * If each item doesn't implement IUID, specifies a field within the item to use as a unique ID.
<span class='line'>3875</span>  */</span><span class="WHIT">
<span class='line'>3876</span> </span><span class="NAME">SharedCollection.prototype.sharedArray</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3877</span> 
<span class='line'>3878</span> </span><span class="NAME">SharedCollection.prototype.source</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3879</span> 
<span class='line'>3880</span> 
<span class='line'>3881</span> </span><span class="COMM">/**
<span class='line'>3882</span>  * Returns whether or not the sharedCollection has retrieved any information previously stored on the service, and 
<span class='line'>3883</span>  * is currently connected to the service. 
<span class='line'>3884</span>  */</span><span class="WHIT">
<span class='line'>3885</span> </span><span class="NAME">SharedCollection.prototype.isSynchronized</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3886</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3887</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.collectionNode</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3888</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.isSynchronized</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3889</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3890</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3891</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3892</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3893</span> </span><span class="COMM">/**
<span class='line'>3894</span>  * Sets the node configuration.
<span class='line'>3895</span>  * @param p_nodeConfig The node configuration..
<span class='line'>3896</span>  */</span><span class="WHIT">
<span class='line'>3897</span> </span><span class="NAME">SharedCollection.prototype.setNodeConfiguration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_nodeConfig</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3898</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3899</span> </span><span class="WHIT">	</span><span class="NAME">this.nodeConfig</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_nodeConfig</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3900</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">isSynchronized</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3901</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.setNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">,</span><span class="NAME">this.nodeConfig</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3902</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3903</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3904</span> 
<span class='line'>3905</span> </span><span class="COMM">/**
<span class='line'>3906</span>  * Disposes all listeners to the network and framework classes. 
<span class='line'>3907</span>  * Recommended for proper garbage collection of the component.
<span class='line'>3908</span>  */</span><span class="WHIT">
<span class='line'>3909</span> </span><span class="NAME">SharedCollection.prototype.close</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3910</span> </span><span class="PUNC">{</span><span class="WHIT">	
<span class='line'>3911</span> 	</span><span class="NAME">this.collectionNode.removeEventListener</span><span class="PUNC">(</span><span class="STRN">"synchronizationChange"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3912</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.removeEventListener</span><span class="PUNC">(</span><span class="STRN">"itemReceive"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3913</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.removeEventListener</span><span class="PUNC">(</span><span class="STRN">"itemRetract"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3914</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.removeEventListener</span><span class="PUNC">(</span><span class="STRN">"reconnect"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3915</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.unsubscribe</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3916</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3917</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3918</span> 
<span class='line'>3919</span> </span><span class="COMM">/**
<span class='line'>3920</span>  * Tells the component to begin synchronizing with the service.  
<span class='line'>3921</span>  * For "headless" components such as this one, this method must be called explicitly.
<span class='line'>3922</span>  */</span><span class="WHIT">
<span class='line'>3923</span> </span><span class="NAME">SharedCollection.prototype.subscribe</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3924</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3925</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.nodeConfig</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3926</span> </span><span class="WHIT">		</span><span class="NAME">this.nodeConfig</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">NodeConfiguration</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3927</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3928</span> </span><span class="WHIT">	
<span class='line'>3929</span> 	</span><span class="NAME">this.nodeConfig.itemStorageScheme</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3930</span> </span><span class="WHIT">	
<span class='line'>3931</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.collectionNode</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3932</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">CollectionNode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3933</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.sharedID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.sharedID</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3934</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.connectSession</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.connectSession</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3935</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.subscribe</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3936</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3937</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.addEventListener</span><span class="PUNC">(</span><span class="STRN">"synchronizationChange"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3938</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.addEventListener</span><span class="PUNC">(</span><span class="STRN">"itemReceive"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3939</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.addEventListener</span><span class="PUNC">(</span><span class="STRN">"itemRetract"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3940</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.addEventListener</span><span class="PUNC">(</span><span class="STRN">"reconnect"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3941</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3942</span> 
<span class='line'>3943</span> </span><span class="COMM">/**
<span class='line'>3944</span>  * Replaces the item at the specified index.
<span class='line'>3945</span>  * @param The new item to set.
<span class='line'>3946</span>  * @param The index of the item to replace. Note that this index is local-only; on remote collections, it's the unique ID
<span class='line'>3947</span>  * of the item which is used to locate and replace the item. 
<span class='line'>3948</span>  * @return The item previously at this location.
<span class='line'>3949</span>  */</span><span class="WHIT">
<span class='line'>3950</span> </span><span class="NAME">SharedCollection.prototype.setItemAt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_item</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_index</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3951</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3952</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oldItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getItemAt</span><span class="PUNC">(</span><span class="NAME">p_index</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3953</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">msg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">MessageItem</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3954</span> </span><span class="WHIT">	</span><span class="NAME">msg.nodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.nodeName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3955</span> </span><span class="WHIT">	</span><span class="NAME">msg.body</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_item</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3956</span> </span><span class="WHIT">	</span><span class="NAME">msg.itemID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getItemID</span><span class="PUNC">(</span><span class="NAME">oldItem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3957</span> </span><span class="WHIT">	
<span class='line'>3958</span> 	</span><span class="NAME">this.collectionNode.publishItem</span><span class="PUNC">(</span><span class="NAME">msg</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3959</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">oldItem</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3960</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3961</span> 
<span class='line'>3962</span> </span><span class="COMM">/**
<span class='line'>3963</span>  * Adds the specified item to the end of the list. 
<span class='line'>3964</span>  * @param p_item The item to add.
<span class='line'>3965</span>  */</span><span class="WHIT">
<span class='line'>3966</span> </span><span class="NAME">SharedCollection.prototype.addItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_item</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3967</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3968</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">msg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">MessageItem</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3969</span> </span><span class="WHIT">	</span><span class="NAME">msg.nodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.nodeName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3970</span> </span><span class="WHIT">	</span><span class="NAME">msg.body</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_item</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3971</span> </span><span class="WHIT">	</span><span class="NAME">msg.itemID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getItemID</span><span class="PUNC">(</span><span class="NAME">p_item</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3972</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.publishItem</span><span class="PUNC">(</span><span class="NAME">msg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3973</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3974</span> 
<span class='line'>3975</span> </span><span class="COMM">/**
<span class='line'>3976</span>  * Removes the item at the specified index.
<span class='line'>3977</span>  * @param p_index The index of the item to remove. Note that this index is local-only; on remote collections, it's the 
<span class='line'>3978</span>  * unique ID of the item which is used to locate and remove the item.
<span class='line'>3979</span>  * @return The item preivously at this location.
<span class='line'>3980</span>  * 
<span class='line'>3981</span>  */</span><span class="WHIT">		
<span class='line'>3982</span> </span><span class="NAME">SharedCollection.prototype.removeItemAt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_index</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3983</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3984</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oldItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getItemAt</span><span class="PUNC">(</span><span class="NAME">p_index</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3985</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.retractItem</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.getItemID</span><span class="PUNC">(</span><span class="NAME">oldItem</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3986</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">oldItem</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3987</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3988</span> 
<span class='line'>3989</span> </span><span class="COMM">/**
<span class='line'>3990</span>  * Removes all items in the collection.
<span class='line'>3991</span>  */</span><span class="WHIT">		
<span class='line'>3992</span> </span><span class="NAME">SharedCollection.prototype.removeAll</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3993</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3994</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">this.sharedArray.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3995</span> </span><span class="WHIT">		</span><span class="NAME">this.removeItemAt</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3996</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3997</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3998</span> 
<span class='line'>3999</span> </span><span class="COMM">/**
<span class='line'>4000</span>  * @private
<span class='line'>4001</span>  */</span><span class="WHIT">
<span class='line'>4002</span> </span><span class="NAME">SharedCollection.prototype.synchronizationChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4003</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4004</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.isSynchronized</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4005</span> </span><span class="WHIT">		</span><span class="NAME">this.myUserID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.connectSession.userManager.myUserID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4006</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.collectionNode.isNodeDefined</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.canUserConfigure</span><span class="PUNC">(</span><span class="NAME">this.myUserID</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4007</span> </span><span class="WHIT">			</span><span class="COMM">// this collectionNode has never been built, and I can add it...</span><span class="WHIT">
<span class='line'>4008</span> </span><span class="WHIT">			</span><span class="NAME">this.collectionNode.createNode</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.nodeConfig</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4009</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4010</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4011</span> </span><span class="WHIT">	</span><span class="NAME">p_evt.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4012</span> </span><span class="WHIT">	</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4013</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4014</span> 
<span class='line'>4015</span> </span><span class="COMM">/**
<span class='line'>4016</span>  * @private
<span class='line'>4017</span>  */</span><span class="WHIT">
<span class='line'>4018</span> </span><span class="NAME">SharedCollection.prototype.reconnect</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4019</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4020</span> </span><span class="WHIT">	</span><span class="NAME">this.removeAll</span><span class="PUNC">(</span><span class="NAME">this.sharedArray</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//expand it</span><span class="WHIT">
<span class='line'>4021</span> </span><span class="WHIT">	</span><span class="NAME">p_evt.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4022</span> </span><span class="WHIT">	</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4023</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4024</span> 
<span class='line'>4025</span> </span><span class="COMM">/**
<span class='line'>4026</span>  * @private
<span class='line'>4027</span>  */</span><span class="WHIT">
<span class='line'>4028</span> </span><span class="NAME">SharedCollection.prototype.itemReceive</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4029</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4030</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_evt.nodeName</span><span class="PUNC">!=</span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4031</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4032</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4033</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.item.body</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4034</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">itemID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.idField</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">newItem</span><span class="PUNC">[</span><span class="NAME">this.idField</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">newItem.uid</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4035</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oldItem</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4036</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4037</span> </span><span class="WHIT">	</span><span class="COMM">// yes, this is ugly. Improve later</span><span class="WHIT">
<span class='line'>4038</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.sharedArray.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4039</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">&lt;</span><span class="NAME">l</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4040</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">itemID</span><span class="PUNC">==</span><span class="NAME">this.getItemID</span><span class="PUNC">(</span><span class="NAME">this.getItemAt</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4041</span> </span><span class="WHIT">			</span><span class="NAME">oldItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getItemAt</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4042</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4043</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4044</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4045</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">oldItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4046</span> </span><span class="WHIT">		</span><span class="COMM">// it's an item update</span><span class="WHIT">
<span class='line'>4047</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">newItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4048</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">newItem</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">!=</span><span class="NAME">oldItem</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4049</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tmpOldValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">oldItem</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4050</span> </span><span class="WHIT">				</span><span class="NAME">oldItem</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newItem</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4051</span> </span><span class="WHIT">				</span><span class="NAME">this.itemUpdated</span><span class="PUNC">(</span><span class="NAME">oldItem</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tmpOldValue</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">oldItem</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//expand</span><span class="WHIT">
<span class='line'>4052</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4053</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4054</span> </span><span class="WHIT">		</span><span class="NAME">this.setLocalItemAt</span><span class="PUNC">(</span><span class="NAME">this.sharedArray</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">oldItem</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4055</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4056</span> </span><span class="WHIT">		</span><span class="NAME">this.addLocalItem</span><span class="PUNC">(</span><span class="NAME">this.sharedArray</span><span class="PUNC">,</span><span class="NAME">newItem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4057</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4058</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4059</span> 
<span class='line'>4060</span> </span><span class="COMM">/**
<span class='line'>4061</span>  * @private
<span class='line'>4062</span>  */</span><span class="WHIT">
<span class='line'>4063</span> </span><span class="NAME">SharedCollection.prototype.itemRetract</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4064</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4065</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_evt.nodeName</span><span class="PUNC">!=</span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4066</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4067</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4068</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.item.body</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4069</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">itemID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.idField</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">newItem</span><span class="PUNC">[</span><span class="NAME">this.idField</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">newItem.uid</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4070</span> </span><span class="WHIT">	
<span class='line'>4071</span> 	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oldItem</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4072</span> </span><span class="WHIT">	</span><span class="COMM">// yes, this is ugly. Improve later</span><span class="WHIT">
<span class='line'>4073</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.sharedArray.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4074</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">&lt;</span><span class="NAME">l</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4075</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">itemID</span><span class="PUNC">==</span><span class="NAME">this.getItemID</span><span class="PUNC">(</span><span class="NAME">this.getItemAt</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4076</span> </span><span class="WHIT">			</span><span class="NAME">oldItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getItemAt</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4077</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4078</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4079</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4080</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">oldItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4081</span> </span><span class="WHIT">		</span><span class="NAME">this.removeLocalItemAt</span><span class="PUNC">(</span><span class="NAME">this.sharedArray</span><span class="PUNC">,</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4082</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4083</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4084</span> 
<span class='line'>4085</span> </span><span class="COMM">/**
<span class='line'>4086</span>  * @private
<span class='line'>4087</span>  */</span><span class="WHIT">
<span class='line'>4088</span> </span><span class="NAME">SharedCollection.prototype.getItemID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_item</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4089</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4090</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">testID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_item.uid</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">p_item.uid</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">p_item</span><span class="PUNC">[</span><span class="NAME">this.idField</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4091</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">testID</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4092</span> </span><span class="WHIT">		</span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">"Each item in a sharedCollection requires a unique ID. Please have your items either implement mx.core.IUID, or "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> 
<span class='line'>4093</span> 			</span><span class="STRN">"specify 'sharedCollection.idField' so that the collection knows which field of your item is unique."</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>4094</span> 	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4095</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">testID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4096</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4097</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4098</span> 
<span class='line'>4099</span> </span><span class="COMM">/**
<span class='line'>4100</span>  * @private
<span class='line'>4101</span>  */</span><span class="WHIT">
<span class='line'>4102</span> </span><span class="NAME">SharedCollection.prototype.getItemAt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_index</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4103</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4104</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_index</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">p_index</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">this.sharedArray.length</span><span class="PUNC">)</span><span class="WHIT">  </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4105</span> </span><span class="WHIT">		</span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">"Out of Bound Error"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4106</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4107</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.sharedArray</span><span class="PUNC">[</span><span class="NAME">p_index</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4108</span> </span><span class="WHIT">	
<span class='line'>4109</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4110</span> 
<span class='line'>4111</span> </span><span class="COMM">/**
<span class='line'>4112</span>  * @private
<span class='line'>4113</span>  */</span><span class="WHIT">
<span class='line'>4114</span> </span><span class="NAME">SharedCollection.prototype.removeLocalItemAt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_array</span><span class="PUNC">,</span><span class="NAME">p_index</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4115</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4116</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">event</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4117</span> </span><span class="WHIT">	</span><span class="NAME">event.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"collectionChange"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4118</span> </span><span class="WHIT">	</span><span class="NAME">event.kind</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"remove"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4119</span> </span><span class="WHIT">	</span><span class="NAME">event.location</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_index</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4120</span> </span><span class="WHIT">	</span><span class="NAME">event.oldItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_array</span><span class="PUNC">[</span><span class="NAME">p_index</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4121</span> </span><span class="WHIT">	</span><span class="NAME">event.newItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4122</span> </span><span class="WHIT">	</span><span class="NAME">p_array.splice</span><span class="PUNC">(</span><span class="NAME">p_index</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4123</span> </span><span class="WHIT">	</span><span class="NAME">event.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">event.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4124</span> </span><span class="WHIT">	</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4125</span> </span><span class="WHIT">	
<span class='line'>4126</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4127</span> 
<span class='line'>4128</span> </span><span class="COMM">/**
<span class='line'>4129</span>  * @private
<span class='line'>4130</span>  */</span><span class="WHIT">
<span class='line'>4131</span> </span><span class="NAME">SharedCollection.prototype.itemUpdated</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">item</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">property</span><span class="PUNC">,</span><span class="NAME">oldValue</span><span class="PUNC">,</span><span class="NAME">newValue</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4132</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4133</span> </span><span class="WHIT">	</span><span class="COMM">//dispatch an event</span><span class="WHIT">
<span class='line'>4134</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">event</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4135</span> </span><span class="WHIT">	</span><span class="NAME">event.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"collectionChange"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4136</span> </span><span class="WHIT">	</span><span class="NAME">event.item</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">item</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4137</span> </span><span class="WHIT">	</span><span class="NAME">event.property</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">property</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4138</span> </span><span class="WHIT">	</span><span class="NAME">event.oldValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">oldValue</span><span class="WHIT">
<span class='line'>4139</span> </span><span class="WHIT">	</span><span class="NAME">event.newValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newValue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4140</span> </span><span class="WHIT">	</span><span class="NAME">event.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">event.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4141</span> </span><span class="WHIT">	</span><span class="NAME">event.kind</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"replace"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4142</span> </span><span class="WHIT">	</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4143</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4144</span> </span><span class="COMM">/**
<span class='line'>4145</span>  * @private
<span class='line'>4146</span>  */</span><span class="WHIT">
<span class='line'>4147</span> </span><span class="NAME">SharedCollection.prototype.setLocalItemAt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_array</span><span class="PUNC">,</span><span class="NAME">p_item</span><span class="PUNC">,</span><span class="NAME">p_index</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4148</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4149</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_index</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">p_index</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">this.sharedArray.length</span><span class="PUNC">)</span><span class="WHIT">  </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4150</span> </span><span class="WHIT">		</span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">"Out of Bound Error"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4151</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4152</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tmp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getItemAt</span><span class="PUNC">(</span><span class="NAME">p_index</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4153</span> </span><span class="WHIT">	</span><span class="NAME">this.sharedArray</span><span class="PUNC">[</span><span class="NAME">p_index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_item</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4154</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">event</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4155</span> </span><span class="WHIT">	</span><span class="NAME">event.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"collectionChange"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4156</span> </span><span class="WHIT">	</span><span class="NAME">event.kind</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"replace"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4157</span> </span><span class="WHIT">	</span><span class="NAME">event.location</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_index</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4158</span> </span><span class="WHIT">	</span><span class="NAME">event.oldItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tmp</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4159</span> </span><span class="WHIT">	</span><span class="NAME">event.newItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_item</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4160</span> </span><span class="WHIT">	</span><span class="NAME">event.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">event.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4161</span> </span><span class="WHIT">	</span><span class="COMM">//this.dispatchEvent(event);</span><span class="WHIT">
<span class='line'>4162</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4163</span> </span><span class="COMM">/**
<span class='line'>4164</span>  * @private
<span class='line'>4165</span>  */</span><span class="WHIT">
<span class='line'>4166</span> </span><span class="NAME">SharedCollection.prototype.addLocalItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_array</span><span class="PUNC">,</span><span class="NAME">p_item</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4167</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4168</span> </span><span class="WHIT">	</span><span class="NAME">this.sharedArray</span><span class="PUNC">[</span><span class="NAME">this.sharedArray.length</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_item</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4169</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">event</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4170</span> </span><span class="WHIT">	</span><span class="NAME">event.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">event.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4171</span> </span><span class="WHIT">	</span><span class="NAME">event.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"collectionChange"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4172</span> </span><span class="WHIT">	</span><span class="NAME">event.kind</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"add"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4173</span> </span><span class="WHIT">	</span><span class="NAME">event.location</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.sharedArray.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4174</span> </span><span class="WHIT">	</span><span class="NAME">event.oldItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4175</span> </span><span class="WHIT">	</span><span class="NAME">event.newItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_item</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4176</span> </span><span class="WHIT">	</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4177</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4178</span> </span><span class="COMM">/**
<span class='line'>4179</span>  * @private
<span class='line'>4180</span>  */</span><span class="WHIT">
<span class='line'>4181</span> </span><span class="NAME">SharedCollection.prototype.getItemIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_item</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4182</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4183</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.sharedArray.length</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4184</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.sharedArray</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">p_item</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4185</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4186</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4187</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4188</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4189</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4190</span> 
<span class='line'>4191</span> </span><span class="NAME">SharedCollection.prototype.contains</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_item</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4192</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4193</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getItemIndex</span><span class="PUNC">(</span><span class="NAME">p_item</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4194</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4195</span> 
<span class='line'>4196</span> </span><span class="NAME">SharedCollection.prototype.length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4197</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4198</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.sharedArray.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4199</span> </span><span class="PUNC">}</span><span class="WHIT"> 
<span class='line'>4200</span> 
<span class='line'>4201</span> 
<span class='line'>4202</span> 
<span class='line'>4203</span> </span><span class="COMM">/**
<span class='line'>4204</span>  * @class SimpleChatModel is a model component which drives the SimpleChat pod. 
<span class='line'>4205</span>  * Its job is to keep the shared state of the chat pod synchronized across
<span class='line'>4206</span>  * multiple users using an internal CollectionNode. It exposes methods for 
<span class='line'>4207</span>  * manipulating that shared model as well as events indicating when that 
<span class='line'>4208</span>  * model changes. In general, user with the viewer role and higher can both 
<span class='line'>4209</span>  * add new messages and view those messages.
<span class='line'>4210</span>  * &lt;table>&lt;tr>&lt;th>&lt;b>Event&lt;/b>&lt;/th>&lt;th>&lt;b>Summary&lt;/b>&lt;/th>&lt;/tr>
<span class='line'>4211</span>  * &lt;tr>&lt;td valign="top">&lt;code>allowPrivateChatChange &lt;/code>&lt;/td> &lt;td> Dispatched when private chat is turned on or off.&lt;/td>&lt;/tr>
<span class='line'>4212</span>  * &lt;tr>&lt;td valign="top">&lt;code>historyChange&lt;/code>&lt;/td> &lt;td> Dispatched when the message history changes; for example, when there is a new message or the messages are cleared.&lt;/td>&lt;/tr>
<span class='line'>4213</span>  * &lt;tr>&lt;td valign="top">&lt;code>synchronizationChange&lt;/code>&lt;/td> &lt;td> Dispatched when the SimpleChatModel has fully connected and synchronized with the service or when it loses that connection.&lt;/td>&lt;/tr>
<span class='line'>4214</span>  * &lt;tr>&lt;td valign="top">&lt;code>timeFormatChange&lt;/code>&lt;/td> &lt;td> Dispatched when the timestamp time format changes.&lt;/td>&lt;/tr>
<span class='line'>4215</span>  * &lt;tr>&lt;td valign="top">&lt;code>typingListUpdate&lt;/code>&lt;/td> &lt;td> Dispatched when the list of currently typing users is updated.&lt;/td>&lt;/tr>
<span class='line'>4216</span>  * &lt;tr>&lt;td valign="top">&lt;code>useTimeStampsChange&lt;/code>&lt;/td> &lt;td> Dispatched when timestamps are turned on or off.&lt;/td>&lt;/tr>
<span class='line'>4217</span>  * &lt;/table>
<span class='line'>4218</span>  * @constructor
<span class='line'>4219</span>  */</span><span class="WHIT">
<span class='line'>4220</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">SimpleChatModel</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4221</span> </span><span class="WHIT">	</span><span class="NAME">this.connectSession</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ConnectSession.primarySession</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4222</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4223</span> </span><span class="NAME">EventDispatcher.initialize</span><span class="PUNC">(</span><span class="NAME">SimpleChatModel.prototype</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4224</span> 
<span class='line'>4225</span> </span><span class="COMM">/**
<span class='line'>4226</span>  * Constant for setting the time format of timestamps to AM/PM mode.
<span class='line'>4227</span>  * @field
<span class='line'>4228</span>  */</span><span class="WHIT">
<span class='line'>4229</span> </span><span class="NAME">SimpleChatModel.prototype.TIMEFORMAT_AM_PM</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"ampm"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4230</span> </span><span class="COMM">/**
<span class='line'>4231</span>  * Constant for setting the time format of timestamps to 24 hour mode.
<span class='line'>4232</span>  * @field
<span class='line'>4233</span>  */</span><span class="WHIT">
<span class='line'>4234</span> </span><span class="NAME">SimpleChatModel.prototype.TIMEFORMAT_24H</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"24h"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4235</span> 
<span class='line'>4236</span> </span><span class="COMM">/**
<span class='line'>4237</span>  * @private
<span class='line'>4238</span>  */</span><span class="WHIT">
<span class='line'>4239</span> </span><span class="NAME">SimpleChatModel.prototype.HISTORY_NODE_EVERYONE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"history"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4240</span> </span><span class="COMM">/**
<span class='line'>4241</span>  * @private
<span class='line'>4242</span>  */</span><span class="WHIT">
<span class='line'>4243</span> </span><span class="NAME">SimpleChatModel.prototype.HISTORY_NODE_PARTICIPANTS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"history_participants"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4244</span> </span><span class="COMM">/**
<span class='line'>4245</span>  * @private
<span class='line'>4246</span>  */</span><span class="WHIT">
<span class='line'>4247</span> </span><span class="NAME">SimpleChatModel.prototype.HISTORY_NODE_HOSTS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"history_hosts"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4248</span> </span><span class="COMM">/**
<span class='line'>4249</span>  * @private
<span class='line'>4250</span>  */</span><span class="WHIT">
<span class='line'>4251</span> </span><span class="NAME">SimpleChatModel.prototype.TYPING_NODE_NAME</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"typing"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4252</span> </span><span class="COMM">/**
<span class='line'>4253</span>  * @private
<span class='line'>4254</span>  */</span><span class="WHIT">
<span class='line'>4255</span> </span><span class="NAME">SimpleChatModel.prototype.TIMEFORMAT_NODE_NAME</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"timeformat"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4256</span> </span><span class="COMM">/**
<span class='line'>4257</span>  * @private
<span class='line'>4258</span>  */</span><span class="WHIT">
<span class='line'>4259</span> </span><span class="NAME">SimpleChatModel.prototype.USE_TIMESTAMPS_NODE_NAME</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"useTimeStamps"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4260</span> </span><span class="COMM">/**
<span class='line'>4261</span>  * @private
<span class='line'>4262</span>  */</span><span class="WHIT">
<span class='line'>4263</span> </span><span class="NAME">SimpleChatModel.prototype.TOO_MANY_TYPING_THRESHOLD</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4264</span> </span><span class="COMM">/**
<span class='line'>4265</span>  * @private
<span class='line'>4266</span>  */</span><span class="WHIT">
<span class='line'>4267</span> </span><span class="NAME">SimpleChatModel.prototype.COLOR_PRIVATE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"990000"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4268</span> </span><span class="COMM">/**
<span class='line'>4269</span>  * @private
<span class='line'>4270</span>  */</span><span class="WHIT">
<span class='line'>4271</span> </span><span class="NAME">SimpleChatModel.prototype.COLOR_HOSTS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"0099FF"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4272</span> 
<span class='line'>4273</span> </span><span class="COMM">/**
<span class='line'>4274</span>  * @private
<span class='line'>4275</span>  */</span><span class="WHIT">
<span class='line'>4276</span> </span><span class="NAME">SimpleChatModel.prototype.collectionNode</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4277</span> </span><span class="COMM">/**
<span class='line'>4278</span>  * @private
<span class='line'>4279</span>  */</span><span class="WHIT">
<span class='line'>4280</span> </span><span class="NAME">SimpleChatModel.prototype.userManager</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4281</span> </span><span class="COMM">/**
<span class='line'>4282</span>  * Returns the current history of chat messages as a string.
<span class='line'>4283</span>  * @field
<span class='line'>4284</span>  */</span><span class="WHIT">		
<span class='line'>4285</span> </span><span class="NAME">SimpleChatModel.prototype.history</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4286</span> </span><span class="COMM">/**
<span class='line'>4287</span>  * @private
<span class='line'>4288</span>  */</span><span class="WHIT">
<span class='line'>4289</span> </span><span class="NAME">SimpleChatModel.prototype.myName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4290</span> </span><span class="COMM">/**
<span class='line'>4291</span>  * Returns a list of currently typing users as a string.
<span class='line'>4292</span>  * @field
<span class='line'>4293</span>  */</span><span class="WHIT">
<span class='line'>4294</span> </span><span class="NAME">SimpleChatModel.prototype.usersTyping</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4295</span> </span><span class="COMM">/**
<span class='line'>4296</span>  * @private
<span class='line'>4297</span>  */</span><span class="WHIT">
<span class='line'>4298</span> </span><span class="NAME">SimpleChatModel.prototype.userWithoutUserDescriptorTyping</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4299</span> </span><span class="COMM">/**
<span class='line'>4300</span>  * @private
<span class='line'>4301</span>  */</span><span class="WHIT">
<span class='line'>4302</span> </span><span class="NAME">SimpleChatModel.prototype.typingTimer</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4303</span> </span><span class="COMM">/**
<span class='line'>4304</span>  * @private
<span class='line'>4305</span>  */</span><span class="WHIT">
<span class='line'>4306</span> </span><span class="NAME">SimpleChatModel.prototype.timeFormat</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4307</span> </span><span class="COMM">/**
<span class='line'>4308</span>  * Specifies whether or not to display timestamps next to each message. 
<span class='line'>4309</span>  * Only users with a publisher role or higher can configure this setting.
<span class='line'>4310</span>  * @field
<span class='line'>4311</span>  */</span><span class="WHIT">
<span class='line'>4312</span> </span><span class="NAME">SimpleChatModel.prototype.useTimeStamps</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4313</span> </span><span class="COMM">/**
<span class='line'>4314</span>  * Specifies whether private chat is allowed. Note that only users with the
<span class='line'>4315</span>  * owner role can configure this setting.
<span class='line'>4316</span>  * @field
<span class='line'>4317</span>  */</span><span class="WHIT">
<span class='line'>4318</span> </span><span class="NAME">SimpleChatModel.prototype.allowPrivateChat</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4319</span> </span><span class="COMM">/**
<span class='line'>4320</span>  * @private
<span class='line'>4321</span>  */</span><span class="WHIT">
<span class='line'>4322</span> </span><span class="NAME">SimpleChatModel.prototype.chatCleared</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4323</span> </span><span class="COMM">/**
<span class='line'>4324</span>  * @private
<span class='line'>4325</span>  */</span><span class="WHIT">
<span class='line'>4326</span> </span><span class="NAME">SimpleChatModel.prototype.isClearAfterSessionRemoved</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4327</span> </span><span class="COMM">/**
<span class='line'>4328</span>  * @private
<span class='line'>4329</span>  */</span><span class="WHIT">
<span class='line'>4330</span> </span><span class="NAME">SimpleChatModel.prototype.messagesSeen</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4331</span> </span><span class="COMM">/**
<span class='line'>4332</span>  * The role value set for accessing the chat history
<span class='line'>4333</span>  * @field
<span class='line'>4334</span>  */</span><span class="WHIT">
<span class='line'>4335</span> </span><span class="NAME">SimpleChatModel.prototype.accessModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4336</span> </span><span class="COMM">/**
<span class='line'>4337</span>  * The role value set to publish to the chat history
<span class='line'>4338</span>  * @field
<span class='line'>4339</span>  */</span><span class="WHIT">
<span class='line'>4340</span> </span><span class="NAME">SimpleChatModel.prototype.publishModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4341</span> </span><span class="COMM">/**
<span class='line'>4342</span>  * The ConnectSession with which this component is associated. Note that this may only be set once before &lt;code>subscribe&lt;/code>
<span class='line'>4343</span>  * is called.
<span class='line'>4344</span>  * @field
<span class='line'>4345</span>  */</span><span class="WHIT">
<span class='line'>4346</span> </span><span class="NAME">SimpleChatModel.prototype.connectSession</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4347</span> </span><span class="COMM">/**
<span class='line'>4348</span>  * Defines the logical location of the component on the service - typically the sharedID of the collectionNode
<span class='line'>4349</span>  * used by the component.
<span class='line'>4350</span>  * @field
<span class='line'>4351</span>  */</span><span class="WHIT">
<span class='line'>4352</span> </span><span class="NAME">SimpleChatModel.prototype.sharedID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"defaultSimpleChat"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4353</span> </span><span class="COMM">/**
<span class='line'>4354</span>  * The default color used in formatting messages for the user's name
<span class='line'>4355</span>  * @field
<span class='line'>4356</span>  */</span><span class="WHIT">
<span class='line'>4357</span> </span><span class="NAME">SimpleChatModel.prototype.nameColor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"0x000000"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4358</span> </span><span class="COMM">/**
<span class='line'>4359</span>  * The default color used in formatting messages for the timestamp
<span class='line'>4360</span>  * @field
<span class='line'>4361</span>  */</span><span class="WHIT">
<span class='line'>4362</span> </span><span class="NAME">SimpleChatModel.prototype.timeStampColor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"0x999999"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4363</span> 
<span class='line'>4364</span> </span><span class="COMM">/**
<span class='line'>4365</span>  * Tells the component to begin synchronizing with the service.  
<span class='line'>4366</span>  * This method must be called explicitly.
<span class='line'>4367</span>  * @function
<span class='line'>4368</span>  */</span><span class="WHIT">
<span class='line'>4369</span> </span><span class="NAME">SimpleChatModel.prototype.subscribe</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4370</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4371</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">CollectionNode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4372</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.sharedID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.sharedID</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4373</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.connectSession</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.connectSession</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4374</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.addEventListener</span><span class="PUNC">(</span><span class="STRN">"synchronizationChange"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4375</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.addEventListener</span><span class="PUNC">(</span><span class="STRN">"userRoleChange"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4376</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.addEventListener</span><span class="PUNC">(</span><span class="STRN">"itemReceive"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4377</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.addEventListener</span><span class="PUNC">(</span><span class="STRN">"itemRetract"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4378</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.addEventListener</span><span class="PUNC">(</span><span class="STRN">"nodeDelete"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4379</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.addEventListener</span><span class="PUNC">(</span><span class="STRN">"nodeCreate"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4380</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.addEventListener</span><span class="PUNC">(</span><span class="STRN">"configurationChange"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4381</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.addEventListener</span><span class="PUNC">(</span><span class="STRN">"reconnect"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4382</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.subscribe</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4383</span> </span><span class="WHIT">	
<span class='line'>4384</span> 	</span><span class="NAME">this.userManager</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.connectSession.userManager</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4385</span> </span><span class="WHIT">	</span><span class="NAME">this.userManager.addEventListener</span><span class="PUNC">(</span><span class="STRN">"userCreate"</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4386</span> </span><span class="WHIT">	
<span class='line'>4387</span> 	</span><span class="NAME">this.usersTyping</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4388</span> </span><span class="WHIT">	</span><span class="NAME">this.userWithoutUserDescriptorTyping</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4389</span> </span><span class="WHIT">	
<span class='line'>4390</span> 	</span><span class="COMM">//this.typingTimer = new Timer(2000, 1);			</span><span class="WHIT">
<span class='line'>4391</span> </span><span class="WHIT">	</span><span class="COMM">//this.typingTimer.addEventListener(TimerEvent.TIMER_COMPLETE, onTimerComplete);</span><span class="WHIT">
<span class='line'>4392</span> </span><span class="WHIT">	</span><span class="COMM">//this.typingTimer = setTimeout(this.onTimerComplete,2000);</span><span class="WHIT">
<span class='line'>4393</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4394</span> 
<span class='line'>4395</span> 
<span class='line'>4396</span> </span><span class="COMM">/**
<span class='line'>4397</span>  * Disposes all listeners to the network and framework classes. Recommended for 
<span class='line'>4398</span>  * proper garbage collection of the component.
<span class='line'>4399</span>  * @function
<span class='line'>4400</span>  */</span><span class="WHIT">
<span class='line'>4401</span> </span><span class="NAME">SimpleChatModel.prototype.close</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4402</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4403</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.removeEventListener</span><span class="PUNC">(</span><span class="STRN">"synchronizationChange"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">synchronizationChange</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4404</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.removeEventListener</span><span class="PUNC">(</span><span class="STRN">"synchronizationChange"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4405</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.removeEventListener</span><span class="PUNC">(</span><span class="STRN">"userRoleChange"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4406</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.removeEventListener</span><span class="PUNC">(</span><span class="STRN">"itemReceive"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4407</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.removeEventListener</span><span class="PUNC">(</span><span class="STRN">"itemRetract"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4408</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.removeEventListener</span><span class="PUNC">(</span><span class="STRN">"nodeDelete"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4409</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.removeEventListener</span><span class="PUNC">(</span><span class="STRN">"nodeCreate"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4410</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.removeEventListener</span><span class="PUNC">(</span><span class="STRN">"configurationChange"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4411</span> </span><span class="WHIT">	</span><span class="NAME">this.userManager.removeEventListener</span><span class="PUNC">(</span><span class="STRN">"userCreate"</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4412</span> </span><span class="WHIT">	
<span class='line'>4413</span> 	</span><span class="NAME">this.collectionNode.unsubscribe</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4414</span> </span><span class="WHIT">	</span><span class="NAME">clearTimeout</span><span class="PUNC">(</span><span class="NAME">this.typingTimer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4415</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4416</span> 
<span class='line'>4417</span> </span><span class="COMM">/**
<span class='line'>4418</span>  * Determines whether the Model is connected and fully synchronized with the service.
<span class='line'>4419</span>  * @function
<span class='line'>4420</span>  */</span><span class="WHIT">
<span class='line'>4421</span> </span><span class="NAME">SimpleChatModel.prototype.isSynchronized</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4422</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4423</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.isSynchronized</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4424</span> </span><span class="PUNC">}</span><span class="WHIT">		
<span class='line'>4425</span> 
<span class='line'>4426</span> </span><span class="COMM">/**
<span class='line'>4427</span>  * Sends a message which is specified by the ChatMessageDescriptor.
<span class='line'>4428</span>  * 
<span class='line'>4429</span>  * @param p_msgDesc the message to send
<span class='line'>4430</span>  * @function
<span class='line'>4431</span>  */</span><span class="WHIT">
<span class='line'>4432</span> </span><span class="NAME">SimpleChatModel.prototype.sendMessage</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_msgDesc</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4433</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4434</span> </span><span class="WHIT">	</span><span class="COMM">//do this before the returns</span><span class="WHIT">
<span class='line'>4435</span> </span><span class="WHIT">	</span><span class="COMM">//if (this.typingTimer.running) {</span><span class="WHIT">
<span class='line'>4436</span> </span><span class="WHIT">	</span><span class="COMM">//      this.typingTimer.stop();</span><span class="WHIT">
<span class='line'>4437</span> </span><span class="WHIT">	</span><span class="COMM">//    onTimerComplete();</span><span class="WHIT">
<span class='line'>4438</span> </span><span class="WHIT">	</span><span class="COMM">//}</span><span class="WHIT">
<span class='line'>4439</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.typingTimer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4440</span> </span><span class="WHIT">		</span><span class="NAME">clearTimeout</span><span class="PUNC">(</span><span class="NAME">this.typingTimer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4441</span> </span><span class="WHIT">		</span><span class="NAME">this.onTimerComplete</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4442</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4443</span> </span><span class="WHIT">	
<span class='line'>4444</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.collectionNode.isSynchronized</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4445</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4446</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4447</span> </span><span class="WHIT">	
<span class='line'>4448</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_msgDesc.msg</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">p_msgDesc.msg.length</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4449</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="COMM">//we don't send empty messages</span><span class="WHIT">
<span class='line'>4450</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4451</span> </span><span class="WHIT">	
<span class='line'>4452</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_msgDesc.recipient</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">this.allowPrivateChat</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4453</span> </span><span class="WHIT">		</span><span class="COMM">//private messages are not allowed, return</span><span class="WHIT">
<span class='line'>4454</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4455</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4456</span> </span><span class="WHIT">	
<span class='line'>4457</span> 	</span><span class="NAME">p_msgDesc.displayName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.userManager.getUserDescriptor</span><span class="PUNC">(</span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">displayName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4458</span> </span><span class="WHIT">	
<span class='line'>4459</span> 	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodeName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4460</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_msgDesc.role</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4461</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_msgDesc.role</span><span class="PUNC">==</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4462</span> </span><span class="WHIT">			</span><span class="NAME">nodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.HISTORY_NODE_EVERYONE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4463</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_msgDesc.role</span><span class="PUNC">==</span><span class="NUMB">50</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4464</span> </span><span class="WHIT">			</span><span class="NAME">nodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.HISTORY_NODE_PARTICIPANTS</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4465</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4466</span> </span><span class="WHIT">			</span><span class="NAME">nodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.HISTORY_NODE_HOSTS</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4467</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4468</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4469</span> </span><span class="WHIT">		</span><span class="NAME">nodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.HISTORY_NODE_EVERYONE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4470</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4471</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">msg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4472</span> </span><span class="WHIT">	</span><span class="NAME">msg.body</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_msgDesc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4473</span> </span><span class="WHIT">	</span><span class="NAME">msg.nodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nodeName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4474</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_msgDesc.recipient</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4475</span> </span><span class="WHIT">		</span><span class="NAME">msg.recipientID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_msgDesc.recipient</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4476</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4477</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_msgDesc.role</span><span class="PUNC">></span><span class="NAME">this.collectionNode.getUserRole</span><span class="PUNC">(</span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nodeName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4478</span> </span><span class="WHIT">		</span><span class="NAME">p_msgDesc.timeStamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4479</span> </span><span class="WHIT">		</span><span class="NAME">this.addMsgToHistory</span><span class="PUNC">(</span><span class="NAME">p_msgDesc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4480</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4481</span> </span><span class="WHIT">	</span><span class="NAME">this.collectionNode.publishItem</span><span class="PUNC">(</span><span class="NAME">msg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4482</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4483</span> 
<span class='line'>4484</span> </span><span class="COMM">/**
<span class='line'>4485</span>  * Gets the NodeConfiguration on a specific node in the ChatModel. If the node is not defined, it will return null
<span class='line'>4486</span>  * @param p_nodeName The name of the node.
<span class='line'>4487</span>  * @function
<span class='line'>4488</span>  */</span><span class="WHIT">
<span class='line'>4489</span> </span><span class="NAME">SimpleChatModel.prototype.getNodeConfiguration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_nodeName</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4490</span> </span><span class="PUNC">{</span><span class="WHIT">	
<span class='line'>4491</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.isNodeDefined</span><span class="PUNC">(</span><span class="NAME">p_nodeName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4492</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">p_nodeName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4493</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4494</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4495</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4496</span> 
<span class='line'>4497</span> </span><span class="COMM">/**
<span class='line'>4498</span>  * Sets the NodeConfiguration on a already defined node in chatModel. If the node is not defined, it will not do anything.
<span class='line'>4499</span>  * @param p_nodeConfiguration The node Configuration on a node in the NodeConfiguration.
<span class='line'>4500</span>  * @param p_nodeName The name of the node.
<span class='line'>4501</span>  * @function
<span class='line'>4502</span>  */</span><span class="WHIT">
<span class='line'>4503</span> </span><span class="NAME">SimpleChatModel.prototype.setNodeConfiguration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_nodeName</span><span class="PUNC">,</span><span class="NAME">p_nodeConfiguration</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4504</span> </span><span class="PUNC">{</span><span class="WHIT">	
<span class='line'>4505</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.isNodeDefined</span><span class="PUNC">(</span><span class="NAME">p_nodeName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4506</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.setNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">p_nodeName</span><span class="PUNC">,</span><span class="NAME">p_nodeConfiguration</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4507</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4508</span> </span><span class="WHIT">	
<span class='line'>4509</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4510</span> 
<span class='line'>4511</span> </span><span class="COMM">/**
<span class='line'>4512</span>  * Set the role value required for publishing to the chat
<span class='line'>4513</span>  * @function
<span class='line'>4514</span>  */</span><span class="WHIT">
<span class='line'>4515</span> </span><span class="NAME">SimpleChatModel.prototype.setPublishModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_publishModel</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4516</span> </span><span class="PUNC">{</span><span class="WHIT">	
<span class='line'>4517</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">p_publishModel</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">p_publishModel</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">100</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>4518</span> 		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>4519</span> 	
<span class='line'>4520</span> 	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodeConf</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4521</span> </span><span class="WHIT">	
<span class='line'>4522</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.HISTORY_NODE_EVERYONE</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">publishModel</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">p_publishModel</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4523</span> </span><span class="WHIT">		</span><span class="NAME">nodeConf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.HISTORY_NODE_EVERYONE</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4524</span> </span><span class="WHIT">		</span><span class="NAME">nodeConf.publishModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_publishModel</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4525</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.setNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.HISTORY_NODE_EVERYONE</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nodeConf</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4526</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4527</span> </span><span class="WHIT">	
<span class='line'>4528</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.HISTORY_NODE_HOSTS</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">publishModel</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">p_publishModel</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4529</span> </span><span class="WHIT">		</span><span class="NAME">nodeConf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.HISTORY_NODE_HOSTS</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4530</span> </span><span class="WHIT">		</span><span class="NAME">nodeConf.publishModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_publishModel</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4531</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.setNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.HISTORY_NODE_HOSTS</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nodeConf</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4532</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4533</span> </span><span class="WHIT">	
<span class='line'>4534</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.HISTORY_NODE_PARTICIPANTS</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">publishModel</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">p_publishModel</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4535</span> </span><span class="WHIT">		</span><span class="NAME">nodeConf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.HISTORY_NODE_PARTICIPANTS</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4536</span> </span><span class="WHIT">		</span><span class="NAME">nodeConf.publishModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_publishModel</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4537</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.setNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.HISTORY_NODE_PARTICIPANTS</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nodeConf</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4538</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4539</span> </span><span class="WHIT">	
<span class='line'>4540</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">TYPING_NODE_NAME</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">publishModel</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">p_publishModel</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4541</span> </span><span class="WHIT">		</span><span class="NAME">nodeConf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">TYPING_NODE_NAME</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4542</span> </span><span class="WHIT">		</span><span class="NAME">nodeConf.publishModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_publishModel</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4543</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.setNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">TYPING_NODE_NAME</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nodeConf</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4544</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4545</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4546</span> 
<span class='line'>4547</span> </span><span class="COMM">/**
<span class='line'>4548</span>  * The role value required for publishing to the chat
<span class='line'>4549</span>  * @function
<span class='line'>4550</span>  */</span><span class="WHIT">
<span class='line'>4551</span> </span><span class="NAME">SimpleChatModel.prototype.getPublishModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4552</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4553</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.HISTORY_NODE_EVERYONE</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">publishModel</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4554</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4555</span> 
<span class='line'>4556</span> </span><span class="COMM">/**
<span class='line'>4557</span>  * Set The role value required for accessing the chat history
<span class='line'>4558</span>  * @function
<span class='line'>4559</span>  */</span><span class="WHIT">
<span class='line'>4560</span> </span><span class="NAME">SimpleChatModel.prototype.setAccessModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_accessModel</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4561</span> </span><span class="PUNC">{</span><span class="WHIT">	
<span class='line'>4562</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">p_accessModel</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">p_accessModel</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">100</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>4563</span> 		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>4564</span> 	
<span class='line'>4565</span> 	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodeConf</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4566</span> </span><span class="WHIT">	
<span class='line'>4567</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.HISTORY_NODE_EVERYONE</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">accessModel</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">p_accessModel</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4568</span> </span><span class="WHIT">		</span><span class="NAME">nodeConf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.HISTORY_NODE_EVERYONE</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4569</span> </span><span class="WHIT">		</span><span class="NAME">nodeConf.accessModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_accessModel</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4570</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.setNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.HISTORY_NODE_EVERYONE</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nodeConf</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4571</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4572</span> </span><span class="WHIT">	
<span class='line'>4573</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.TYPING_NODE_NAME</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">accessModel</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">p_accessModel</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4574</span> </span><span class="WHIT">		</span><span class="NAME">nodeConf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.TYPING_NODE_NAME</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4575</span> </span><span class="WHIT">		</span><span class="NAME">nodeConf.accessModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_accessModel</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4576</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.setNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.TYPING_NODE_NAME</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nodeConf</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4577</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">	
<span class='line'>4578</span> 	
<span class='line'>4579</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4580</span> 
<span class='line'>4581</span> </span><span class="COMM">/**
<span class='line'>4582</span>  * The role value required for accessing the chat history
<span class='line'>4583</span>  * @function
<span class='line'>4584</span>  */</span><span class="WHIT">
<span class='line'>4585</span> </span><span class="NAME">SimpleChatModel.prototype.getAccessModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4586</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4587</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.HISTORY_NODE_EVERYONE</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">accessModel</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4588</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4589</span> 
<span class='line'>4590</span> </span><span class="COMM">/**
<span class='line'>4591</span>  *  Returns the role of a given user for the chat.
<span class='line'>4592</span>  * 
<span class='line'>4593</span>  * @param p_userID UserID of the user in question
<span class='line'>4594</span>  * @function
<span class='line'>4595</span>  */</span><span class="WHIT">
<span class='line'>4596</span> </span><span class="NAME">SimpleChatModel.prototype.getUserRole</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4597</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4598</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.collectionNode.isSynchronized</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getUserRole</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4599</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4600</span> 
<span class='line'>4601</span> </span><span class="COMM">/**
<span class='line'>4602</span>  *  Sets the role of a given user for the chat.
<span class='line'>4603</span>  * 
<span class='line'>4604</span>  * @param p_userID UserID of the user whose role we are setting
<span class='line'>4605</span>  * @param p_userRole Role value we are setting
<span class='line'>4606</span>  * @function
<span class='line'>4607</span>  */</span><span class="WHIT">
<span class='line'>4608</span> </span><span class="NAME">SimpleChatModel.prototype.setUserRole</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="WHIT"> </span><span class="PUNC">,</span><span class="NAME">p_userRole</span><span class="PUNC">,</span><span class="NAME">p_nodeName</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4609</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4610</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">p_userID</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>4611</span> 		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4612</span> </span><span class="WHIT">	
<span class='line'>4613</span> 	
<span class='line'>4614</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_userRole</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">p_userRole</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">100</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">p_userRole</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">999</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>4615</span> 		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>4616</span> 	
<span class='line'>4617</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_nodeName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4618</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.isNodeDefined</span><span class="PUNC">(</span><span class="NAME">p_nodeName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4619</span> </span><span class="WHIT">			</span><span class="NAME">this.collectionNode.setUserRole</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="NAME">p_userRole</span><span class="PUNC">,</span><span class="NAME">p_nodeName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4620</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4621</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4622</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.setUserRole</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="NAME">p_userRole</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4623</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4624</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4625</span> 
<span class='line'>4626</span> </span><span class="COMM">/**
<span class='line'>4627</span>  * Clears all chat history. Note that only a user with role UserRoles.OWNER may clear the chat
<span class='line'>4628</span>  * @function
<span class='line'>4629</span>  */</span><span class="WHIT">
<span class='line'>4630</span> </span><span class="NAME">SimpleChatModel.prototype.clear</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4631</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4632</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.collectionNode.isSynchronized</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.canUserConfigure</span><span class="PUNC">(</span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4633</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.removeNode</span><span class="PUNC">(</span><span class="NAME">this.HISTORY_NODE_EVERYONE</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4634</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodeConfig</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4635</span> </span><span class="WHIT">		</span><span class="NAME">nodeConfig.accessModel</span><span class="PUNC">=</span><span class="NUMB">10</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4636</span> </span><span class="WHIT">		</span><span class="NAME">nodeConfig.publishModel</span><span class="PUNC">=</span><span class="NUMB">10</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4637</span> </span><span class="WHIT">		</span><span class="NAME">nodeConfig.persistItems</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4638</span> </span><span class="WHIT">		</span><span class="NAME">nodeConfig.modifyAnyItem</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4639</span> </span><span class="WHIT">		</span><span class="NAME">nodeConfig.userDependentItems</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4640</span> </span><span class="WHIT">		</span><span class="NAME">nodeConfig.sessionDependentItems</span><span class="PUNC">=</span><span class="NAME">this.isClearAfterSessionRemoved</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4641</span> </span><span class="WHIT">		</span><span class="NAME">nodeConfig.itemStorageScheme</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4642</span> </span><span class="WHIT">		</span><span class="NAME">nodeConfig.allowPrivateMessages</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4643</span> </span><span class="WHIT">		</span><span class="NAME">nodeConfig.lazySubscription</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4644</span> </span><span class="WHIT">		</span><span class="NAME">nodeConfig.p2pDataMessaging</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4645</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.createNode</span><span class="PUNC">(</span><span class="NAME">this.HISTORY_NODE_EVERYONE</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nodeConfig</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4646</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.removeNode</span><span class="PUNC">(</span><span class="NAME">this.HISTORY_NODE_PARTICIPANTS</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4647</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">partNodeConfig</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4648</span> </span><span class="WHIT">		</span><span class="NAME">partNodeConfig.accessModel</span><span class="PUNC">=</span><span class="NUMB">50</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4649</span> </span><span class="WHIT">		</span><span class="NAME">partNodeConfig.publishModel</span><span class="PUNC">=</span><span class="NUMB">10</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4650</span> </span><span class="WHIT">		</span><span class="NAME">partNodeConfig.persistItems</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4651</span> </span><span class="WHIT">		</span><span class="NAME">partNodeConfig.modifyAnyItem</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4652</span> </span><span class="WHIT">		</span><span class="NAME">partNodeConfig.userDependentItems</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4653</span> </span><span class="WHIT">		</span><span class="NAME">partNodeConfig.sessionDependentItems</span><span class="PUNC">=</span><span class="NAME">this.isClearAfterSessionRemoved</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4654</span> </span><span class="WHIT">		</span><span class="NAME">partNodeConfig.itemStorageScheme</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4655</span> </span><span class="WHIT">		</span><span class="NAME">partNodeConfig.allowPrivateMessages</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4656</span> </span><span class="WHIT">		</span><span class="NAME">partNodeConfig.lazySubscription</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4657</span> </span><span class="WHIT">		</span><span class="NAME">partNodeConfig.p2pDataMessaging</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4658</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.createNode</span><span class="PUNC">(</span><span class="NAME">this.HISTORY_NODE_PARTICIPANTS</span><span class="PUNC">,</span><span class="NAME">nodeConfig</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4659</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.removeNode</span><span class="PUNC">(</span><span class="NAME">this.HISTORY_NODE_HOSTS</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4660</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">hostNodeConfig</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4661</span> </span><span class="WHIT">		</span><span class="NAME">hostNodeConfig.accessModel</span><span class="PUNC">=</span><span class="NUMB">100</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4662</span> </span><span class="WHIT">		</span><span class="NAME">hostNodeConfig.publishModel</span><span class="PUNC">=</span><span class="NUMB">10</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4663</span> </span><span class="WHIT">		</span><span class="NAME">hostNodeConfig.persistItems</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4664</span> </span><span class="WHIT">		</span><span class="NAME">hostNodeConfig.modifyAnyItem</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4665</span> </span><span class="WHIT">		</span><span class="NAME">hostNodeConfig.userDependentItems</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4666</span> </span><span class="WHIT">		</span><span class="NAME">hostNodeConfig.sessionDependentItems</span><span class="PUNC">=</span><span class="NAME">this.isClearAfterSessionRemoved</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4667</span> </span><span class="WHIT">		</span><span class="NAME">hostNodeConfig.itemStorageScheme</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4668</span> </span><span class="WHIT">		</span><span class="NAME">hostNodeConfig.allowPrivateMessages</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4669</span> </span><span class="WHIT">		</span><span class="NAME">hostNodeConfig.lazySubscription</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4670</span> </span><span class="WHIT">		</span><span class="NAME">hostNodeConfig.p2pDataMessaging</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4671</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.createNode</span><span class="PUNC">(</span><span class="NAME">this.HISTORY_NODE_HOSTS</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nodeConfig</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4672</span> </span><span class="WHIT">		</span><span class="NAME">this.messagesSeen</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4673</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4674</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4675</span> 
<span class='line'>4676</span> </span><span class="COMM">/**
<span class='line'>4677</span>  * The format of timestamps.
<span class='line'>4678</span>  * @function
<span class='line'>4679</span>  */</span><span class="WHIT">
<span class='line'>4680</span> </span><span class="NAME">SimpleChatModel.prototype.getTimeFormat</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4681</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4682</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.timeFormat</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4683</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4684</span> 
<span class='line'>4685</span> </span><span class="COMM">/**
<span class='line'>4686</span>  * Specifies the format of timestamps (see the constants on this class). 
<span class='line'>4687</span>  * Note that only a user with a publisher role or higher can change this setting.
<span class='line'>4688</span>  * @function
<span class='line'>4689</span>  */</span><span class="WHIT">
<span class='line'>4690</span> </span><span class="NAME">SimpleChatModel.prototype.setTimeFormat</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_timeFormat</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4691</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4692</span> </span><span class="WHIT">	</span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_timeFormat</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4693</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">this.TIMEFORMAT_24H</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4694</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">this.TIMEFORMAT_AM_PM</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4695</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4696</span> </span><span class="WHIT">		</span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4697</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4698</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4699</span> </span><span class="WHIT">	
<span class='line'>4700</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.timeFormat</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">p_timeFormat</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4701</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4702</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4703</span> </span><span class="WHIT">	
<span class='line'>4704</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.collectionNode.canUserPublish</span><span class="PUNC">(</span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.TIMEFORMAT_NODE_NAME</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4705</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">msgItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4706</span> </span><span class="WHIT">		</span><span class="NAME">msgItem.nodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.TIMEFORMAT_NODE_NAME</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4707</span> </span><span class="WHIT">		</span><span class="NAME">msgItem.body</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_timeFormat</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4708</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.publishItem</span><span class="PUNC">(</span><span class="NAME">msgItem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4709</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4710</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4711</span> 
<span class='line'>4712</span> </span><span class="COMM">/**
<span class='line'>4713</span>  * Specifies whether or not to display timestamps next to each message.
<span class='line'>4714</span>  * @function
<span class='line'>4715</span>  */</span><span class="WHIT">
<span class='line'>4716</span> </span><span class="NAME">SimpleChatModel.prototype.getUseTimeStamps</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4717</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4718</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.useTimeStamps</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4719</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4720</span> 
<span class='line'>4721</span> </span><span class="COMM">/**
<span class='line'>4722</span>  * Specifies whether or not to display timestamps next to each message. 
<span class='line'>4723</span>  * Only users with a publisher role or higher can configure this setting.
<span class='line'>4724</span>  * @function
<span class='line'>4725</span>  */</span><span class="WHIT">
<span class='line'>4726</span> </span><span class="NAME">SimpleChatModel.prototype.setUseTimeStamps</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_useThem</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4727</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4728</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.useTimeStamps</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">p_useThem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4729</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4730</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4731</span> </span><span class="WHIT">	
<span class='line'>4732</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.collectionNode.canUserPublish</span><span class="PUNC">(</span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.USE_TIMESTAMPS_NODE_NAME</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4733</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">msgItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4734</span> </span><span class="WHIT">		</span><span class="NAME">msgItem.nodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.USE_TIMESTAMPS_NODE_NAME</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4735</span> </span><span class="WHIT">		</span><span class="NAME">msgItem.body</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_useThem</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4736</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.publishItem</span><span class="PUNC">(</span><span class="NAME">msgItem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4737</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4738</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4739</span> 
<span class='line'>4740</span> </span><span class="COMM">/**
<span class='line'>4741</span>  * Specifies whether private chat is allowed.
<span class='line'>4742</span>  * @function
<span class='line'>4743</span>  */</span><span class="WHIT">
<span class='line'>4744</span> </span><span class="NAME">SimpleChatModel.prototype.getAllowPrivateChat</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4745</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4746</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.allowPrivateChat</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4747</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4748</span> 
<span class='line'>4749</span> </span><span class="COMM">/**
<span class='line'>4750</span>  * Specifies whether private chat is allowed. Note that only users with the
<span class='line'>4751</span>  * owner role can configure this setting.
<span class='line'>4752</span>  * @function
<span class='line'>4753</span>  */</span><span class="WHIT">
<span class='line'>4754</span> </span><span class="NAME">SimpleChatModel.prototype.setAllowPrivateChat</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_allowIt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4755</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4756</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.allowPrivateChat</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">p_allowIt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4757</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4758</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4759</span> </span><span class="WHIT">	
<span class='line'>4760</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.collectionNode.canUserConfigure</span><span class="PUNC">(</span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.HISTORY_NODE_EVERYONE</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4761</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oldConfig</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.HISTORY_NODE_EVERYONE</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4762</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newConfig</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">NodeConfiguration</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4763</span> </span><span class="WHIT">		</span><span class="NAME">newConfig</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">oldConfig</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4764</span> </span><span class="WHIT">		</span><span class="NAME">newConfig.allowPrivateMessages</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_allowIt</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4765</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.setNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">HISTORY_NODE_EVERYONE</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newConfig</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4766</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4767</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4768</span> 
<span class='line'>4769</span> </span><span class="COMM">/**
<span class='line'>4770</span>  * Returns a list of currently typing users as a string.
<span class='line'>4771</span>  * @function
<span class='line'>4772</span>  */</span><span class="WHIT">
<span class='line'>4773</span> </span><span class="NAME">SimpleChatModel.prototype.getUsersTyping</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4774</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4775</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">res</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4776</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">this.usersTyping.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4777</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">userID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.usersTyping</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4778</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">desc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.userManager.getUserDescriptor</span><span class="PUNC">(</span><span class="NAME">userID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4779</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">desc</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">userID</span><span class="PUNC">!=</span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4780</span> </span><span class="WHIT">			</span><span class="NAME">res</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">res</span><span class="PUNC">==</span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">""</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">", "</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">desc.displayName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4781</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4782</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4783</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">res</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4784</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4785</span> 
<span class='line'>4786</span> </span><span class="COMM">/**
<span class='line'>4787</span>  * Updates the model to notify others that the current user is typing. This is automatically withdrawn after 2 seconds, unless this method is called again
<span class='line'>4788</span>  * during that time, at which point the 2 second timeout is reset. Typically, chaining this call to a TextInput's CHANGE event is effective - iAmTyping will 
<span class='line'>4789</span>  * avoid re-broadcasting the notification if not needed.
<span class='line'>4790</span>  * @function
<span class='line'>4791</span>  */</span><span class="WHIT">
<span class='line'>4792</span> </span><span class="NAME">SimpleChatModel.prototype.iAmTyping</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4793</span> </span><span class="PUNC">{</span><span class="WHIT">			
<span class='line'>4794</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.collectionNode.isSynchronized</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4795</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4796</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4797</span> </span><span class="WHIT">	
<span class='line'>4798</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.contains</span><span class="PUNC">(</span><span class="NAME">this.usersTyping</span><span class="PUNC">,</span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4799</span> </span><span class="WHIT">		</span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.usersTyping.length</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.TOO_MANY_TYPING_THRESHOLD</span><span class="WHIT">
<span class='line'>4800</span> </span><span class="WHIT">	</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4801</span> </span><span class="WHIT">		</span><span class="COMM">//I'm not typing yet and we're below the threshold, publish my item</span><span class="WHIT">
<span class='line'>4802</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.publishItem</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">MessageItem</span><span class="PUNC">(</span><span class="NAME">TYPING_NODE_NAME</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4803</span> </span><span class="WHIT">		
<span class='line'>4804</span> 		</span><span class="COMM">//the receiveItem will start the timer</span><span class="WHIT">
<span class='line'>4805</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">				
<span class='line'>4806</span> 	
<span class='line'>4807</span> 	</span><span class="COMM">//Extend the timer if it's running (and it's only running if we received our own typing item)</span><span class="WHIT">
<span class='line'>4808</span> </span><span class="WHIT">	</span><span class="NAME">this.typingTimer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">bindUsingClosure</span><span class="PUNC">(</span><span class="NAME">this.onTimerComplete</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2000</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4809</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4810</span> 
<span class='line'>4811</span> </span><span class="COMM">/**
<span class='line'>4812</span>  *@private
<span class='line'>4813</span>  */</span><span class="WHIT">
<span class='line'>4814</span> </span><span class="NAME">SimpleChatModel.prototype.onTimerComplete</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4815</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4816</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">args</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.contains</span><span class="PUNC">(</span><span class="NAME">args.usersTyping</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args.userManager.myUserID</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4817</span> </span><span class="WHIT">		</span><span class="NAME">args.collectionNode.retractItem</span><span class="PUNC">(</span><span class="NAME">TYPING_NODE_NAME</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args.userManager.myUserID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4818</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4819</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4820</span> 
<span class='line'>4821</span> </span><span class="COMM">/**
<span class='line'>4822</span>  *@private
<span class='line'>4823</span>  */</span><span class="WHIT">
<span class='line'>4824</span> </span><span class="NAME">SimpleChatModel.prototype.reconnect</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4825</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4826</span> </span><span class="WHIT">	</span><span class="NAME">this.history</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4827</span> </span><span class="WHIT">	</span><span class="NAME">this.messagesSeen</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4828</span> </span><span class="WHIT">	</span><span class="NAME">this.chatCleared</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4829</span> </span><span class="WHIT">	</span><span class="NAME">p_evt.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4830</span> </span><span class="WHIT">	</span><span class="NAME">p_evt.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"historyChange"</span><span class="WHIT">
<span class='line'>4831</span> </span><span class="WHIT">	</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4832</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4833</span> 
<span class='line'>4834</span> </span><span class="COMM">/**
<span class='line'>4835</span>  *@private
<span class='line'>4836</span>  */</span><span class="WHIT">
<span class='line'>4837</span> </span><span class="NAME">SimpleChatModel.prototype.synchronizationChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_event</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4838</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4839</span> </span><span class="WHIT">	</span><span class="NAME">this.myName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.userManager.getUserDescriptor</span><span class="PUNC">(</span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">displayName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4840</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.collectionNode.isSynchronized</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4841</span> </span><span class="WHIT">		</span><span class="COMM">//if the node doesn't exist and I'm a host, create it empty so that viewers can publish to it</span><span class="WHIT">
<span class='line'>4842</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.collectionNode.isNodeDefined</span><span class="PUNC">(</span><span class="NAME">this.HISTORY_NODE_EVERYONE</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.canUserConfigure</span><span class="PUNC">(</span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4843</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodeConfig</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4844</span> </span><span class="WHIT">			</span><span class="NAME">nodeConfig.accessModel</span><span class="PUNC">=</span><span class="NUMB">10</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4845</span> </span><span class="WHIT">			</span><span class="NAME">nodeConfig.publishModel</span><span class="PUNC">=</span><span class="NUMB">10</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4846</span> </span><span class="WHIT">			</span><span class="NAME">nodeConfig.persistItems</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4847</span> </span><span class="WHIT">			</span><span class="NAME">nodeConfig.modifyAnyItem</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4848</span> </span><span class="WHIT">			</span><span class="NAME">nodeConfig.userDependentItems</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4849</span> </span><span class="WHIT">			</span><span class="NAME">nodeConfig.sessionDependentItems</span><span class="PUNC">=</span><span class="NAME">this.isClearAfterSessionRemoved</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4850</span> </span><span class="WHIT">			</span><span class="NAME">nodeConfig.itemStorageScheme</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4851</span> </span><span class="WHIT">			</span><span class="NAME">nodeConfig.allowPrivateMessages</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4852</span> </span><span class="WHIT">			</span><span class="NAME">nodeConfig.lazySubscription</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4853</span> </span><span class="WHIT">			</span><span class="NAME">nodeConfig.p2pDataMessaging</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4854</span> </span><span class="WHIT">			</span><span class="NAME">this.collectionNode.createNode</span><span class="PUNC">(</span><span class="NAME">this.HISTORY_NODE_EVERYONE</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nodeConfig</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4855</span> </span><span class="WHIT">			
<span class='line'>4856</span> 			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">partNodeConfig</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4857</span> </span><span class="WHIT">			</span><span class="NAME">partNodeConfig.accessModel</span><span class="PUNC">=</span><span class="NUMB">50</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4858</span> </span><span class="WHIT">			</span><span class="NAME">partNodeConfig.publishModel</span><span class="PUNC">=</span><span class="NUMB">10</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4859</span> </span><span class="WHIT">			</span><span class="NAME">partNodeConfig.persistItems</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4860</span> </span><span class="WHIT">			</span><span class="NAME">partNodeConfig.modifyAnyItem</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4861</span> </span><span class="WHIT">			</span><span class="NAME">partNodeConfig.userDependentItems</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4862</span> </span><span class="WHIT">			</span><span class="NAME">partNodeConfig.sessionDependentItems</span><span class="PUNC">=</span><span class="NAME">this.isClearAfterSessionRemoved</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4863</span> </span><span class="WHIT">			</span><span class="NAME">partNodeConfig.itemStorageScheme</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4864</span> </span><span class="WHIT">			</span><span class="NAME">partNodeConfig.allowPrivateMessages</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4865</span> </span><span class="WHIT">			</span><span class="NAME">partNodeConfig.lazySubscription</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4866</span> </span><span class="WHIT">			</span><span class="NAME">partNodeConfig.p2pDataMessaging</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4867</span> </span><span class="WHIT">			</span><span class="NAME">this.collectionNode.createNode</span><span class="PUNC">(</span><span class="NAME">this.HISTORY_NODE_PARTICIPANTS</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">partNodeConfig</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4868</span> </span><span class="WHIT">			
<span class='line'>4869</span> 			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">hostNodeConfig</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4870</span> </span><span class="WHIT">			</span><span class="NAME">hostNodeConfig.accessModel</span><span class="PUNC">=</span><span class="NUMB">100</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4871</span> </span><span class="WHIT">			</span><span class="NAME">hostNodeConfig.publishModel</span><span class="PUNC">=</span><span class="NUMB">10</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4872</span> </span><span class="WHIT">			</span><span class="NAME">hostNodeConfig.persistItems</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4873</span> </span><span class="WHIT">			</span><span class="NAME">hostNodeConfig.modifyAnyItem</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4874</span> </span><span class="WHIT">			</span><span class="NAME">hostNodeConfig.userDependentItems</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4875</span> </span><span class="WHIT">			</span><span class="NAME">hostNodeConfig.sessionDependentItems</span><span class="PUNC">=</span><span class="NAME">this.isClearAfterSessionRemoved</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4876</span> </span><span class="WHIT">			</span><span class="NAME">hostNodeConfig.itemStorageScheme</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4877</span> </span><span class="WHIT">			</span><span class="NAME">hostNodeConfig.allowPrivateMessages</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4878</span> </span><span class="WHIT">			</span><span class="NAME">hostNodeConfig.lazySubscription</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4879</span> </span><span class="WHIT">			</span><span class="NAME">hostNodeConfig.p2pDataMessaging</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4880</span> </span><span class="WHIT">			</span><span class="NAME">this.collectionNode.createNode</span><span class="PUNC">(</span><span class="NAME">this.HISTORY_NODE_HOSTS</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hostNodeConfig</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4881</span> </span><span class="WHIT">			
<span class='line'>4882</span> 			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodeConfig1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4883</span> </span><span class="WHIT">			</span><span class="NAME">nodeConfig1.accessModel</span><span class="PUNC">=</span><span class="NUMB">10</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4884</span> </span><span class="WHIT">			</span><span class="NAME">nodeConfig1.publishModel</span><span class="PUNC">=</span><span class="NUMB">10</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4885</span> </span><span class="WHIT">			</span><span class="NAME">nodeConfig1.persistItems</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4886</span> </span><span class="WHIT">			</span><span class="NAME">nodeConfig1.modifyAnyItem</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4887</span> </span><span class="WHIT">			</span><span class="NAME">nodeConfig1.userDependentItems</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4888</span> </span><span class="WHIT">			</span><span class="NAME">nodeConfig1.sessionDependentItems</span><span class="PUNC">=</span><span class="NAME">this.isClearAfterSessionRemoved</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4889</span> </span><span class="WHIT">			</span><span class="NAME">nodeConfig1.itemStorageScheme</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4890</span> </span><span class="WHIT">			</span><span class="NAME">nodeConfig1.allowPrivateMessages</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4891</span> </span><span class="WHIT">			</span><span class="NAME">nodeConfig1.lazySubscription</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4892</span> </span><span class="WHIT">			</span><span class="NAME">nodeConfig1.p2pDataMessaging</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4893</span> </span><span class="WHIT">			</span><span class="NAME">this.collectionNode.createNode</span><span class="PUNC">(</span><span class="NAME">this.TYPING_NODE_NAME</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nodeConfig1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4894</span> </span><span class="WHIT">			</span><span class="COMM">//create by publishing the default</span><span class="WHIT">
<span class='line'>4895</span> </span><span class="WHIT">			
<span class='line'>4896</span> 			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">msgItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4897</span> </span><span class="WHIT">			</span><span class="NAME">msgItem.nodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.TIMEFORMAT_NODE_NAME</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4898</span> </span><span class="WHIT">			</span><span class="NAME">msgItem.body</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.TIMEFORMAT_AM_PM</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4899</span> </span><span class="WHIT">			</span><span class="NAME">this.collectionNode.publishItem</span><span class="PUNC">(</span><span class="NAME">msgItem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4900</span> </span><span class="WHIT">			
<span class='line'>4901</span> 			</span><span class="COMM">//create by publishing the default</span><span class="WHIT">
<span class='line'>4902</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">msgItem1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4903</span> </span><span class="WHIT">			</span><span class="NAME">msgItem1.nodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.USE_TIMESTAMPS_NODE_NAME</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4904</span> </span><span class="WHIT">			</span><span class="NAME">msgItem1.body</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4905</span> </span><span class="WHIT">			</span><span class="NAME">this.collectionNode.publishItem</span><span class="PUNC">(</span><span class="NAME">msgItem1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4906</span> </span><span class="WHIT">			</span><span class="NAME">this.userManager</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.connectSession.userManager</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4907</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4908</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4909</span> </span><span class="WHIT">	</span><span class="NAME">p_event.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_event.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4910</span> </span><span class="WHIT">	</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">p_event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4911</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4912</span> 
<span class='line'>4913</span> </span><span class="COMM">/**
<span class='line'>4914</span>  *@private
<span class='line'>4915</span>  */</span><span class="WHIT">
<span class='line'>4916</span> </span><span class="NAME">SimpleChatModel.prototype.itemReceive</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_event</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4917</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4918</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">item</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_event.item</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4919</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.userManager</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4920</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tmpUsrDesc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4921</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">item.publisherID</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4922</span> </span><span class="WHIT">			</span><span class="NAME">tmpUsrDesc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.userManager.getUserDescriptor</span><span class="PUNC">(</span><span class="NAME">item.publisherID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4923</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4924</span> </span><span class="WHIT">			</span><span class="NAME">tmpUsrDesc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.userManager.getUserDescriptor</span><span class="PUNC">(</span><span class="NAME">item.itemID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4925</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4926</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4927</span> </span><span class="WHIT">	
<span class='line'>4928</span> 	</span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">item.nodeName</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4929</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4930</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">this.HISTORY_NODE_PARTICIPANTS</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4931</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">this.HISTORY_NODE_HOSTS</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4932</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">this.HISTORY_NODE_EVERYONE</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4933</span> </span><span class="WHIT">			</span><span class="COMM">//add it to the history</span><span class="WHIT">
<span class='line'>4934</span> </span><span class="WHIT">			
<span class='line'>4935</span> 			
<span class='line'>4936</span> 			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">msgDesc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4937</span> </span><span class="WHIT">			</span><span class="NAME">msgDesc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">item.body</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4938</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.messagesSeen</span><span class="PUNC">[</span><span class="NAME">item.itemID</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4939</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4940</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4941</span> </span><span class="WHIT">			</span><span class="NAME">this.messagesSeen</span><span class="PUNC">[</span><span class="NAME">item.itemID</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4942</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">item.recipientID</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4943</span> </span><span class="WHIT">				</span><span class="NAME">msgDesc.recipient</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">item.recipientID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4944</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4945</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">item.nodeName</span><span class="PUNC">==</span><span class="NAME">this.HISTORY_NODE_HOSTS</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4946</span> </span><span class="WHIT">				</span><span class="NAME">msgDesc.role</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4947</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">item.nodeName</span><span class="PUNC">==</span><span class="NAME">this.HISTORY_NODE_PARTICIPANTS</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4948</span> </span><span class="WHIT">				</span><span class="NAME">msgDesc.role</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">50</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4949</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4950</span> </span><span class="WHIT">			</span><span class="NAME">msgDesc.timeStamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">item.timeStamp</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4951</span> </span><span class="WHIT">			</span><span class="NAME">msgDesc.publisherID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">item.publisherID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4952</span> </span><span class="WHIT">			</span><span class="NAME">this.addMsgToHistory</span><span class="PUNC">(</span><span class="NAME">msgDesc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				
<span class='line'>4953</span> 			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4954</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">this.TYPING_NODE_NAME</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4955</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.contains</span><span class="PUNC">(</span><span class="NAME">this.addMsgToHistory</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">item.itemID</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4956</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">item.itemID</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4957</span> </span><span class="WHIT">					</span><span class="NAME">this.usersTyping.push</span><span class="PUNC">(</span><span class="NAME">item.itemID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4958</span> </span><span class="WHIT">					</span><span class="COMM">//we got our own item back, start the timer</span><span class="WHIT">
<span class='line'>4959</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.typingTimer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4960</span> </span><span class="WHIT">						</span><span class="NAME">clearTimeout</span><span class="PUNC">(</span><span class="NAME">this.typingTimer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4961</span> </span><span class="WHIT">						</span><span class="NAME">this.typingTimer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">bindUsingClosure</span><span class="PUNC">(</span><span class="NAME">this.onTimerComplete</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2000</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4962</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4963</span> </span><span class="WHIT">					</span><span class="NAME">p_evt.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4964</span> </span><span class="WHIT">					</span><span class="NAME">p_evt.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"typingListUpdate"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4965</span> </span><span class="WHIT">					</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4966</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.userManager.getUserDescriptor</span><span class="PUNC">(</span><span class="NAME">item.itemID</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4967</span> </span><span class="WHIT">					</span><span class="NAME">this.usersTyping.push</span><span class="PUNC">(</span><span class="NAME">item.itemID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4968</span> </span><span class="WHIT">					</span><span class="NAME">p_evt.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4969</span> </span><span class="WHIT">					</span><span class="NAME">p_evt.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"typingListUpdate"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4970</span> </span><span class="WHIT">					</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4971</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4972</span> </span><span class="WHIT">					</span><span class="NAME">this.userWithoutUserDescriptorTyping.push</span><span class="PUNC">(</span><span class="NAME">item.itemID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4973</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4974</span> </span><span class="WHIT">				
<span class='line'>4975</span> 			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4976</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4977</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">this.TIMEFORMAT_NODE_NAME</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4978</span> </span><span class="WHIT">			</span><span class="NAME">this.timeFormat</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">item.body</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4979</span> </span><span class="WHIT">			</span><span class="NAME">p_evt.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4980</span> </span><span class="WHIT">			</span><span class="NAME">p_evt.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"timeFormatChange"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4981</span> </span><span class="WHIT">			</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4982</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4983</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">this.USE_TIMESTAMPS_NODE_NAME</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4984</span> </span><span class="WHIT">			</span><span class="NAME">this.useTimeStamps</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">item.body</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4985</span> </span><span class="WHIT">			</span><span class="NAME">p_evt.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4986</span> </span><span class="WHIT">			</span><span class="NAME">p_evt.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"useTimeStampsChange"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4987</span> </span><span class="WHIT">			</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ChatEvent</span><span class="PUNC">(</span><span class="NAME">ChatEvent.USE_TIME_STAMPS_CHANGE</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4988</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4989</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4990</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4991</span> 
<span class='line'>4992</span> </span><span class="COMM">/**
<span class='line'>4993</span>  *@private
<span class='line'>4994</span>  */</span><span class="WHIT">
<span class='line'>4995</span> </span><span class="NAME">SimpleChatModel.prototype.userCreate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4996</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4997</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.contains</span><span class="PUNC">(</span><span class="NAME">this.userWithoutUserDescriptorTyping</span><span class="PUNC">,</span><span class="NAME">p_evt.userDescriptor.userID</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4998</span> </span><span class="WHIT">		</span><span class="NAME">this.usersTyping.push</span><span class="PUNC">(</span><span class="NAME">p_evt.userDescriptor.userID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4999</span> </span><span class="WHIT">		</span><span class="NAME">p_evt.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5000</span> </span><span class="WHIT">		</span><span class="NAME">p_evt.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"typingListUpdate"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5001</span> </span><span class="WHIT">		</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5002</span> </span><span class="WHIT">		</span><span class="NAME">this.removeItem</span><span class="PUNC">(</span><span class="NAME">this.userWithoutUserDescriptorTyping</span><span class="PUNC">,</span><span class="NAME">p_evt.userDescriptor.userID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5003</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5004</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5005</span> 
<span class='line'>5006</span> </span><span class="COMM">/**
<span class='line'>5007</span>  *@private
<span class='line'>5008</span>  */</span><span class="WHIT">
<span class='line'>5009</span> </span><span class="NAME">SimpleChatModel.prototype.getNameColor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_msgDesc</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5010</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5011</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_msgDesc.recipient</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5012</span> </span><span class="WHIT">		</span><span class="COMM">// it was a message I sent privately to another</span><span class="WHIT">
<span class='line'>5013</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.COLOR_PRIVATE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5014</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_msgDesc.role</span><span class="PUNC">></span><span class="NAME">UserRoles.VIEWER</span><span class="PUNC">)</span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5015</span> </span><span class="WHIT">		</span><span class="COMM">// it was a message sent to a role group, and I can see it (either because I sent it or am in the group)</span><span class="WHIT">
<span class='line'>5016</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.COLOR_HOSTS</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5017</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5018</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.nameColor</span><span class="PUNC">+</span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5019</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5020</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5021</span> 
<span class='line'>5022</span> </span><span class="COMM">/**
<span class='line'>5023</span>  *@private
<span class='line'>5024</span>  */</span><span class="WHIT">
<span class='line'>5025</span> </span><span class="NAME">SimpleChatModel.prototype.getMsgColor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_msgDesc</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5026</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5027</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_msgDesc.recipient</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5028</span> </span><span class="WHIT">		</span><span class="COMM">// it was a message I sent privately to another</span><span class="WHIT">
<span class='line'>5029</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.COLOR_PRIVATE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5030</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_msgDesc.role</span><span class="PUNC">></span><span class="NUMB">10</span><span class="PUNC">)</span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5031</span> </span><span class="WHIT">		</span><span class="COMM">// it was a message sent to a role group, and I can see it (either because I sent it or am in the group)</span><span class="WHIT">
<span class='line'>5032</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.COLOR_HOSTS</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5033</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5034</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_msgDesc.color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5035</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">p_msgDesc.color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5036</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5037</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5038</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.COLOR_HOSTS</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5039</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5040</span> 
<span class='line'>5041</span> </span><span class="COMM">/**
<span class='line'>5042</span>  *@private
<span class='line'>5043</span>  */</span><span class="WHIT">
<span class='line'>5044</span> </span><span class="NAME">SimpleChatModel.prototype.getHistoryFontSize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5045</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5046</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.historyFontSize</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5047</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5048</span> 
<span class='line'>5049</span> </span><span class="COMM">/**
<span class='line'>5050</span>  *@private
<span class='line'>5051</span>  */</span><span class="WHIT">
<span class='line'>5052</span> </span><span class="NAME">SimpleChatModel.prototype.setHistoryFontSize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_size</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5053</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5054</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.historyFontSize</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">p_size</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5055</span> </span><span class="WHIT">		</span><span class="NAME">this.historyFontSize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_size</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5056</span> </span><span class="WHIT">		</span><span class="COMM">//EXPENSIVE!</span><span class="WHIT">
<span class='line'>5057</span> </span><span class="WHIT">		</span><span class="NAME">this.history</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.history.replace</span><span class="PUNC">(</span><span class="REGX">/size=\".*?\"/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"size=\""</span><span class="PUNC">+</span><span class="NAME">this.historyFontSize</span><span class="PUNC">+</span><span class="STRN">"\""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5058</span> </span><span class="WHIT">		</span><span class="NAME">p_evt.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5059</span> </span><span class="WHIT">		</span><span class="NAME">p_evt.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"historyChange"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5060</span> </span><span class="WHIT">		</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5061</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5062</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5063</span> 
<span class='line'>5064</span> </span><span class="COMM">/**
<span class='line'>5065</span>  *@private
<span class='line'>5066</span>  */</span><span class="WHIT">
<span class='line'>5067</span> </span><span class="NAME">SimpleChatModel.prototype.getTimeStampColor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_msgDesc</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5068</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5069</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_msgDesc.recipient</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5070</span> </span><span class="WHIT">		</span><span class="COMM">// it was a message I sent privately to another</span><span class="WHIT">
<span class='line'>5071</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.COLOR_PRIVATE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5072</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_msgDesc.role</span><span class="PUNC">></span><span class="NAME">UserRoles.VIEWER</span><span class="PUNC">)</span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5073</span> </span><span class="WHIT">		</span><span class="COMM">// it was a message sent to a role group, and I can see it (either because I sent it or am in the group)</span><span class="WHIT">
<span class='line'>5074</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.COLOR_HOSTS</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5075</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5076</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.timeStampColor</span><span class="PUNC">+</span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5077</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5078</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5079</span> 
<span class='line'>5080</span> </span><span class="COMM">/**
<span class='line'>5081</span>  * Formats a given MessageDescriptor into a readable string
<span class='line'>5082</span>  * @param p_msgDesc the desired ChatMessageDescriptor to format
<span class='line'>5083</span>  * @function
<span class='line'>5084</span>  */</span><span class="WHIT">
<span class='line'>5085</span> </span><span class="NAME">SimpleChatModel.prototype.formatMessageDescriptor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_msgDesc</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5086</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5087</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">timeStampStr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5088</span> </span><span class="WHIT">	
<span class='line'>5089</span> 	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nameColor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getNameColor</span><span class="PUNC">(</span><span class="NAME">p_msgDesc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5090</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">msgColor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getMsgColor</span><span class="PUNC">(</span><span class="NAME">p_msgDesc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5091</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tStampColor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getTimeStampColor</span><span class="PUNC">(</span><span class="NAME">p_msgDesc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			
<span class='line'>5092</span> 	
<span class='line'>5093</span> 	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">privateModifier</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5094</span> </span><span class="WHIT">	
<span class='line'>5095</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_msgDesc.publisherID</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">this.userManager.myUserID</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">p_msgDesc.recipient</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5096</span> </span><span class="WHIT">		</span><span class="COMM">// it was a message I sent privately to another</span><span class="WHIT">
<span class='line'>5097</span> </span><span class="WHIT">		</span><span class="NAME">privateModifier</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">" (to"</span><span class="PUNC">+</span><span class="STRN">" "</span><span class="PUNC">+</span><span class="NAME">p_msgDesc.recipientDisplayName</span><span class="PUNC">+</span><span class="STRN">")"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5098</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_msgDesc.role</span><span class="PUNC">></span><span class="NAME">UserRoles.VIEWER</span><span class="PUNC">)</span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5099</span> </span><span class="WHIT">		</span><span class="COMM">// it was a message sent to a role group, and I can see it (either because I sent it or am in the group)</span><span class="WHIT">
<span class='line'>5100</span> </span><span class="WHIT">		</span><span class="NAME">privateModifier</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">" (to"</span><span class="PUNC">+</span><span class="STRN">" "</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">p_msgDesc.role</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">UserRoles.OWNER</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"hosts"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"participants"</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">")"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5101</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_msgDesc.recipient</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5102</span> </span><span class="WHIT">		</span><span class="COMM">// it was a message sent privately to me</span><span class="WHIT">
<span class='line'>5103</span> </span><span class="WHIT">		</span><span class="NAME">privateModifier</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">" ("</span><span class="PUNC">+</span><span class="STRN">"privately"</span><span class="PUNC">+</span><span class="STRN">")"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5104</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5105</span> </span><span class="WHIT">	
<span class='line'>5106</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.useTimeStamps</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">p_msgDesc.timeStamp</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5107</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="NAME">p_msgDesc.timeStamp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5108</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">hourMinutes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5109</span> </span><span class="WHIT">		</span><span class="NAME">hourMinutes.push</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d.getHours</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5110</span> </span><span class="WHIT">		</span><span class="NAME">hourMinutes.push</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d.getMinutes</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5111</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">hourMinutes</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">	</span><span class="COMM">//pad minutes if needed</span><span class="WHIT">
<span class='line'>5112</span> </span><span class="WHIT">			</span><span class="NAME">hourMinutes</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"0"</span><span class="PUNC">+</span><span class="NAME">hourMinutes</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5113</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5114</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.timeFormat</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">this.TIMEFORMAT_AM_PM</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5115</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">timeTemplate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"%12%:%M% %D%"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5116</span> </span><span class="WHIT">			</span><span class="NAME">timeTemplate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">timeTemplate.replace</span><span class="PUNC">(</span><span class="STRN">"%M%"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hourMinutes</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5117</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">hourMinutes</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5118</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">12</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5119</span> </span><span class="WHIT">				</span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">12</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5120</span> </span><span class="WHIT">				</span><span class="NAME">timeTemplate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">timeTemplate.replace</span><span class="PUNC">(</span><span class="STRN">"%D%"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"pm"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5121</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5122</span> </span><span class="WHIT">				</span><span class="NAME">timeTemplate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">timeTemplate.replace</span><span class="PUNC">(</span><span class="STRN">"%D%"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"am"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5123</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5124</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5125</span> </span><span class="WHIT">				</span><span class="NAME">timeStampStr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">timeTemplate.replace</span><span class="PUNC">(</span><span class="STRN">"%12%"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"12"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5126</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5127</span> </span><span class="WHIT">				</span><span class="NAME">timeStampStr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">timeTemplate.replace</span><span class="PUNC">(</span><span class="STRN">"%12%"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5128</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5129</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5130</span> </span><span class="WHIT">			</span><span class="NAME">timeStampStr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">hourMinutes</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">":"</span><span class="PUNC">+</span><span class="NAME">hourMinutes</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5131</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5132</span> </span><span class="WHIT">		</span><span class="NAME">timeStampStr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"&lt;font color=\"#"</span><span class="PUNC">+</span><span class="NAME">tStampColor</span><span class="PUNC">+</span><span class="STRN">"\">["</span><span class="PUNC">+</span><span class="NAME">timeStampStr</span><span class="PUNC">+</span><span class="STRN">"]&lt;/font> "</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5133</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5134</span> </span><span class="WHIT">	
<span class='line'>5135</span> 	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">msg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_msgDesc.msg</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5136</span> </span><span class="WHIT">	</span><span class="NAME">msg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">msg.replace</span><span class="PUNC">(</span><span class="REGX">/&lt;/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"&lt;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5137</span> </span><span class="WHIT">	</span><span class="NAME">msg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">msg.replace</span><span class="PUNC">(</span><span class="REGX">/>/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"&gt;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5138</span> </span><span class="WHIT">	
<span class='line'>5139</span> 	</span><span class="COMM">//TODO: make these colors come from a style!</span><span class="WHIT">
<span class='line'>5140</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">toAdd</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5141</span> </span><span class="WHIT">	</span><span class="NAME">toAdd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"&lt;font size=\""</span><span class="PUNC">+</span><span class="NAME">this.historyFontSize</span><span class="PUNC">+</span><span class="STRN">"\">"</span><span class="WHIT">
<span class='line'>5142</span> </span><span class="WHIT">		</span><span class="PUNC">+</span><span class="NAME">timeStampStr</span><span class="WHIT">
<span class='line'>5143</span> </span><span class="WHIT">		</span><span class="PUNC">+</span><span class="STRN">"&lt;font color=\"#"</span><span class="PUNC">+</span><span class="NAME">nameColor</span><span class="PUNC">+</span><span class="STRN">"\">&lt;b>"</span><span class="PUNC">+</span><span class="NAME">p_msgDesc.displayName</span><span class="PUNC">+</span><span class="NAME">privateModifier</span><span class="PUNC">+</span><span class="STRN">"&lt;/b>: &lt;/font>"</span><span class="WHIT">
<span class='line'>5144</span> </span><span class="WHIT">		</span><span class="PUNC">+</span><span class="STRN">"&lt;font color=\"#"</span><span class="PUNC">+</span><span class="NAME">msgColor</span><span class="PUNC">+</span><span class="STRN">"\">"</span><span class="PUNC">+</span><span class="NAME">msg</span><span class="PUNC">+</span><span class="STRN">"&lt;/font>"</span><span class="WHIT">
<span class='line'>5145</span> </span><span class="WHIT">		</span><span class="PUNC">+</span><span class="STRN">"&lt;/font>&lt;br/>"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5146</span> </span><span class="WHIT">	
<span class='line'>5147</span> 	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">toAdd</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5148</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5149</span> 
<span class='line'>5150</span> 
<span class='line'>5151</span> </span><span class="COMM">/**
<span class='line'>5152</span>  *@private
<span class='line'>5153</span>  */</span><span class="WHIT">
<span class='line'>5154</span> </span><span class="NAME">SimpleChatModel.prototype.addMsgToHistory</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_msgDesc</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5155</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5156</span> </span><span class="WHIT">	</span><span class="COMM">//var toAdd = this.formatMessageDescriptor(p_msgDesc);</span><span class="WHIT">
<span class='line'>5157</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">toAdd</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5158</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_msgDesc</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5159</span> </span><span class="WHIT">		</span><span class="COMM">//toAdd = p_msgDesc[1]+":"+p_msgDesc[2]+"\n";</span><span class="WHIT">
<span class='line'>5160</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">p_msgDesc</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5161</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5162</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">toAdd</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5163</span> </span><span class="WHIT">				</span><span class="NAME">toAdd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">toAdd</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">p_msgDesc</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5164</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5165</span> </span><span class="WHIT">				</span><span class="NAME">toAdd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_msgDesc</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5166</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5167</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5168</span> </span><span class="WHIT">		</span><span class="NAME">toAdd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">toAdd</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\n"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5169</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_msgDesc</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5170</span> </span><span class="WHIT">		</span><span class="NAME">toAdd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_msgDesc.displayName</span><span class="PUNC">+</span><span class="STRN">":"</span><span class="PUNC">+</span><span class="NAME">p_msgDesc.msg</span><span class="PUNC">+</span><span class="STRN">"\n"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5171</span> </span><span class="WHIT">		</span><span class="COMM">//toAdd = p_msgDesc["displayName"]+":"+p_msgDesc["msg"]+"\n";</span><span class="WHIT">
<span class='line'>5172</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5173</span> </span><span class="WHIT">	</span><span class="COMM">//var toAdd = p_msgDesc;</span><span class="WHIT">
<span class='line'>5174</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p_evt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5175</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.chatCleared</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5176</span> </span><span class="WHIT">		</span><span class="NAME">this.history</span><span class="PUNC">=</span><span class="NAME">toAdd</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5177</span> </span><span class="WHIT">		</span><span class="NAME">this.chatCleared</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5178</span> </span><span class="WHIT">		</span><span class="NAME">p_evt.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5179</span> </span><span class="WHIT">		</span><span class="NAME">p_evt.message</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_msgDesc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5180</span> </span><span class="WHIT">		</span><span class="NAME">p_evt.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"historyChange"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5181</span> </span><span class="WHIT">		</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5182</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5183</span> </span><span class="WHIT">		</span><span class="NAME">this.history</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">toAdd</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5184</span> </span><span class="WHIT">		</span><span class="NAME">p_evt.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5185</span> </span><span class="WHIT">		</span><span class="NAME">p_evt.message</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_msgDesc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5186</span> </span><span class="WHIT">		</span><span class="NAME">p_evt.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"historyChange"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5187</span> </span><span class="WHIT">		</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5188</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5189</span> </span><span class="WHIT">	
<span class='line'>5190</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5191</span> 
<span class='line'>5192</span> </span><span class="COMM">/**
<span class='line'>5193</span>  *@private
<span class='line'>5194</span>  */</span><span class="WHIT">
<span class='line'>5195</span> </span><span class="NAME">SimpleChatModel.prototype.itemRetract</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5196</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5197</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">item</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.item</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5198</span> </span><span class="WHIT">	
<span class='line'>5199</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">item.nodeName</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">this.TYPING_NODE_NAME</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5200</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5201</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.contains</span><span class="PUNC">(</span><span class="NAME">this.addMsgToHistory</span><span class="PUNC">,</span><span class="NAME">item.itemID</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5202</span> </span><span class="WHIT">			</span><span class="NAME">this.removeItem</span><span class="PUNC">(</span><span class="NAME">this.usersTyping</span><span class="PUNC">,</span><span class="NAME">item.itemID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5203</span> </span><span class="WHIT">			</span><span class="NAME">p_evt.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5204</span> </span><span class="WHIT">			</span><span class="NAME">p_evt.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"typingListUpdate"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5205</span> </span><span class="WHIT">			</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5206</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5207</span> </span><span class="WHIT">		
<span class='line'>5208</span> 		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.contains</span><span class="PUNC">(</span><span class="NAME">this.userWithoutUserDescriptorTyping</span><span class="PUNC">,</span><span class="NAME">item.itemID</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5209</span> </span><span class="WHIT">			</span><span class="NAME">this.removeItem</span><span class="PUNC">(</span><span class="NAME">this.userWithoutUserDescriptorTyping</span><span class="PUNC">,</span><span class="NAME">item.itemID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	
<span class='line'>5210</span> 		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5211</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5212</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5213</span> 
<span class='line'>5214</span> </span><span class="COMM">/**
<span class='line'>5215</span>  *@private
<span class='line'>5216</span>  */</span><span class="WHIT">
<span class='line'>5217</span> </span><span class="NAME">SimpleChatModel.prototype.nodeDelete</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5218</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5219</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_evt.nodeName</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">this.HISTORY_NODE_EVERYONE</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5220</span> </span><span class="WHIT">		</span><span class="NAME">this.chatCleared</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5221</span> </span><span class="WHIT">		</span><span class="NAME">this.history</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"&lt;font size=\""</span><span class="PUNC">+</span><span class="NAME">this.historyFontSize</span><span class="PUNC">+</span><span class="STRN">"\" color=\"#666666\">&lt;i>"</span><span class="PUNC">+</span><span class="STRN">"The chat history has been cleared."</span><span class="PUNC">+</span><span class="STRN">'\n'</span><span class="PUNC">+</span><span class="STRN">"&lt;/i>&lt;/font>"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5222</span> </span><span class="WHIT">		</span><span class="NAME">p_evt.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5223</span> </span><span class="WHIT">		</span><span class="NAME">p_evt.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"historyChange"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5224</span> </span><span class="WHIT">		</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5225</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5226</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5227</span> 
<span class='line'>5228</span> </span><span class="COMM">/**
<span class='line'>5229</span>  *@private
<span class='line'>5230</span>  */</span><span class="WHIT">
<span class='line'>5231</span> </span><span class="NAME">SimpleChatModel.prototype.nodeCreate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5232</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5233</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_evt.nodeName</span><span class="PUNC">==</span><span class="NAME">this.HISTORY_NODE_EVERYONE</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5234</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tmpAllow</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.getNodeConfiguration</span><span class="PUNC">(</span><span class="NAME">this.HISTORY_NODE_EVERYONE</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">allowPrivateMessages</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5235</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tmpAllow</span><span class="PUNC">!=</span><span class="NAME">this.allowPrivateChat</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5236</span> </span><span class="WHIT">			</span><span class="NAME">this.allowPrivateChat</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tmpAllow</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5237</span> </span><span class="WHIT">			</span><span class="NAME">p_evt.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5238</span> </span><span class="WHIT">			</span><span class="NAME">p_evt.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"allowPrivateChatChange"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5239</span> </span><span class="WHIT">			</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5240</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5241</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5242</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5243</span> 
<span class='line'>5244</span> </span><span class="COMM">/**
<span class='line'>5245</span>  *@private
<span class='line'>5246</span>  */</span><span class="WHIT">
<span class='line'>5247</span> </span><span class="NAME">SimpleChatModel.prototype.userRoleChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5248</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5249</span> </span><span class="WHIT">	</span><span class="NAME">p_evt.currentTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5250</span> </span><span class="WHIT">	</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5251</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5252</span> 
<span class='line'>5253</span> </span><span class="COMM">/**
<span class='line'>5254</span>  *@private
<span class='line'>5255</span>  *Contains code snippet copied from StackOverflow
<span class='line'>5256</span>  *http://stackoverflow.com/questions/237104/javascript-array-containsobj
<span class='line'>5257</span>  */</span><span class="WHIT">
<span class='line'>5258</span> </span><span class="NAME">SimpleChatModel.prototype.contains</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_array</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5259</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_array.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5260</span> </span><span class="WHIT">	</span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5261</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_array</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5262</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5263</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5264</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5265</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5266</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5267</span> 
<span class='line'>5268</span> </span><span class="COMM">/**
<span class='line'>5269</span>  *@private
<span class='line'>5270</span>  */</span><span class="WHIT">
<span class='line'>5271</span> </span><span class="NAME">SimpleChatModel.prototype.removeItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_array</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">itemToRemove</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5272</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5273</span> </span><span class="WHIT">	</span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">p_array.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5274</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_array</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">itemToRemove</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5275</span> </span><span class="WHIT">			</span><span class="NAME">p_array.splice</span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5276</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5277</span> </span><span class="WHIT">			</span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5278</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5279</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5280</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5281</span> 
<span class='line'>5282</span> 
<span class='line'>5283</span> 
<span class='line'>5284</span> </span><span class="COMM">/**
<span class='line'>5285</span>  * @class SharedCursor tracks the cursor positions of any user with role of UserRoles.PUBLISHER or higher within it and reports that position to other users.
<span class='line'>5286</span>  * It is also responsible for rendering the remote cursors corresponding to these positions.
<span class='line'>5287</span>  * &lt;table>&lt;tr>&lt;th>&lt;b>Event&lt;/b>&lt;/th>&lt;th>&lt;b>Summary&lt;/b>&lt;/th>&lt;/tr>
<span class='line'>5288</span>  * &lt;tr>&lt;td valign="top">&lt;code>synchronizationChange&lt;/code>&lt;/td> &lt;td> Dispatched when the SimpleChatModel has fully connected and synchronized with the service or when it loses that connection.&lt;/td>&lt;/tr>
<span class='line'>5289</span>  * &lt;/table>
<span class='line'>5290</span>  * @constructor
<span class='line'>5291</span>  */</span><span class="WHIT">
<span class='line'>5292</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">SharedCursorPane</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5293</span> </span><span class="WHIT">	</span><span class="NAME">this.connectSession</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ConnectSession.primarySession</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5294</span> </span><span class="WHIT">	</span><span class="NAME">this.initialize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5295</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5296</span> </span><span class="NAME">EventDispatcher.initialize</span><span class="PUNC">(</span><span class="NAME">SharedCursorPane.prototype</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5297</span> 
<span class='line'>5298</span> </span><span class="NAME">SharedCursorPane.prototype.document</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5299</span> </span><span class="COMM">/**
<span class='line'>5300</span>  * The field of UserDescriptor you want to show as label with your cursor. You can also show custom fields
<span class='line'>5301</span>  * @field
<span class='line'>5302</span>  */</span><span class="WHIT">
<span class='line'>5303</span> 
<span class='line'>5304</span> </span><span class="NAME">SharedCursorPane.prototype.label</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5305</span> </span><span class="COMM">/**
<span class='line'>5306</span>  * @private
<span class='line'>5307</span>  * @field
<span class='line'>5308</span>  */</span><span class="WHIT">
<span class='line'>5309</span> </span><span class="NAME">SharedCursorPane.prototype.divElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5310</span> 
<span class='line'>5311</span> </span><span class="COMM">/**
<span class='line'>5312</span>  * The time in milliseconds of the polling interval for cursor positions. 
<span class='line'>5313</span>  * Note that setting this to a higher number reduces 
<span class='line'>5314</span>  * network message traffic but also reduces responsiveness. Setting it to a lower 
<span class='line'>5315</span>  * number uses more bandwidth.
<span class='line'>5316</span>  */</span><span class="WHIT">
<span class='line'>5317</span> </span><span class="NAME">SharedCursorPane.prototype.pollInterval</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">500</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5318</span> </span><span class="COMM">/**
<span class='line'>5319</span>  *@private
<span class='line'>5320</span>  */</span><span class="WHIT">
<span class='line'>5321</span> </span><span class="NAME">SharedCursorPane.prototype.inactivityInterval</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2000</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5322</span> </span><span class="COMM">/**
<span class='line'>5323</span>  *@private
<span class='line'>5324</span>  */</span><span class="WHIT">
<span class='line'>5325</span> </span><span class="NAME">SharedCursorPane.prototype.shareCursorPosition</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5326</span> </span><span class="COMM">/**
<span class='line'>5327</span>  * Defines the logical location of the component on the service; typically this assigns the &lt;code>sharedID&lt;/code> of the collectionNode
<span class='line'>5328</span>  * used by the component. &lt;code>sharedIDs&lt;/code> should be unique within a room if they're expressing two 
<span class='line'>5329</span>  * unique locations. Note that this can only be assigned once before &lt;code>subscribe()&lt;/code> is called. For components 
<span class='line'>5330</span>  * with an &lt;code>id&lt;/code> property, &lt;code>sharedID&lt;/code> defaults to that value.
<span class='line'>5331</span>  */</span><span class="WHIT">
<span class='line'>5332</span> </span><span class="NAME">SharedCursorPane.prototype.sharedID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"SharedCursorsCollection"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5333</span> </span><span class="COMM">/**
<span class='line'>5334</span>  * The ConnectSession with which this component is associated; it defaults to the first 
<span class='line'>5335</span>  * IConnectSession created in the application.  Note that this may only be set once before 
<span class='line'>5336</span>  * &lt;code>subscribe()&lt;/code> is called, and re-sessioning of components is not supported.
<span class='line'>5337</span>  */</span><span class="WHIT">
<span class='line'>5338</span> </span><span class="NAME">SharedCursorPane.prototype.connectSession</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5339</span> </span><span class="COMM">/**
<span class='line'>5340</span>  * When specifying an existing CollectionNode, &lt;code>nodeName&lt;/code> specifies a 
<span class='line'>5341</span>  * &lt;code>nodeName&lt;/code>  to use within that collectionNode for
<span class='line'>5342</span>  * all message traffic. Defaults to "Shared_Cursors".
<span class='line'>5343</span>  */</span><span class="WHIT">
<span class='line'>5344</span> </span><span class="NAME">SharedCursorPane.prototype.nodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Shared_Cursors"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5345</span> </span><span class="COMM">/**
<span class='line'>5346</span>  *@private
<span class='line'>5347</span>  */</span><span class="WHIT">
<span class='line'>5348</span> </span><span class="NAME">SharedCursorPane.prototype.wasPublisher</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5349</span> </span><span class="COMM">/**
<span class='line'>5350</span>  * Property for sharing mode. There are two modes of sharing, &lt;b>absolute&lt;/b> and  &lt;b>relative&lt;/b>.
<span class='line'>5351</span>  * In &lt;b>absolute&lt;/b> mode you get the exact position of the cursor of the sharing user.
<span class='line'>5352</span>  * In &lt;b>relative&lt;/b> you get the relative position with respect to the size of your own cursor pane.
<span class='line'>5353</span>  * Default mode is &lt;b>absolute&lt;/b>.
<span class='line'>5354</span>  */</span><span class="WHIT">
<span class='line'>5355</span> </span><span class="NAME">SharedCursorPane.prototype.sizingMode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"absolute"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5356</span> </span><span class="COMM">/**
<span class='line'>5357</span>  *@private
<span class='line'>5358</span>  */</span><span class="WHIT">
<span class='line'>5359</span> </span><span class="NAME">SharedCursorPane.prototype.cursorsByID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5360</span> </span><span class="COMM">/**
<span class='line'>5361</span>  *@private
<span class='line'>5362</span>  */</span><span class="WHIT">
<span class='line'>5363</span> </span><span class="NAME">SharedCursorPane.prototype.inactivityTimer</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5364</span> </span><span class="COMM">/**
<span class='line'>5365</span>  *@private
<span class='line'>5366</span>  */</span><span class="WHIT">
<span class='line'>5367</span> </span><span class="NAME">SharedCursorPane.prototype.lastMouseX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5368</span> </span><span class="COMM">/**
<span class='line'>5369</span>  *@private
<span class='line'>5370</span>  */</span><span class="WHIT">
<span class='line'>5371</span> </span><span class="NAME">SharedCursorPane.prototype.lastMouseY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5372</span> </span><span class="COMM">/**
<span class='line'>5373</span>  *@private
<span class='line'>5374</span>  */</span><span class="WHIT">
<span class='line'>5375</span> </span><span class="NAME">SharedCursorPane.prototype.pointTimer</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5376</span> </span><span class="COMM">/**
<span class='line'>5377</span>  *@private
<span class='line'>5378</span>  */</span><span class="WHIT">
<span class='line'>5379</span> </span><span class="NAME">SharedCursorPane.prototype.hasRetracted</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5380</span> </span><span class="COMM">/**
<span class='line'>5381</span>  *@private
<span class='line'>5382</span>  */</span><span class="WHIT">
<span class='line'>5383</span> </span><span class="NAME">SharedCursorPane.prototype.mouseX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5384</span> </span><span class="COMM">/**
<span class='line'>5385</span>  *@private
<span class='line'>5386</span>  */</span><span class="WHIT">
<span class='line'>5387</span> </span><span class="NAME">SharedCursorPane.prototype.mouseY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5388</span> </span><span class="COMM">/**
<span class='line'>5389</span>  *Number that specifies the component's horizontal position, in pixels, within its parent container.
<span class='line'>5390</span>  *@field
<span class='line'>5391</span>  */</span><span class="WHIT">
<span class='line'>5392</span> </span><span class="NAME">SharedCursorPane.prototype.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5393</span> </span><span class="COMM">/**
<span class='line'>5394</span>  *Number that specifies the component's vertical position, in pixels, within its parent container.
<span class='line'>5395</span>  *@field
<span class='line'>5396</span>  */</span><span class="WHIT">
<span class='line'>5397</span> </span><span class="NAME">SharedCursorPane.prototype.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5398</span> </span><span class="COMM">/**
<span class='line'>5399</span>  *Number that specifies the width of the component, in pixels, in the parent's coordinates.
<span class='line'>5400</span>  *@field
<span class='line'>5401</span>  */</span><span class="WHIT">
<span class='line'>5402</span> </span><span class="NAME">SharedCursorPane.prototype.width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5403</span> </span><span class="COMM">/**
<span class='line'>5404</span>  *Number that specifies the height of the component, in pixels, in the parent's coordinates.
<span class='line'>5405</span>  *@field
<span class='line'>5406</span>  */</span><span class="WHIT">
<span class='line'>5407</span> </span><span class="NAME">SharedCursorPane.prototype.height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5408</span> </span><span class="COMM">/**
<span class='line'>5409</span>  *Specify your custom image src for the cursor
<span class='line'>5410</span>  *@field
<span class='line'>5411</span>  */</span><span class="WHIT">
<span class='line'>5412</span> </span><span class="NAME">SharedCursorPane.prototype.cursorImgSrc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'cursor.png'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5413</span> </span><span class="COMM">/**
<span class='line'>5414</span>  *Specify your custom css class for the cursors font
<span class='line'>5415</span>  *@field
<span class='line'>5416</span>  */</span><span class="WHIT">
<span class='line'>5417</span> </span><span class="NAME">SharedCursorPane.prototype.cursorClass</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5418</span> 
<span class='line'>5419</span> </span><span class="COMM">/**
<span class='line'>5420</span>  *Initialized the shared Cursor by passing the document. The document model is used to manipulate the mouse positions.
<span class='line'>5421</span>  * @function
<span class='line'>5422</span>  */</span><span class="WHIT">
<span class='line'>5423</span> </span><span class="NAME">SharedCursorPane.prototype.initialize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5424</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5425</span> </span><span class="WHIT">	</span><span class="NAME">document.body.cursorTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5426</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.width</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5427</span> </span><span class="WHIT">		</span><span class="NAME">this.width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.documentElement.clientWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5428</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5429</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.height</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5430</span> </span><span class="WHIT">		</span><span class="NAME">this.height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.documentElement.clientHeight</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5431</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5432</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5433</span> 
<span class='line'>5434</span> </span><span class="COMM">/**
<span class='line'>5435</span>  * Tells the component to begin synchronizing with the service. 
<span class='line'>5436</span>  * @function
<span class='line'>5437</span>  */</span><span class="WHIT">
<span class='line'>5438</span> </span><span class="NAME">SharedCursorPane.prototype.subscribe</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5439</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5440</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.collectionNode</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5441</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">CollectionNode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5442</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.sharedID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.sharedID</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5443</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.connectSession</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.connectSession</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5444</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.addEventListener</span><span class="PUNC">(</span><span class="STRN">"synchronizationChange"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5445</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.subscribe</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5446</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5447</span> </span><span class="WHIT">	
<span class='line'>5448</span> 	</span><span class="NAME">this.userManager</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.connectSession.userManager</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5449</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5450</span> 
<span class='line'>5451</span> </span><span class="COMM">/**
<span class='line'>5452</span>  * @private
<span class='line'>5453</span>  */</span><span class="WHIT">
<span class='line'>5454</span> </span><span class="NAME">SharedCursorPane.prototype.synchronizationChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5455</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5456</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.collectionNode.isSynchronized</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5457</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.addEventListener</span><span class="PUNC">(</span><span class="STRN">"myRoleChange"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5458</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.addEventListener</span><span class="PUNC">(</span><span class="STRN">"itemReceive"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5459</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.addEventListener</span><span class="PUNC">(</span><span class="STRN">"itemRetract"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5460</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.collectionNode.isNodeDefined</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.canUserConfigure</span><span class="PUNC">(</span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5461</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodeConfig</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5462</span> </span><span class="WHIT">			</span><span class="NAME">nodeConfig.userDependentItems</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5463</span> </span><span class="WHIT">			</span><span class="NAME">nodeConfig.modifyAnyItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5464</span> </span><span class="WHIT">			</span><span class="NAME">nodeConfig.itemStorageScheme</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5465</span> </span><span class="WHIT">			</span><span class="NAME">nodeConfig.accessModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5466</span> </span><span class="WHIT">			</span><span class="NAME">nodeConfig.publishModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">50</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5467</span> </span><span class="WHIT">			</span><span class="NAME">this.collectionNode.addEventListener</span><span class="PUNC">(</span><span class="STRN">"nodeCreate"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5468</span> </span><span class="WHIT">			</span><span class="NAME">this.collectionNode.createNode</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nodeConfig</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5469</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5470</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.collectionNode.isNodeDefined</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5471</span> </span><span class="WHIT">				</span><span class="NAME">this.collectionNode.addEventListener</span><span class="PUNC">(</span><span class="STRN">"nodeCreate"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5472</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.collectionNode.canUserPublish</span><span class="PUNC">(</span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5473</span> </span><span class="WHIT">				</span><span class="NAME">this.wasPublisher</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5474</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">document.body.onmousemove</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5475</span> </span><span class="WHIT">					</span><span class="NAME">document.body.onmousemove</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.onMouseMove</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5476</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5477</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5478</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5479</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.userMgr</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5480</span> </span><span class="WHIT">			</span><span class="NAME">this.userMgr.addEventListener</span><span class="PUNC">(</span><span class="STRN">"userCreate"</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5481</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5482</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5483</span> </span><span class="WHIT">		</span><span class="NAME">this.removeMyEventListeners</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5484</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5485</span> </span><span class="WHIT">	</span><span class="NAME">this.dispatchEvent</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5486</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5487</span> 
<span class='line'>5488</span> </span><span class="COMM">/**
<span class='line'>5489</span>  * @private
<span class='line'>5490</span>  */</span><span class="WHIT">
<span class='line'>5491</span> </span><span class="NAME">SharedCursorPane.prototype.myRoleChange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5492</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5493</span> </span><span class="WHIT">	</span><span class="COMM">// disable / enable </span><span class="WHIT">
<span class='line'>5494</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.wasPublisher</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">this.collectionNode.canUserPublish</span><span class="PUNC">(</span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5495</span> </span><span class="WHIT">		</span><span class="NAME">this.removeMyEventListeners</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5496</span> </span><span class="WHIT">		</span><span class="NAME">this.wasPublisher</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5497</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.wasPublisher</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.canUserPublish</span><span class="PUNC">(</span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5498</span> </span><span class="WHIT">		</span><span class="NAME">this.pointTimer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="NAME">bindUsingClosure</span><span class="PUNC">(</span><span class="NAME">this.sendMyCursor</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.pollInterval</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5499</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">document.body.onmousemove</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5500</span> </span><span class="WHIT">			</span><span class="NAME">document.body.onmousemove</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.onMouseMove</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5501</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5502</span> </span><span class="WHIT">		</span><span class="NAME">this.wasPublisher</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5503</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5504</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5505</span> 
<span class='line'>5506</span> </span><span class="COMM">/**
<span class='line'>5507</span>  * @private
<span class='line'>5508</span>  */</span><span class="WHIT">
<span class='line'>5509</span> </span><span class="NAME">SharedCursorPane.prototype.itemReceive</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5510</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5511</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_evt.nodeName</span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5512</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_evt.item.publisherID</span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5513</span> </span><span class="WHIT">			</span><span class="COMM">// we ignore our own cursor</span><span class="WHIT">
<span class='line'>5514</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">body</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.item.body</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5515</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">screenX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5516</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">screenY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5517</span> </span><span class="WHIT">			
<span class='line'>5518</span> 			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">locWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5519</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">locHeight</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5520</span> </span><span class="WHIT">			</span><span class="COMM">//console.log(document.documentElement.clientWidth + " " + document.documentElement.clientHeight);</span><span class="WHIT">
<span class='line'>5521</span> </span><span class="WHIT">			
<span class='line'>5522</span> 			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">window.innerWidth</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'number'</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5523</span> </span><span class="WHIT">			    </span><span class="COMM">//Non-IE</span><span class="WHIT">
<span class='line'>5524</span> </span><span class="WHIT">				</span><span class="NAME">locWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">window.innerWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5525</span> </span><span class="WHIT">				</span><span class="NAME">locHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">window.innerHeight</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5526</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">document.documentElement</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">document.documentElement.clientWidth</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">document.documentElement.clientHeight</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5527</span> </span><span class="WHIT">			    </span><span class="COMM">//IE 6+ in 'standards compliant mode'</span><span class="WHIT">
<span class='line'>5528</span> </span><span class="WHIT">				  </span><span class="NAME">locWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.documentElement.clientWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5529</span> </span><span class="WHIT">				  </span><span class="NAME">locHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.documentElement.clientHeight</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5530</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">document.body</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">document.body.clientWidth</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">document.body.clientHeight</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5531</span> </span><span class="WHIT">			    </span><span class="COMM">//IE 4 compatible</span><span class="WHIT">
<span class='line'>5532</span> </span><span class="WHIT">				  </span><span class="NAME">locWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.body.clientWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5533</span> </span><span class="WHIT">				  </span><span class="NAME">locHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.body.clientHeight</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5534</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5535</span> </span><span class="WHIT">			
<span class='line'>5536</span> 			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.sizingMode</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"relative"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5537</span> </span><span class="WHIT">				</span><span class="NAME">screenX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">body.x</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">locWidth</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5538</span> </span><span class="WHIT">				</span><span class="NAME">screenY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">body.y</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">locHeight</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5539</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.sizingMode</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"absolute"</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5540</span> </span><span class="WHIT">				</span><span class="NAME">screenX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">body.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5541</span> </span><span class="WHIT">				</span><span class="NAME">screenY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">body.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5542</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5543</span> </span><span class="WHIT">			</span><span class="COMM">//			this.document.body.ownerDocument.getElementById("msgArea").value = " " + screenX + " " + screenY;</span><span class="WHIT">
<span class='line'>5544</span> </span><span class="WHIT">			</span><span class="COMM">//console.log("set w innerwidth " + body.x*(locWidth));</span><span class="WHIT">
<span class='line'>5545</span> </span><span class="WHIT">			</span><span class="COMM">//console.log("set w docEle.clientwidth " + body.x*(document.documentElement.clientWidth));</span><span class="WHIT">
<span class='line'>5546</span> </span><span class="WHIT">			</span><span class="COMM">//console.log("set w body.clientwidht " + body.x*(document.body.clientWidth));</span><span class="WHIT">
<span class='line'>5547</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.cursorsByID</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.cursorsByID</span><span class="PUNC">[</span><span class="NAME">p_evt.item.publisherID</span><span class="PUNC">]</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5548</span> </span><span class="WHIT">				</span><span class="COMM">//var tmp = document;</span><span class="WHIT">
<span class='line'>5549</span> </span><span class="WHIT">				</span><span class="COMM">//console.log("Recieved " +  body.x + " " + body.y +" setting " + screenX + " " +  screenY + " w&h " + locWidth + " " + locHeight);</span><span class="WHIT">
<span class='line'>5550</span> </span><span class="WHIT">				</span><span class="NAME">this.moveCursorTo</span><span class="PUNC">(</span><span class="NAME">p_evt.item.publisherID</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">screenX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">screenY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5551</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5552</span> </span><span class="WHIT">				</span><span class="NAME">this.addNewCursor</span><span class="PUNC">(</span><span class="NAME">p_evt.item.publisherID</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">screenX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">screenY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5553</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5554</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5555</span> </span><span class="WHIT">			</span><span class="NAME">this.cursorsByID</span><span class="PUNC">[</span><span class="NAME">p_evt.item.publisherID</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5556</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5557</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">	
<span class='line'>5558</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5559</span> 
<span class='line'>5560</span> </span><span class="COMM">/**
<span class='line'>5561</span>  * @private
<span class='line'>5562</span>  */</span><span class="WHIT">
<span class='line'>5563</span> </span><span class="NAME">SharedCursorPane.prototype.itemRetract</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5564</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5565</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_evt.nodeName</span><span class="PUNC">==</span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5566</span> </span><span class="WHIT">		</span><span class="NAME">this.removeCursor</span><span class="PUNC">(</span><span class="NAME">p_evt.item.publisherID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5567</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5568</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5569</span> 
<span class='line'>5570</span> </span><span class="COMM">/**
<span class='line'>5571</span>  * @private
<span class='line'>5572</span>  */</span><span class="WHIT">
<span class='line'>5573</span> </span><span class="NAME">SharedCursorPane.prototype.sendMyCursor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5574</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5575</span> </span><span class="WHIT">	</span><span class="NAME">this.sendCursorWrapper</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5576</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5577</span> 
<span class='line'>5578</span> </span><span class="COMM">/**
<span class='line'>5579</span>  * @private
<span class='line'>5580</span>  */</span><span class="WHIT">
<span class='line'>5581</span> </span><span class="NAME">SharedCursorPane.prototype.sendCursorWrapper</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5582</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5583</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">this</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.mouseX</span><span class="PUNC">==</span><span class="NAME">this.lastMouseX</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.mouseY</span><span class="PUNC">==</span><span class="NAME">this.lastMouseY</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5584</span> </span><span class="WHIT">		</span><span class="NAME">this.inactivityTimer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="NAME">bindUsingClosure</span><span class="PUNC">(</span><span class="NAME">this.onInactivity</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.inactivityInterval</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5585</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">document.body.onmousemove</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5586</span> </span><span class="WHIT">			</span><span class="NAME">document.body.onmousemove</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.onMouseMove</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5587</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5588</span> </span><span class="WHIT">		</span><span class="NAME">clearTimeout</span><span class="PUNC">(</span><span class="NAME">this.pointTimer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5589</span> </span><span class="WHIT">		</span><span class="NAME">this.pointTimer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5590</span> </span><span class="WHIT">		
<span class='line'>5591</span> 	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5592</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">item</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5593</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.sizingMode</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"relative"</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5594</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">locWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5595</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">locHeight</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5596</span> </span><span class="WHIT">			</span><span class="COMM">//console.log(document.documentElement.clientWidth + " " + document.documentElement.clientHeight);</span><span class="WHIT">
<span class='line'>5597</span> </span><span class="WHIT">			
<span class='line'>5598</span> 			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">window.innerWidth</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'number'</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5599</span> </span><span class="WHIT">			    </span><span class="COMM">//Non-IE</span><span class="WHIT">
<span class='line'>5600</span> </span><span class="WHIT">				</span><span class="NAME">locWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">window.innerWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5601</span> </span><span class="WHIT">				</span><span class="NAME">locHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">window.innerHeight</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5602</span> </span><span class="WHIT">			  </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">document.documentElement</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">document.documentElement.clientWidth</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">document.documentElement.clientHeight</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5603</span> </span><span class="WHIT">			    </span><span class="COMM">//IE 6+ in 'standards compliant mode'</span><span class="WHIT">
<span class='line'>5604</span> </span><span class="WHIT">				  </span><span class="NAME">locWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.documentElement.clientWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5605</span> </span><span class="WHIT">				  </span><span class="NAME">locHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.documentElement.clientHeight</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5606</span> </span><span class="WHIT">			  </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">document.body</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">document.body.clientWidth</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">document.body.clientHeight</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5607</span> </span><span class="WHIT">			    </span><span class="COMM">//IE 4 compatible</span><span class="WHIT">
<span class='line'>5608</span> </span><span class="WHIT">				  </span><span class="NAME">locWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.body.clientWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5609</span> </span><span class="WHIT">				  </span><span class="NAME">locHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.body.clientHeight</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5610</span> </span><span class="WHIT">			  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5611</span> 
<span class='line'>5612</span> </span><span class="WHIT">			
<span class='line'>5613</span> 			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">relativeX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.mouseX</span><span class="PUNC">/</span><span class="NAME">locWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5614</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">relativeY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.mouseY</span><span class="PUNC">/</span><span class="NAME">locHeight</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5615</span> </span><span class="WHIT">			</span><span class="NAME">item.nodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.nodeName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5616</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bodyObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5617</span> </span><span class="WHIT">			</span><span class="NAME">bodyObject.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">relativeX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5618</span> </span><span class="WHIT">			</span><span class="NAME">bodyObject.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">relativeY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5619</span> </span><span class="WHIT">			</span><span class="NAME">item.body</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bodyObject</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5620</span> </span><span class="WHIT">			</span><span class="NAME">item.itemID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5621</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tmp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5622</span> </span><span class="WHIT">			</span><span class="COMM">//console.log("Sending x & y as " + relativeX +" " +relativeY +" and the actual x & y " +this.mouseX + " " + this.mouseY + " w&h " + locWidth + " " + locHeight);</span><span class="WHIT">
<span class='line'>5623</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.sizingMode</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"absolute"</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5624</span> </span><span class="WHIT">			</span><span class="NAME">item.nodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.nodeName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5625</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bodyObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5626</span> </span><span class="WHIT">			</span><span class="NAME">bodyObject.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.mouseX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5627</span> </span><span class="WHIT">			</span><span class="NAME">bodyObject.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.mouseY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5628</span> </span><span class="WHIT">			</span><span class="NAME">item.body</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bodyObject</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5629</span> </span><span class="WHIT">			</span><span class="NAME">item.itemID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5630</span> </span><span class="WHIT">			</span><span class="COMM">//console.log("Sending x & y as " +this.mouseX + " " + this.mouseY + " w&h " + locWidth + " " + locHeight);</span><span class="WHIT">
<span class='line'>5631</span> 
<span class='line'>5632</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5633</span> </span><span class="WHIT">		
<span class='line'>5634</span> 		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.collectionNode.isSynchronized</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5635</span> </span><span class="WHIT">			</span><span class="COMM">// safety check.</span><span class="WHIT">
<span class='line'>5636</span> </span><span class="WHIT">			</span><span class="NAME">this.hasRetracted</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5637</span> </span><span class="WHIT">			</span><span class="NAME">this.collectionNode.publishItem</span><span class="PUNC">(</span><span class="NAME">item</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5638</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5639</span> </span><span class="WHIT">		
<span class='line'>5640</span> 		</span><span class="NAME">this.lastMouseX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.mouseX</span><span class="PUNC">;</span><span class="WHIT">	
<span class='line'>5641</span> 		</span><span class="NAME">this.lastMouseY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.mouseY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5642</span> </span><span class="WHIT">		</span><span class="NAME">clearTimeout</span><span class="PUNC">(</span><span class="NAME">this.pointTimer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5643</span> </span><span class="WHIT">		</span><span class="NAME">this.pointTimer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5644</span> </span><span class="WHIT">		</span><span class="NAME">this.pointTimer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">bindUsingClosure</span><span class="PUNC">(</span><span class="NAME">this.sendMyCursor</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.pollInterval</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5645</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5646</span> </span><span class="WHIT">	
<span class='line'>5647</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5648</span> 
<span class='line'>5649</span> </span><span class="COMM">/**
<span class='line'>5650</span>  * @private
<span class='line'>5651</span>  */</span><span class="WHIT">
<span class='line'>5652</span> </span><span class="NAME">SharedCursorPane.prototype.nodeCreate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5653</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5654</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_evt.nodeName</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.collectionNode.canUserPublish</span><span class="PUNC">(</span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.nodeName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5655</span> </span><span class="WHIT">		</span><span class="NAME">this.wasPublisher</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5656</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">document.body.onmousemove</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5657</span> </span><span class="WHIT">			</span><span class="NAME">document.body.onmousemove</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.onMouseMove</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5658</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5659</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5660</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5661</span> 
<span class='line'>5662</span> </span><span class="COMM">/**
<span class='line'>5663</span>  * @private
<span class='line'>5664</span>  */</span><span class="WHIT">
<span class='line'>5665</span> </span><span class="NAME">SharedCursorPane.prototype.removeMyEventListeners</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5666</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5667</span> </span><span class="WHIT">	</span><span class="NAME">clearTimeout</span><span class="PUNC">(</span><span class="NAME">this.pointTimer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5668</span> </span><span class="WHIT">	</span><span class="NAME">this.pointTimer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5669</span> </span><span class="WHIT">	</span><span class="NAME">document.body.onmousemove</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5670</span> </span><span class="WHIT">	</span><span class="NAME">this.userMgr.removeEventListener</span><span class="PUNC">(</span><span class="STRN">"userCreate"</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5671</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5672</span> 
<span class='line'>5673</span> </span><span class="COMM">/**
<span class='line'>5674</span>  * @private
<span class='line'>5675</span>  */</span><span class="WHIT">
<span class='line'>5676</span> </span><span class="NAME">SharedCursorPane.prototype.moveCursorTo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_y</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5677</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5678</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.containsPoint</span><span class="PUNC">(</span><span class="NAME">p_x</span><span class="PUNC">,</span><span class="NAME">p_y</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5679</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">divElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5680</span> </span><span class="WHIT">		</span><span class="NAME">divElement.style.position</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"absolute"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5681</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tweenX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Tween</span><span class="PUNC">(</span><span class="NAME">divElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">divElement.style.left</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">400</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5682</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tweenY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Tween</span><span class="PUNC">(</span><span class="NAME">divElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">divElement.style.top</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">400</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5683</span> </span><span class="WHIT">		</span><span class="NAME">tweenX.onTweenUpdate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.onTweenUpdateX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5684</span> </span><span class="WHIT">		</span><span class="NAME">tweenY.onTweenUpdate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.onTweenUpdateY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5685</span> </span><span class="WHIT">		</span><span class="COMM">//console.log("x " + divElement.style.left+" y " + divElement.style.top);</span><span class="WHIT">
<span class='line'>5686</span> </span><span class="WHIT">		
<span class='line'>5687</span> 		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_x</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">p_x</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">document.body.clientWidth</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">p_y</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">p_y</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">document.body.clientHeight</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5688</span> </span><span class="WHIT">			</span><span class="NAME">this.setOpacity</span><span class="PUNC">(</span><span class="NAME">divElement</span><span class="PUNC">,</span><span class="NUMB">1.0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5689</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5690</span> </span><span class="WHIT">			</span><span class="NAME">this.setOpacity</span><span class="PUNC">(</span><span class="NAME">divElement</span><span class="PUNC">,</span><span class="NUMB">0.1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5691</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5692</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5693</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5694</span> 
<span class='line'>5695</span> </span><span class="COMM">/**
<span class='line'>5696</span>  * @private
<span class='line'>5697</span>  */</span><span class="WHIT">
<span class='line'>5698</span> </span><span class="NAME">SharedCursorPane.prototype.containsPoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_x</span><span class="PUNC">,</span><span class="NAME">p_y</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5699</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5700</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">p_x</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">p_x</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">document.body.clientWidth</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">p_y</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">p_y</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">document.body.clientHeight</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5701</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5702</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5703</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5704</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5705</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5706</span> 
<span class='line'>5707</span> </span><span class="COMM">/**
<span class='line'>5708</span>  * @private
<span class='line'>5709</span>  */</span><span class="WHIT">
<span class='line'>5710</span> </span><span class="NAME">SharedCursorPane.prototype.setOpacity</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_divElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_opacity</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5711</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5712</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">opacity</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_opacity</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5713</span> </span><span class="WHIT">	</span><span class="NAME">p_divElement.style.opacity</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_opacity</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5714</span> </span><span class="WHIT">	</span><span class="NAME">p_divElement.style.filter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'alpha(opacity = '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p_opacity</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">')'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5715</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5716</span> 
<span class='line'>5717</span> 
<span class='line'>5718</span> </span><span class="COMM">/**
<span class='line'>5719</span>  * @private
<span class='line'>5720</span>  */</span><span class="WHIT">
<span class='line'>5721</span> </span><span class="NAME">SharedCursorPane.prototype.onTweenUpdateX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">curVal</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5722</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5723</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">divElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.listener</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5724</span> </span><span class="WHIT">	</span><span class="NAME">divElement.style.left</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">curVal</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5725</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5726</span> 
<span class='line'>5727</span> </span><span class="COMM">/**
<span class='line'>5728</span>  * @private
<span class='line'>5729</span>  */</span><span class="WHIT">
<span class='line'>5730</span> </span><span class="NAME">SharedCursorPane.prototype.onTweenUpdateY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">curVal</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5731</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5732</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">divElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.listener</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5733</span> </span><span class="WHIT">	</span><span class="NAME">divElement.style.top</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">curVal</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5734</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5735</span> 
<span class='line'>5736</span> </span><span class="COMM">/**
<span class='line'>5737</span>  * @private
<span class='line'>5738</span>  */</span><span class="WHIT">
<span class='line'>5739</span> </span><span class="NAME">SharedCursorPane.prototype.addNewCursor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="NAME">p_x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p_y</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5740</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5741</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">divElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">'div'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5742</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">htmlString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"&lt;p>&lt;img src="</span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.cursorImgSrc</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="STRN">" width='8' height='14' align='middle' style='padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; position: absolute; left: 0px; top: 0px;'/>"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5743</span> </span><span class="WHIT">	</span><span class="NAME">divElement.innerHTML</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">htmlString</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.userManager.getUserDescriptor</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">displayName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"&lt;/p>"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5744</span> </span><span class="WHIT">	</span><span class="NAME">divElement.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_userID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5745</span> </span><span class="WHIT">	</span><span class="COMM">//set some style</span><span class="WHIT">
<span class='line'>5746</span> </span><span class="WHIT">	</span><span class="NAME">divElement.style.position</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"absolute"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5747</span> </span><span class="WHIT">	</span><span class="NAME">divElement.style.padding</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"0px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5748</span> </span><span class="WHIT">	</span><span class="NAME">divElement.style.border</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"0px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5749</span> </span><span class="WHIT">	</span><span class="NAME">divElement.style.margin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"0px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5750</span> </span><span class="WHIT">	</span><span class="NAME">divElement.style.left</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_x</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5751</span> </span><span class="WHIT">	</span><span class="NAME">divElement.style.top</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_y</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5752</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.cursorClass</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5753</span> </span><span class="WHIT">		</span><span class="NAME">divElement.className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.cursorClass</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5754</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5755</span> </span><span class="WHIT">	
<span class='line'>5756</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.cursorsByID</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5757</span> </span><span class="WHIT">		</span><span class="NAME">this.cursorsByID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5758</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5759</span> </span><span class="WHIT">	</span><span class="NAME">this.cursorsByID</span><span class="PUNC">[</span><span class="NAME">p_userID</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">divElement</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5760</span> </span><span class="WHIT">	</span><span class="NAME">document.body.appendChild</span><span class="PUNC">(</span><span class="NAME">divElement</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5761</span> </span><span class="WHIT">	
<span class='line'>5762</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5763</span> 
<span class='line'>5764</span> </span><span class="COMM">/**
<span class='line'>5765</span>  * @private
<span class='line'>5766</span>  */</span><span class="WHIT">
<span class='line'>5767</span> </span><span class="NAME">SharedCursorPane.prototype.userCreate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5768</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5769</span> </span><span class="WHIT">	
<span class='line'>5770</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5771</span> 
<span class='line'>5772</span> </span><span class="COMM">/**
<span class='line'>5773</span>  * @private
<span class='line'>5774</span>  */</span><span class="WHIT">
<span class='line'>5775</span> </span><span class="NAME">SharedCursorPane.prototype.removeCursor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5776</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5777</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.cursorsByID</span><span class="PUNC">[</span><span class="NAME">p_userID</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5778</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">divElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">p_userID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5779</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">divElement</span><span class="WHIT">	</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5780</span> </span><span class="WHIT">			</span><span class="NAME">document.body.removeChild</span><span class="PUNC">(</span><span class="NAME">divElement</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5781</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5782</span> </span><span class="WHIT">		</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.cursorsByID</span><span class="PUNC">[</span><span class="NAME">p_userID</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5783</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5784</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5785</span> 
<span class='line'>5786</span> </span><span class="COMM">/**
<span class='line'>5787</span>  * @function
<span class='line'>5788</span>  */</span><span class="WHIT">
<span class='line'>5789</span> </span><span class="NAME">SharedCursorPane.prototype.removeMyCursor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5790</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5791</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.collectionNode.isSynchronized</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">this.hasRetracted</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5792</span> </span><span class="WHIT">		</span><span class="NAME">this.hasRetracted</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5793</span> </span><span class="WHIT">		</span><span class="NAME">this.collectionNode.retractItem</span><span class="PUNC">(</span><span class="NAME">this.nodeName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.userManager.myUserID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5794</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5795</span> </span><span class="WHIT">	</span><span class="COMM">//Remove mouse listener</span><span class="WHIT">
<span class='line'>5796</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">document.body.onmousemove</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5797</span> </span><span class="WHIT">		</span><span class="NAME">document.body.onmousemove</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.onMouseMove</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5798</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5799</span> </span><span class="WHIT">	
<span class='line'>5800</span> 	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.pointTimer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5801</span> </span><span class="WHIT">		</span><span class="NAME">clearTimeout</span><span class="PUNC">(</span><span class="NAME">this.pointTimer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5802</span> </span><span class="WHIT">		</span><span class="NAME">this.pointTimer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5803</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5804</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5805</span> 
<span class='line'>5806</span> </span><span class="COMM">/**
<span class='line'>5807</span>  * @private
<span class='line'>5808</span>  */</span><span class="WHIT">
<span class='line'>5809</span> </span><span class="NAME">SharedCursorPane.prototype.onMouseMove</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5810</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5811</span> </span><span class="WHIT">	</span><span class="COMM">//reset the timer</span><span class="WHIT">
<span class='line'>5812</span> </span><span class="WHIT">	</span><span class="NAME">clearTimeout</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.cursorTarget.inactivityTimer</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5813</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">p_evt</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5814</span> </span><span class="WHIT">		</span><span class="COMM">//this.cursorTarget.mouseX = window.event.clientX + this.scrollLeft - this.clientLeft;</span><span class="WHIT">
<span class='line'>5815</span> </span><span class="WHIT">		</span><span class="COMM">//this.cursorTarget.mouseY = window.event.clientY + this.scrollTop - this.clientTop;</span><span class="WHIT">
<span class='line'>5816</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">doc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.documentElement</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5817</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">body</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.body</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5818</span> </span><span class="WHIT">		</span><span class="NAME">this.cursorTarget.mouseX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">window.event.clientX</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">doc</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">doc.scrollLeft</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">body</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">body.scrollLeft</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">doc</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">doc.clientLeft</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">body</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">body.clientLeft</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5819</span> </span><span class="WHIT">		</span><span class="NAME">this.cursorTarget.mouseY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">window.event.clientY</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">doc</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">doc.scrollTop</span><span class="WHIT">  </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">body</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">body.scrollTop</span><span class="WHIT">  </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">doc</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">doc.clientTop</span><span class="WHIT">  </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">body</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">body.clientTop</span><span class="WHIT">  </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5820</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5821</span> </span><span class="WHIT">		</span><span class="NAME">this.cursorTarget.mouseX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.pageX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5822</span> </span><span class="WHIT">		</span><span class="NAME">this.cursorTarget.mouseY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_evt.pageY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5823</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5824</span> </span><span class="WHIT">	
<span class='line'>5825</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.cursorTarget.pointTimer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5826</span> </span><span class="WHIT">		</span><span class="NAME">this.cursorTarget.sendMyCursor</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5827</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5828</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5829</span> 
<span class='line'>5830</span> </span><span class="COMM">/**
<span class='line'>5831</span>  * @private
<span class='line'>5832</span>  */</span><span class="WHIT">
<span class='line'>5833</span> </span><span class="NAME">SharedCursorPane.prototype.onInactivity</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5834</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5835</span> </span><span class="WHIT">	</span><span class="NAME">this.removeMyCursor</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5836</span> </span><span class="WHIT">	</span><span class="NAME">this.lastMouseX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.lastMouseY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5837</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5838</span> 
<span class='line'>5839</span> </span><span class="COMM">/**
<span class='line'>5840</span>  * Closes any event listeners and network operations. Using this function 
<span class='line'>5841</span>  * is recommended for garbage collection.
<span class='line'>5842</span>  * @function
<span class='line'>5843</span>  */</span><span class="WHIT">
<span class='line'>5844</span> </span><span class="NAME">SharedCursorPane.prototype.close</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5845</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5846</span> </span><span class="WHIT">	</span><span class="NAME">this.removeMyEventListeners</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5847</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5848</span> 
<span class='line'>5849</span> 
<span class='line'>5850</span> 
<span class='line'>5851</span> </span><span class="COMM">/**
<span class='line'>5852</span>  * @private
<span class='line'>5853</span>  * @ignore
<span class='line'>5854</span>  * @class Helper - Internal method to manage tweens
<span class='line'>5855</span>  * @constructor
<span class='line'>5856</span>  */</span><span class="WHIT">
<span class='line'>5857</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">Tweener</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5858</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5859</span> </span><span class="WHIT">	
<span class='line'>5860</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5861</span> 
<span class='line'>5862</span> </span><span class="COMM">/**
<span class='line'>5863</span>  * @private
<span class='line'>5864</span>  * @ignore
<span class='line'>5865</span>  */</span><span class="WHIT">
<span class='line'>5866</span> </span><span class="NAME">Tweener.prototype.ActiveTweens</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5867</span> </span><span class="COMM">/**
<span class='line'>5868</span>  * @private
<span class='line'>5869</span>  */</span><span class="WHIT">
<span class='line'>5870</span> </span><span class="NAME">Tweener.prototype.Interval</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5871</span> </span><span class="COMM">/**
<span class='line'>5872</span>  * @private
<span class='line'>5873</span>  * @ignore
<span class='line'>5874</span>  */</span><span class="WHIT">
<span class='line'>5875</span> </span><span class="NAME">Tweener.prototype.IntervalToken</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5876</span> </span><span class="COMM">/**
<span class='line'>5877</span>  * @private
<span class='line'>5878</span>  * @ignore
<span class='line'>5879</span>  */</span><span class="WHIT">
<span class='line'>5880</span> </span><span class="NAME">Tweener.prototype.TweenCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5881</span> 
<span class='line'>5882</span> </span><span class="COMM">/**
<span class='line'>5883</span>  * @private
<span class='line'>5884</span>  * @ignore
<span class='line'>5885</span>  */</span><span class="WHIT">
<span class='line'>5886</span> </span><span class="NAME">Tweener.prototype.AddTween</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">tween</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5887</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5888</span> </span><span class="WHIT">	</span><span class="NAME">this.ActiveTweens</span><span class="PUNC">[</span><span class="NAME">tween.ID</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tween</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5889</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.IntervalToken</span><span class="PUNC">==</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5890</span> </span><span class="WHIT">		</span><span class="COMM">//this.Dispatcher.DispatchTweens = this.DispatchTweens;</span><span class="WHIT">
<span class='line'>5891</span> </span><span class="WHIT">		</span><span class="NAME">this.IntervalToken</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">setInterval</span><span class="PUNC">(</span><span class="NAME">bindUsingClosure</span><span class="PUNC">(</span><span class="NAME">this.DispatchTweens</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.Interval</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5892</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5893</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5894</span> 
<span class='line'>5895</span> </span><span class="COMM">/**
<span class='line'>5896</span>  * @private
<span class='line'>5897</span>  * @ignore
<span class='line'>5898</span>  */</span><span class="WHIT">
<span class='line'>5899</span> </span><span class="NAME">Tweener.prototype.RemoveTween</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">tween</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5900</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5901</span> </span><span class="WHIT">	</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.ActiveTweens</span><span class="PUNC">[</span><span class="NAME">tween.ID</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5902</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tweensLeft</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5903</span> </span><span class="WHIT">	
<span class='line'>5904</span> 	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.ActiveTweens</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5905</span> </span><span class="WHIT">		</span><span class="NAME">tweensLeft</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5906</span> </span><span class="WHIT">		</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5907</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5908</span> </span><span class="WHIT">	
<span class='line'>5909</span> 	
<span class='line'>5910</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">tweensLeft</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5911</span> </span><span class="WHIT">		</span><span class="NAME">clearInterval</span><span class="PUNC">(</span><span class="NAME">this.IntervalToken</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5912</span> </span><span class="WHIT">		</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.IntervalToken</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5913</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5914</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5915</span> 
<span class='line'>5916</span> </span><span class="COMM">/**
<span class='line'>5917</span>  * @private
<span class='line'>5918</span>  * @ignore
<span class='line'>5919</span>  */</span><span class="WHIT">
<span class='line'>5920</span> </span><span class="NAME">Tweener.prototype.DispatchTweens</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5921</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5922</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">aT</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.ActiveTweens</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5923</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">aT</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5924</span> </span><span class="WHIT">		</span><span class="NAME">aT</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">doInterval</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5925</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5926</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5927</span> 
<span class='line'>5928</span> </span><span class="COMM">/**
<span class='line'>5929</span>  * @private
<span class='line'>5930</span>  * @ignore
<span class='line'>5931</span>  */</span><span class="WHIT">
<span class='line'>5932</span> </span><span class="NAME">Tweener.initialize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">object</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5933</span> </span><span class="WHIT">	</span><span class="NAME">object.tweener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_tweener</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5934</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5935</span> </span><span class="COMM">/**
<span class='line'>5936</span>  * @private
<span class='line'>5937</span>  * @ignore
<span class='line'>5938</span>  */</span><span class="WHIT">
<span class='line'>5939</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_tweener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Tweener</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5940</span> 
<span class='line'>5941</span> </span><span class="COMM">/**
<span class='line'>5942</span>  * @class The Tween class defines a tween, a property animation performed
<span class='line'>5943</span>  *  on a target object over a period of time.
<span class='line'>5944</span>  *  
<span class='line'>5945</span>  *  When the constructor is called, the animation automatically starts playing.
<span class='line'>5946</span>  *
<span class='line'>5947</span>  *  @param listener Object that is notified at each interval of the animation. You typically pass the &lt;code>this&lt;/code> 
<span class='line'>5948</span>  *  keyword as the value.  The &lt;code>listenerObj&lt;/code> must define the &lt;code>onTweenUpdate()&lt;/code> method and optionally the  
<span class='line'>5949</span>  *  &lt;code>onTweenEnd()&lt;/code> method. The former method is invoked for each interval of the animation,  and the latter is invoked just after the animation finishes.
<span class='line'>5950</span>  *  @param init Initial value(s) of the animation. Either a number or an array of numbers. If a number is passed, the Tween interpolates
<span class='line'>5951</span>  *  between this number and the number passed in the &lt;code>endValue&lt;/code> parameter. If an array of numbers is passed, 
<span class='line'>5952</span>  *  each number in the array is interpolated.
<span class='line'>5953</span>  *  @param end Final value(s) of the animation. The type of this argument must match the &lt;code>startValue&lt;/code>  parameter.
<span class='line'>5954</span>  *  @param dur Duration of the animation, expressed in milliseconds.
<span class='line'>5955</span>  *  @constructor
<span class='line'>5956</span>  */</span><span class="WHIT">  
<span class='line'>5957</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">Tween</span><span class="PUNC">(</span><span class="NAME">listenerObj</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">init</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">end</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dur</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5958</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5959</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">listenerObj</span><span class="PUNC">==</span><span class="NAME">undefined</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5960</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5961</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5962</span> </span><span class="WHIT">	
<span class='line'>5963</span> 	</span><span class="NAME">this.arrayMode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5964</span> </span><span class="WHIT">	
<span class='line'>5965</span> 	</span><span class="NAME">this.listener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">listenerObj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5966</span> </span><span class="WHIT">	</span><span class="NAME">this.initVal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">init</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5967</span> </span><span class="WHIT">	</span><span class="NAME">this.endVal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">end</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5968</span> </span><span class="WHIT">	
<span class='line'>5969</span> 	</span><span class="NAME">Tweener.initialize</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5970</span> </span><span class="WHIT">	
<span class='line'>5971</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dur</span><span class="PUNC">!=</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5972</span> </span><span class="WHIT">		</span><span class="NAME">this.duration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dur</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5973</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5974</span> </span><span class="WHIT">	</span><span class="NAME">this.ID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.tweener.TweenCount</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5975</span> </span><span class="WHIT">	</span><span class="NAME">this.startTime</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5976</span> </span><span class="WHIT">	
<span class='line'>5977</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.Interval</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5978</span> </span><span class="WHIT">		</span><span class="NAME">this.tweener.Interval</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.Interval</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5979</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5980</span> </span><span class="WHIT">	
<span class='line'>5981</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.IntervalToken</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5982</span> </span><span class="WHIT">		</span><span class="NAME">this.tweener.IntervalToken</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.IntervalToken</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5983</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5984</span> </span><span class="WHIT">	
<span class='line'>5985</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.TweenCount</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5986</span> </span><span class="WHIT">		</span><span class="NAME">this.tweener.TweenCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.TweenCount</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5987</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5988</span> </span><span class="WHIT">	
<span class='line'>5989</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">this.duration</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5990</span> </span><span class="WHIT">		</span><span class="NAME">this.doInterval</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5991</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5992</span> </span><span class="WHIT">		</span><span class="NAME">this.tweener.AddTween</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5993</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5994</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5995</span> 
<span class='line'>5996</span> </span><span class="COMM">//EventDispatcher.initialize(Tween.prototype);</span><span class="WHIT">
<span class='line'>5997</span> 
<span class='line'>5998</span> </span><span class="COMM">/**
<span class='line'>5999</span>  * Object that is notified at each interval of the animation.
<span class='line'>6000</span>  * @field
<span class='line'>6001</span>  */</span><span class="WHIT"> 
<span class='line'>6002</span> </span><span class="NAME">Tween.prototype.listener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6003</span> </span><span class="COMM">/**
<span class='line'>6004</span>  * @private
<span class='line'>6005</span>  */</span><span class="WHIT">
<span class='line'>6006</span> </span><span class="NAME">Tween.prototype.tweener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6007</span> </span><span class="COMM">/**
<span class='line'>6008</span>  * Duration of the animation, in millisecond's.
<span class='line'>6009</span>  *  @field
<span class='line'>6010</span>  */</span><span class="WHIT">  
<span class='line'>6011</span> </span><span class="NAME">Tween.prototype.duration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">3000</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6012</span> 
<span class='line'>6013</span> </span><span class="COMM">/**
<span class='line'>6014</span>  *  Initial value(s) of the animation. Either a number or an array of numbers. If a number is passed, the Tween interpolates
<span class='line'>6015</span>  *  between this number and the number passed in the &lt;code>endValue&lt;/code> parameter. If an array of numbers is passed, 
<span class='line'>6016</span>  *  each number in the array is interpolated.
<span class='line'>6017</span>  *  @field
<span class='line'>6018</span>  */</span><span class="WHIT"> 
<span class='line'>6019</span> </span><span class="NAME">Tween.prototype.initVal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// relaxed type to accommodate numbers or arrays</span><span class="WHIT">
<span class='line'>6020</span> </span><span class="COMM">/**
<span class='line'>6021</span>  *  Final value of the animation.The type of this argument must match the startValue parameter.
<span class='line'>6022</span>  *  @field
<span class='line'>6023</span>  */</span><span class="WHIT">  
<span class='line'>6024</span> </span><span class="NAME">Tween.prototype.endVal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6025</span> </span><span class="COMM">/**
<span class='line'>6026</span>  *  @private
<span class='line'>6027</span>  */</span><span class="WHIT">
<span class='line'>6028</span> </span><span class="NAME">Tween.prototype.arrayMode</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6029</span> </span><span class="COMM">/**
<span class='line'>6030</span>  *  @private
<span class='line'>6031</span>  */</span><span class="WHIT">
<span class='line'>6032</span> </span><span class="NAME">Tween.prototype.startTime</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6033</span> </span><span class="COMM">/**
<span class='line'>6034</span>  *  @private
<span class='line'>6035</span>  */</span><span class="WHIT">
<span class='line'>6036</span> </span><span class="NAME">Tween.prototype.updateFunc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6037</span> </span><span class="COMM">/**
<span class='line'>6038</span>  *  @private
<span class='line'>6039</span>  */</span><span class="WHIT">
<span class='line'>6040</span> </span><span class="NAME">Tween.prototype.endFunc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6041</span> </span><span class="COMM">/**
<span class='line'>6042</span>  *  @private
<span class='line'>6043</span>  */</span><span class="WHIT">
<span class='line'>6044</span> </span><span class="NAME">Tween.prototype.ID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6045</span> 
<span class='line'>6046</span> </span><span class="COMM">/**
<span class='line'>6047</span>  * @private
<span class='line'>6048</span>  */</span><span class="WHIT">
<span class='line'>6049</span> </span><span class="NAME">Tween.prototype.doInterval</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6050</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6051</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">curTime</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">this.startTime</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6052</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">curVal</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getCurVal</span><span class="PUNC">(</span><span class="NAME">curTime</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6053</span> </span><span class="WHIT">	
<span class='line'>6054</span> 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">curTime</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">this.duration</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6055</span> </span><span class="WHIT">		</span><span class="NAME">this.endTween</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6056</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6057</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.updateFunc</span><span class="PUNC">!=</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6058</span> </span><span class="WHIT">			</span><span class="NAME">this.listener</span><span class="PUNC">[</span><span class="NAME">updateFunc</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">curVal</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6059</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6060</span> </span><span class="WHIT">			</span><span class="NAME">this.onTweenUpdate</span><span class="PUNC">(</span><span class="NAME">curVal</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6061</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6062</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6063</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6064</span> 
<span class='line'>6065</span> 
<span class='line'>6066</span> </span><span class="COMM">/**
<span class='line'>6067</span>  * @private
<span class='line'>6068</span>  */</span><span class="WHIT">
<span class='line'>6069</span> </span><span class="NAME">Tween.prototype.getCurVal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">curTime</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6070</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6071</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.arrayMode</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6072</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">returnArray</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6073</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">initVal.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6074</span> </span><span class="WHIT">			</span><span class="NAME">returnArray</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.easingEquation</span><span class="PUNC">(</span><span class="NAME">curTime</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.initVal</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.endVal</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">this.initVal</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.duration</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6075</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6076</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">returnArray</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6077</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6078</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6079</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.easingEquation</span><span class="PUNC">(</span><span class="NAME">curTime</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.initVal</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.endVal</span><span class="PUNC">-</span><span class="NAME">this.initVal</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.duration</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6080</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6081</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6082</span> 
<span class='line'>6083</span> </span><span class="COMM">/**
<span class='line'>6084</span>  *  Interrupt the tween, jump immediately to the end of the tween, 
<span class='line'>6085</span>  *  and invoke the &lt;code>onTweenEnd()&lt;/code> callback function.
<span class='line'>6086</span>  *  @function
<span class='line'>6087</span>  */</span><span class="WHIT">  
<span class='line'>6088</span> </span><span class="NAME">Tween.prototype.endTween</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6089</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6090</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.endFunc</span><span class="PUNC">!=</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6091</span> </span><span class="WHIT">		</span><span class="NAME">this.listener</span><span class="PUNC">[</span><span class="NAME">endFunc</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">endVal</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6092</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6093</span> </span><span class="WHIT">		</span><span class="COMM">//this.listener.onTweenEnd(endVal);</span><span class="WHIT">
<span class='line'>6094</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6095</span> </span><span class="WHIT">	</span><span class="NAME">this.tweener.RemoveTween</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6096</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6097</span> 
<span class='line'>6098</span> </span><span class="COMM">/**
<span class='line'>6099</span>  *  Stops the tween, ending it without dispatching an event or calling
<span class='line'>6100</span>  *  the Tween's endFunction or &lt;code>onTweenEnd()&lt;/code>.
<span class='line'>6101</span>  *  @function
<span class='line'>6102</span>  */</span><span class="WHIT">  
<span class='line'>6103</span> </span><span class="NAME">Tween.prototype.stopTween</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6104</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6105</span> </span><span class="WHIT">	</span><span class="NAME">this.tweener.RemoveTween</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6106</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6107</span> 
<span class='line'>6108</span> </span><span class="COMM">/**
<span class='line'>6109</span>  * @private
<span class='line'>6110</span>  */</span><span class="WHIT">
<span class='line'>6111</span> </span><span class="NAME">Tween.prototype.setTweenHandlers</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">update</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">end</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6112</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6113</span> </span><span class="WHIT">	</span><span class="NAME">this.updateFunc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">update</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6114</span> </span><span class="WHIT">	</span><span class="NAME">this.endFunc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">end</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6115</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6116</span> 
<span class='line'>6117</span> </span><span class="COMM">/**
<span class='line'>6118</span>  * @private
<span class='line'>6119</span>  */</span><span class="WHIT">
<span class='line'>6120</span> </span><span class="NAME">Tween.prototype.easingEquation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6121</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6122</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">/</span><span class="NAME">d</span><span class="PUNC">-</span><span class="NUMB">0.5</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6123</span> </span><span class="PUNC">}</span></pre></body></html>